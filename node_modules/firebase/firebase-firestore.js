!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(Fd){"use strict";try{(function(){Fd=Fd&&Object.prototype.hasOwnProperty.call(Fd,"default")?Fd.default:Fd;var t,p,e,r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function n(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function g(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function w(n,r){var i,o,s,t,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function d(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}(e=p=p||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT";function i(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=a[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}var o={debug:p.DEBUG,verbose:p.VERBOSE,info:p.INFO,warn:p.WARN,error:p.ERROR,silent:p.SILENT},u=p.INFO,a=((t={})[p.DEBUG]="log",t[p.VERBOSE]="log",t[p.INFO]="info",t[p.WARN]="warn",t[p.ERROR]="error",t),c=(Object.defineProperty(h.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in p))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),h.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?o[t]:t},Object.defineProperty(h.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),h.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.DEBUG],t)),this._logHandler.apply(this,s([this,p.DEBUG],t))},h.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.VERBOSE],t)),this._logHandler.apply(this,s([this,p.VERBOSE],t))},h.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.INFO],t)),this._logHandler.apply(this,s([this,p.INFO],t))},h.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.WARN],t)),this._logHandler.apply(this,s([this,p.WARN],t))},h.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.ERROR],t)),this._logHandler.apply(this,s([this,p.ERROR],t))},h);function h(t){this.name=t,this._logLevel=u,this._logHandler=i,this._userLogHandler=null}function v(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var f,y=(n(l,f=Error),l);function l(t,e){var n=f.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,l.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,m.prototype.create),n}var m=(b.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?(r=i,s.replace(I,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",a=this.serviceName+": "+u+" ("+o+").",c=new y(o,a),h=0,f=Object.keys(i);h<f.length;h++){var l=f[h];"_"!==l.slice(-1)&&(l in c&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),c[l]=i[l])}return c},b);function b(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var I=/\{\$([^}]+)}/g;function E(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var T,N="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},A=A||{},_=N||self;function S(){}function D(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function x(t){var e=D(t);return"array"==e||"object"==e&&"number"==typeof t.length}function O(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var k="closure_uid_"+(1e9*Math.random()>>>0),P=0;function L(t,e,n){return t.call.apply(t.bind,arguments)}function R(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function C(t,e,n){return(C=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?L:R).apply(null,arguments)}function V(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var F=Date.now||function(){return+new Date};function U(t,e){function n(){}n.prototype=e.prototype,t.M=e.prototype,t.prototype=new n,t.prototype.constructor=t}function M(){this.j=this.j,this.i=this.i}M.prototype.j=!1,M.prototype.da=function(){if(!this.j&&(this.j=!0,this.C(),0))t=this,Object.prototype.hasOwnProperty.call(t,k)&&t[k]||(t[k]=++P);var t},M.prototype.C=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var j=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},q=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function G(t){return Array.prototype.concat.apply([],arguments)}function B(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function z(t){return/^[\s\xa0]*$/.test(t)}var K,W=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function H(t,e){return-1!=t.indexOf(e)}function X(t,e){return t<e?-1:e<t?1:0}t:{var Q=_.navigator;if(Q){var Y=Q.userAgent;if(Y){K=Y;break t}}K=""}function J(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function Z(t){var e={};for(var n in t)e[n]=t[n];return e}var $="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function tt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<$.length;o++)n=$[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function et(t){return et[" "](t),t}et[" "]=S;var nt,rt,it=H(K,"Opera"),ot=H(K,"Trident")||H(K,"MSIE"),st=H(K,"Edge"),ut=st||ot,at=H(K,"Gecko")&&!(H(K.toLowerCase(),"webkit")&&!H(K,"Edge"))&&!(H(K,"Trident")||H(K,"MSIE"))&&!H(K,"Edge"),ct=H(K.toLowerCase(),"webkit")&&!H(K,"Edge");function ht(){var t=_.document;return t?t.documentMode:void 0}t:{var ft="",lt=(rt=K,at?/rv:([^\);]+)(\)|;)/.exec(rt):st?/Edge\/([\d\.]+)/.exec(rt):ot?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(rt):ct?/WebKit\/(\S+)/.exec(rt):it?/(?:Version)[ \/]?(\S+)/.exec(rt):void 0);if(lt&&(ft=lt?lt[1]:""),ot){var pt=ht();if(null!=pt&&pt>parseFloat(ft)){nt=String(pt);break t}}nt=ft}var dt,vt={};function yt(u){return t=u,e=function(){for(var t=0,e=W(String(nt)).split("."),n=W(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=X(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||X(0==o[2].length,0==s[2].length)||X(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=vt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}if(_.document&&ot){var gt=ht();dt=gt||(parseInt(nt,10)||void 0)}else dt=void 0;var mt=dt,wt=!ot||9<=Number(mt),bt=ot&&!yt("9"),It=function(){if(!_.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{_.addEventListener("test",S,e),_.removeEventListener("test",S,e)}catch(t){}return t}();function Et(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Tt(t,e){if(Et.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(at){t:{try{et(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Nt[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Et.prototype.b=function(){this.defaultPrevented=!0},U(Tt,Et);var Nt={2:"touch",3:"pen",4:"mouse"};Tt.prototype.b=function(){Tt.M.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,bt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var At="closure_listenable_"+(1e6*Math.random()|0),_t=0;function St(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.aa=i,this.key=++_t,this.V=this.X=!1}function Dt(t){t.V=!0,t.listener=null,t.proxy=null,t.src=null,t.aa=null}function xt(t){this.src=t,this.a={},this.b=0}function Ot(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=j(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Dt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function kt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.V&&o.listener==e&&o.capture==!!n&&o.aa==r)return i}return-1}xt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=kt(t,e,r,i);return-1<s?(e=t[s],n||(e.X=!1)):((e=new St(e,this.src,o,!!r,i)).X=n,t.push(e)),e};var Pt="closure_lm_"+(1e6*Math.random()|0),Lt={};function Rt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=Gt(r);return e&&e[At]?e.sa(n,r,O(i)?!!i.capture:!!i,o):Ct(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Rt(t,e[o],n,r,i);return null}return n=Gt(n),t&&t[At]?t.ra(e,n,O(r)?!!r.capture:!!r,i):Ct(t,e,n,!1,r,i)}function Ct(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=O(i)?!!i.capture:!!i;if(s&&!wt)return null;var u,a,c=jt(t);if(c||(t[Pt]=c=new xt(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(u=Mt,r=a=wt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)It||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ft(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Vt(t){if("number"!=typeof t&&t&&!t.V){var e=t.src;if(e&&e[At])Ot(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ft(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=jt(e))?(Ot(n,t),0==n.b&&(n.src=null,e[Pt]=null)):Dt(t)}}}function Ft(t){return t in Lt?Lt[t]:Lt[t]="on"+t}function Ut(t,e){var n=t.listener,r=t.aa||t.src;return t.X&&Vt(t),n.call(r,e)}function Mt(t,e){if(t.V)return!0;if(wt)return Ut(t,new Tt(e,this));if(!e)t:{e=["window","event"];for(var n=_,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Ut(t,e=new Tt(e,this))}function jt(t){return(t=t[Pt])instanceof xt?t:null}var qt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Gt(e){return"function"==D(e)?e:(e[qt]||(e[qt]=function(t){return e.handleEvent(t)}),e[qt])}function Bt(){M.call(this),this.c=new xt(this),(this.J=this).A=null}function zt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.V&&s.capture==n){var u=s.listener,a=s.aa||s.src;s.X&&Ot(t.c,s),i=!1!==u.call(a,r)&&i}}return i&&!r.defaultPrevented}U(Bt,M),Bt.prototype[At]=!0,(T=Bt.prototype).addEventListener=function(t,e,n,r){Rt(this,t,e,n,r)},T.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=O(i)?!!i.capture:!!i,r=Gt(r),e&&e[At]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=kt(s=e.a[n],r,i,o))&&(Dt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&jt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=kt(n,r,i,o)),(r=-1<e?n[e]:null)&&Vt(r))}(this,t,e,n,r)},T.dispatchEvent=function(t){var e,n=this.A;if(n)for(e=[];n;n=n.A)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t)t=new Et(t,n);else if(t instanceof Et)t.target=t.target||n;else{var i=t;tt(t=new Et(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.a=e[o];i=zt(s,r,!0,t)&&i}if(i=zt(s=t.a=n,r,!0,t)&&i,i=zt(s,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=zt(s=t.a=e[o],r,!1,t)&&i;return i},T.C=function(){if(Bt.M.C.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Dt(n[r]);delete e.a[t],e.b--}}this.A=null},T.ra=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},T.sa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Kt=_.JSON.stringify;function Wt(){this.b=this.a=null}var Ht,Xt=(Qt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Qt(function(){return new Yt},function(t){t.reset()},100));function Qt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function Yt(){this.next=this.b=this.a=null}function Jt(t){_.setTimeout(function(){throw t},0)}function Zt(t,e){var n;Ht||(n=_.Promise.resolve(void 0),Ht=function(){n.then(ee)}),$t||(Ht(),$t=!0),te.add(t,e)}Wt.prototype.add=function(t,e){var n=Xt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Yt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var $t=!(Yt.prototype.reset=function(){this.next=this.b=this.a=null}),te=new Wt;function ee(){for(var t;r=n=void 0,r=null,(n=te).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){Jt(t)}var e=Xt;e.g(t),e.b<e.f&&(e.b++,t.next=e.a,e.a=t)}var n,r;$t=!1}function ne(t,e){Bt.call(this),this.b=t||1,this.a=e||_,this.f=C(this.Ua,this),this.g=F()}function re(t){t.Z=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function ie(t,e,n){if("function"==D(t))n&&(t=C(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=C(t.handleEvent,t)}return 2147483647<Number(e)?-1:_.setTimeout(t,e||0)}function oe(t,e,n){M.call(this),this.f=null!=n?C(t,n):t,this.c=e,this.b=C(this.Pa,this),this.a=[]}function se(t){t.T=ie(t.b,t.c),t.f.apply(null,t.a)}function ue(t){M.call(this),this.b=t,this.a={}}U(ne,Bt),(T=ne.prototype).Z=!1,T.L=null,T.Ua=function(){if(this.Z){var t=F()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.Z&&(re(this),this.start()))}},T.start=function(){this.Z=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=F())},T.C=function(){ne.M.C.call(this),re(this),delete this.a},U(oe,M),(T=oe.prototype).ba=!1,T.T=null,T.Ia=function(t){this.a=arguments,this.T?this.ba=!0:se(this)},T.C=function(){oe.M.C.call(this),this.T&&(_.clearTimeout(this.T),this.T=null,this.ba=!1,this.a=[])},T.Pa=function(){this.T=null,this.ba&&(this.ba=!1,se(this))},U(ue,M);var ae=[];function ce(t,e,n,r){Array.isArray(n)||(n&&(ae[0]=n.toString()),n=ae);for(var i=0;i<n.length;i++){var o=Rt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function he(t){J(t.a,function(t,e){this.a.hasOwnProperty(e)&&Vt(t)},t),t.a={}}function fe(){}ue.prototype.C=function(){ue.M.C.call(this),he(this)},ue.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var le=null;function pe(){return le=le||new Bt}function de(t){Et.call(this,"serverreachability",t)}function ve(t){var e=pe();e.dispatchEvent(new de(e))}function ye(t){Et.call(this,"statevent",t)}function ge(t){var e=pe();e.dispatchEvent(new ye(e))}function me(t){Et.call(this,"timingevent",t)}function we(t,e){if("function"!=D(t))throw Error("Fn must not be null and must be a function");return _.setTimeout(function(){t()},e)}U(de,Et),U(ye,Et),U(me,Et);var be={NO_ERROR:0,Va:1,bb:2,ab:3,Ya:4,$a:5,cb:6,za:7,TIMEOUT:8,gb:9},Ie={Xa:"complete",kb:"success",Aa:"error",za:"abort",ib:"ready",jb:"readystatechange",TIMEOUT:"timeout",eb:"incrementaldata",hb:"progress",Za:"downloadprogress",lb:"uploadprogress"};function Ee(){}function Te(t){var e;return(e=t.a)||(e=t.a={}),e}function Ne(){}Ee.prototype.a=null;var Ae,_e={OPEN:"a",Wa:"b",Aa:"c",fb:"d"};function Se(){Et.call(this,"d")}function De(){Et.call(this,"c")}function xe(){}function Oe(t,e,n){this.g=t,this.W=e,this.U=n||1,this.G=new ue(this),this.N=ke,t=ut?125:void 0,this.O=new ne(t),this.m=null,this.b=!1,this.j=this.A=this.f=this.B=this.s=this.P=this.h=null,this.i=[],this.a=null,this.w=0,this.c=this.v=null,this.H=-1,this.l=!1,this.J=0,this.D=null,this.o=this.R=this.F=!1}U(Se,Et),U(De,Et),U(xe,Ee),Ae=new xe;var ke=45e3,Pe={},Le={};function Re(t,e,n){t.B=1,t.f=nn(Ye(e)),t.j=n,t.F=!0,Ce(t,null)}function Ce(t,e){t.s=F(),Ue(t),t.A=Ye(t.f);var n=t.A,r=t.U;Array.isArray(r)||(r=[String(r)]),yn(n.b,"t",r),t.w=0,t.a=ur(t.g,t.g.w?e:null),0<t.J&&(t.D=new oe(C(t.ya,t,t.a),t.J)),ce(t.G,t.a,"readystatechange",t.Sa),e=t.m?Z(t.m):{},t.j?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.$(t.A,t.v,t.j,e)):(t.v="GET",t.a.$(t.A,t.v,null,e)),ve(1)}function Ve(t,e,n){for(var r=!0;!t.l&&t.w<n.length;){var i=Fe(t,n);if(i==Le){4==e&&(t.c=4,ge(14),r=!1);break}if(i==Pe){t.c=4,ge(15),r=!1;break}Be(t,i)}4==e&&0==n.length&&(t.c=1,ge(16),r=!1),t.b=t.b&&r,r||(Ge(t),qe(t))}function Fe(t,e){var n=t.w,r=e.indexOf("\n",n);return-1==r?Le:(n=Number(e.substring(n,r)),isNaN(n)?Pe:(r+=1)+n>e.length?Le:(e=e.substr(r,n),t.w=r+n,e))}function Ue(t){t.P=F()+t.N,Me(t,t.N)}function Me(t,e){if(null!=t.h)throw Error("WatchDog timer not null");t.h=we(C(t.Qa,t),e)}function je(t){t.h&&(_.clearTimeout(t.h),t.h=null)}function qe(t){0==t.g.u||t.l||nr(t.g,t)}function Ge(t){je(t);var e=t.D;e&&"function"==typeof e.da&&e.da(),t.D=null,re(t.O),he(t.G),t.a&&(e=t.a,t.a=null,e.abort(),e.da())}function Be(t,e){try{var n=t.g;if(0!=n.u&&(n.a==t||Tn(n.b,t)))if(n.A=t.H,!t.o&&Tn(n.b,t)&&3==n.u){try{var r=n.ja.a.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.i){if(n.a){if(!(n.a.s+3e3<t.s))break t;er(n),n.a.cancel(),n.a=null}tr(n),ge(18)}}else n.ia=i[1],0<n.ia-n.G&&i[2]<37500&&n.U&&0==n.m&&!n.l&&(n.l=we(C(n.Na,n),6e3));if(En(n.b)<=1&&n.O){try{n.O()}catch(t){}n.O=void 0}}else ir(n,11)}else if(!t.o&&n.a!=t||er(n),!z(e))for(e=r=n.ja.a.parse(e),r=0;r<e.length;r++)if(i=e[r],n.G=i[0],i=i[1],2==n.u)if("c"==i[0]){n.B=i[1],n.R=i[2];var o=i[3];null!=o&&(n.oa=o);var s=i[5];null!=s&&"number"==typeof s&&0<s&&(n.D=1.5*s);var u=n,a=t.a;if(a){var c=a.a?a.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(c){var h=u.b;!h.a&&(H(c,"spdy")||H(c,"quic")||H(c,"h2"))&&(h.f=h.g,h.a=new Set,h.b&&(Nn(h,h.b),h.b=null))}if(u.s){var f=a.a?a.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.ha=f,en(u.v,u.s,f))}}n.u=3,n.c&&n.c.na();var l=t;if((u=n).ea=sr(u,u.w?u.R:null,u.P),l.o){An(u.b,l);var p=l,d=u.D;d&&p.setTimeout(d),p.h&&(je(p),Ue(p)),u.a=l}else $n(u);0<n.f.length&&Qn(n)}else"stop"!=i[0]&&"close"!=i[0]||ir(n,7);else 3==n.u&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?ir(n,7):Wn(n):"noop"!=i[0]&&n.c&&n.c.ma(i),n.m=0);ve(4)}catch(t){}}function ze(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(x(t)||"string"==typeof t)q(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.I&&"function"==typeof t.I)n=void 0;else if(x(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.I&&"function"==typeof t.I)return t.I();if("string"==typeof t)return t.split("");if(x(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ke(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ke)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function We(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];He(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)He(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function He(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(T=Oe.prototype).setTimeout=function(t){this.N=t},T.Sa=function(t){t=t.target;var e=this.D;e&&3==Gn(t)?e.Ia():this.ya(t)},T.ya=function(t){try{if(t==this.a)t:{var e=Gn(this.a),n=this.a.qa(),r=this.a.S();if(!(e<3||3==e&&!ut&&!this.a.Y())){this.l||4!=e||7==n||ve(8==n||r<=0?3:2),je(this);var i=this.a.S();this.H=i;var o=this.a.Y();if(this.b=200==i){if(this.R&&!this.o){e:{if(this.a){var s,u=this.a;if((s=u.a?u.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!z(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.c=3,ge(12),Ge(this),qe(this);break t}this.o=!0,Be(this,a)}this.F?(Ve(this,e,o),ut&&this.b&&3==e&&(ce(this.G,this.O,"tick",this.Ra),this.O.start())):Be(this,o),4==e&&Ge(this),this.b&&!this.l&&(4==e?nr(this.g,this):(this.b=!1,Ue(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,ge(12)):(this.c=0,ge(13)),Ge(this),qe(this)}}}catch(t){}},T.Ra=function(){if(this.a){var t=Gn(this.a),e=this.a.Y();this.w<e.length&&(je(this),Ve(this,t,e),this.b&&4!=t&&Ue(this))}},T.cancel=function(){this.l=!0,Ge(this)},T.Qa=function(){this.h=null;var t=F();0<=t-this.P?(2!=this.B&&(ve(3),ge(17)),Ge(this),this.c=2,qe(this)):Me(this,this.P-t)},(T=Ke.prototype).I=function(){We(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},T.K=function(){return We(this),this.a.concat()},T.get=function(t,e){return He(this.b,t)?this.b[t]:e},T.set=function(t,e){He(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},T.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Xe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Qe(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Qe){this.a=void 0!==e?e:t.a,Je(this,t.f),this.j=t.j,Ze(this,t.c),$e(this,t.h),this.g=t.g,e=t.b;var n=new ln;n.c=e.c,e.a&&(n.a=new Ke(e.a),n.b=e.b),tn(this,n),this.i=t.i}else t&&(n=String(t).match(Xe))?(this.a=!!e,Je(this,n[1]||"",!0),this.j=rn(n[2]||""),Ze(this,n[3]||"",!0),$e(this,n[4]),this.g=rn(n[5]||"",!0),tn(this,n[6]||"",!0),this.i=rn(n[7]||"")):(this.a=!!e,this.b=new ln(null,this.a))}function Ye(t){return new Qe(t)}function Je(t,e,n){t.f=n?rn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Ze(t,e,n){t.c=n?rn(e,!0):e}function $e(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function tn(t,e,n){var r,i;e instanceof ln?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(pn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(dn(this,e),yn(this,n,t))},r)),r.f=i):(n||(e=on(e,hn)),t.b=new ln(e,t.a))}function en(t,e,n){t.b.set(e,n)}function nn(t){return en(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^F()).toString(36)),t}function rn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function on(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,sn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function sn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Qe.prototype.toString=function(){var t=[],e=this.f;e&&t.push(on(e,un,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(on(e,un,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(on(n,"/"==n.charAt(0)?cn:an,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",on(n,fn)),t.join("")};var un=/[#\/\?@]/g,an=/[#\?:]/g,cn=/[#\?]/g,hn=/[#\?@]/g,fn=/#/g;function ln(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function pn(n){n.a||(n.a=new Ke,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function dn(t,e){pn(t),e=gn(t,e),He(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,He((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&We(t)))}function vn(t,e){return pn(t),e=gn(t,e),He(t.a.b,e)}function yn(t,e,n){dn(t,e),0<n.length&&(t.c=null,t.a.set(gn(t,e),B(n)),t.b+=n.length)}function gn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function mn(t,e){this.b=t,this.a=e}function wn(t){this.g=t||bn,t=_.PerformanceNavigationTiming?0<(t=_.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(_.ca&&_.ca.ua&&_.ca.ua()&&_.ca.ua().mb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(T=ln.prototype).add=function(t,e){pn(this),this.c=null,t=gn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},T.forEach=function(n,r){pn(this),this.a.forEach(function(t,e){q(t,function(t){n.call(r,t,e,this)},this)},this)},T.K=function(){pn(this);for(var t=this.a.I(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},T.I=function(t){pn(this);var e=[];if("string"==typeof t)vn(this,t)&&(e=G(e,this.a.get(gn(this,t))));else{t=this.a.I();for(var n=0;n<t.length;n++)e=G(e,t[n])}return e},T.set=function(t,e){return pn(this),this.c=null,vn(this,t=gn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},T.get=function(t,e){return t&&0<(t=this.I(t)).length?String(t[0]):e},T.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.I(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var bn=10;function In(t){return t.b||t.a&&t.a.size>=t.f}function En(t){return t.b?1:t.a?t.a.size:0}function Tn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function Nn(t,e){t.a?t.a.add(e):t.b=e}function An(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function _n(t){var e,n;if(null!=t.b)return t.c.concat(t.b.i);if(null==t.a||0===t.a.size)return B(t.c);var r=t.c;try{for(var i=E(t.a.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.i)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Sn(){}function Dn(){this.a=new Sn}function xn(t,r,e){var i=e||"";try{ze(t,function(t,e){var n=t;O(t)&&(n=Kt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function On(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}wn.prototype.cancel=function(){var e,t;if(this.c=_n(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=E(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},Sn.prototype.stringify=function(t){return _.JSON.stringify(t,void 0)},Sn.prototype.parse=function(t){return _.JSON.parse(t,void 0)};var kn=_.JSON.parse;function Pn(t){Bt.call(this),this.headers=new Ke,this.G=t||null,this.b=!1,this.s=this.a=null,this.D="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.H=Ln,this.B=this.F=!1}U(Pn,Bt);var Ln="",Rn=/^https?$/i,Cn=["POST","PUT"];function Vn(t){return"content-type"==t.toLowerCase()}function Fn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Un(t),jn(t)}function Un(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Mn(t){if(t.b&&void 0!==A&&(!t.s[1]||4!=Gn(t)||2!=t.S()))if(t.l&&4==Gn(t))ie(t.va,0,t);else if(t.dispatchEvent("readystatechange"),4==Gn(t)){t.b=!1;try{var e,n=t.S();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.D).match(Xe)[1]||null;if(!o&&_.self&&_.self.location){var s=_.self.location.protocol;o=s.substr(0,s.length-1)}i=!Rn.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<Gn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.S()+"]",Un(t)}}finally{jn(t)}}}function jn(t,e){if(t.a){qn(t);var n=t.a,r=t.s[0]?S:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function qn(t){t.a&&t.B&&(t.a.ontimeout=null),t.m&&(_.clearTimeout(t.m),t.m=null)}function Gn(t){return t.a?t.a.readyState:0}function Bn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",J(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):en(t,e,n))}function zn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Kn(t){this.f=[],this.R=this.ea=this.v=this.P=this.a=this.ha=this.s=this.N=this.h=this.F=this.j=null,this.Fa=this.H=0,this.Ca=zn("failFast",!1,t),this.U=this.l=this.i=this.g=this.c=null,this.W=!0,this.A=this.ia=this.G=-1,this.J=this.m=this.o=0,this.Ba=zn("baseRetryDelayMs",5e3,t),this.Ga=zn("retryDelaySeedMs",1e4,t),this.Da=zn("forwardChannelMaxRetries",2,t),this.ga=zn("forwardChannelRequestTimeoutMs",2e4,t),this.Ea=t&&t.nb||void 0,this.D=void 0,this.w=t&&t.supportsCrossDomainXhr||!1,this.B="",this.b=new wn(t&&t.concurrentRequestLimit),this.ja=new Dn,this.fa=t&&t.fastHandshake||!1,t&&t.forceLongPolling&&(this.W=!1),this.O=void 0}function Wn(t){if(Hn(t),3==t.u){var e=t.H++,n=Ye(t.v);en(n,"SID",t.B),en(n,"RID",e),en(n,"TYPE","terminate"),Jn(t,n),(e=new Oe(t,e,void 0)).B=2,e.f=nn(Ye(n)),n=!1,_.navigator&&_.navigator.sendBeacon&&(n=_.navigator.sendBeacon(e.f.toString(),"")),!n&&_.Image&&((new Image).src=e.f,n=!0),n||(e.a=ur(e.g,null),e.a.$(e.f)),e.s=F(),Ue(e)}or(t)}function Hn(t){t.a&&(t.a.cancel(),t.a=null),t.i&&(_.clearTimeout(t.i),t.i=null),er(t),t.b.cancel(),t.g&&("number"==typeof t.g&&_.clearTimeout(t.g),t.g=null)}function Xn(t,e){t.f.push(new mn(t.Fa++,e)),3==t.u&&Qn(t)}function Qn(t){In(t.b)||t.g||(t.g=!0,Zt(t.xa,t),t.o=0)}function Yn(t,e){var n;n=e?e.W:t.H++;var r=Ye(t.v);en(r,"SID",t.B),en(r,"RID",n),en(r,"AID",t.G),Jn(t,r),t.h&&t.j&&Bn(r,t.h,t.j),n=new Oe(t,n,t.o+1),null===t.h&&(n.m=t.j),e&&(t.f=e.i.concat(t.f)),e=Zn(t,n,1e3),n.setTimeout(Math.round(.5*t.ga)+Math.round(.5*t.ga*Math.random())),Nn(t.b,n),Re(n,r,e)}function Jn(t,n){t.c&&ze({},function(t,e){en(n,e,t)})}function Zn(t,e,n){n=Math.min(t.f.length,n);var r=t.c?C(t.c.Ha,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].b,h=i[a].a;if((c-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{xn(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(u){r=s.join("&");break t}}return t=t.f.splice(0,n),e.i=t,r}function $n(t){t.a||t.i||(t.J=1,Zt(t.wa,t),t.m=0)}function tr(t){return!(t.a||t.i||3<=t.m)&&(t.J++,t.i=we(C(t.wa,t),rr(t,t.m)),t.m++,1)}function er(t){null!=t.l&&(_.clearTimeout(t.l),t.l=null)}function nr(t,e){var n=null;if(t.a==e){er(t),t.a=null;var r=2}else{if(!Tn(t.b,e))return;n=e.i,An(t.b,e),r=1}if(t.A=e.H,0!=t.u)if(e.b)if(1==r){n=e.j?e.j.length:0,e=F()-e.s;var i=t.o;(r=pe()).dispatchEvent(new me(r)),Qn(t)}else $n(t);else if(3==(i=e.c)||0==i&&0<t.A||!(1==r&&function(t,e){if(!(En(t.b)>=t.b.f-(t.g?1:0))){if(t.g)return t.f=e.i.concat(t.f),1;if(!(1==t.u||2==t.u||t.o>=(t.Ca?0:t.Da)))return t.g=we(C(t.xa,t,e),rr(t,t.o)),t.o++,1}}(t,e)||2==r&&tr(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:ir(t,5);break;case 4:ir(t,10);break;case 3:ir(t,6);break;default:ir(t,2)}}function rr(t,e){var n=t.Ba+Math.floor(Math.random()*t.Ga);return t.c||(n*=2),n*e}function ir(t,e){if(2==e){var n=null;t.c&&(n=null);var r=C(t.Ta,t);n||(n=new Qe("//www.google.com/images/cleardot.gif"),_.location&&"http"==_.location.protocol||Je(n,"https"),nn(n)),function(t,e){var n=new fe;if(_.Image){var r=new Image;r.onload=V(On,n,r,"TestLoadImage: loaded",!0,e),r.onerror=V(On,n,r,"TestLoadImage: error",!1,e),r.onabort=V(On,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=V(On,n,r,"TestLoadImage: timeout",!1,e),_.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else ge(2);t.u=0,t.c&&t.c.la(e),or(t),Hn(t)}function or(t){t.u=0,t.A=-1,t.c&&(0==_n(t.b).length&&0==t.f.length||(t.b.c.length=0,B(t.f),t.f.length=0),t.c.ka())}function sr(t,e,n){var r,i,o,s,u,a,c=(r=n)instanceof Qe?Ye(r):new Qe(r,void 0);if(""!=c.c)e&&Ze(c,e+"."+c.c),$e(c,c.h);else{var h=_.location;i=h.protocol,o=e?e+"."+h.hostname:h.hostname,s=+h.port,u=n,a=new Qe(null,void 0),i&&Je(a,i),o&&Ze(a,o),s&&$e(a,s),u&&(a.g=u),c=a}return t.N&&J(t.N,function(t,e){en(c,e,t)}),e=t.s,n=t.ha,e&&n&&en(c,e,n),en(c,"VER",t.oa),Jn(t,c),c}function ur(t,e){if(e&&!t.w)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Pn(t.Ea)).F=t.w,e}function ar(){}function cr(){if(ot&&!(10<=Number(mt)))throw Error("Environmental error: no available transport.")}function hr(t,e){Bt.call(this),this.a=new Kn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.j=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.pa&&(t?t["X-WebChannel-Client-Profile"]=e.pa:t={"X-WebChannel-Client-Profile":e.pa}),this.a.F=t,(t=e&&e.httpHeadersOverwriteParam)&&!z(t)&&(this.a.h=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!z(e)&&(this.a.s=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new pr(this)}function fr(t){Se.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function lr(){De.call(this),this.status=1}function pr(t){this.a=t}(T=Pn.prototype).$=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.G?Te(this.G):Te(Ae),this.a.onreadystatechange=C(this.va,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Fn(this,t)}t=n||"";var i,o=new Ke(this.headers);r&&ze(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Vn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.K()),n=_.FormData&&t instanceof _.FormData,0<=j(Cn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.H&&(this.a.responseType=this.H),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{qn(this),0<this.o&&((this.B=(i=this.a,ot&&yt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=C(this.ta,this)):this.m=ie(this.ta,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Fn(this,t)}},T.ta=function(){void 0!==A&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},T.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),jn(this))},T.C=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),jn(this,!0)),Pn.M.C.call(this)},T.va=function(){this.j||(this.w||this.l||this.g?Mn(this):this.Oa())},T.Oa=function(){Mn(this)},T.S=function(){try{return 2<Gn(this)?this.a.status:-1}catch(t){return-1}},T.Y=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},T.Ja=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),kn(e)}},T.qa=function(){return this.h},T.Ma=function(){return"string"==typeof this.f?this.f:String(this.f)},(T=Kn.prototype).oa=8,T.u=1,T.xa=function(t){if(this.g)if(this.g=null,1==this.u){if(!t){this.H=Math.floor(1e5*Math.random()),t=this.H++;var e,n=new Oe(this,t,void 0),r=this.j;if(this.F&&(r?tt(r=Z(r),this.F):r=this.F),null===this.h&&(n.m=r),this.fa)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Zn(this,n,e),en(i=Ye(this.v),"RID",t),en(i,"CVER",22),this.s&&en(i,"X-HTTP-Session-Id",this.s),Jn(this,i),this.h&&r&&Bn(i,this.h,r),Nn(this.b,n),this.fa?(en(i,"$req",e),en(i,"SID","null"),n.R=!0,Re(n,i,null)):Re(n,i,e),this.u=2}}else 3==this.u&&(t?Yn(this,t):0==this.f.length||In(this.b)||Yn(this))},T.wa=function(){this.i=null,this.a=new Oe(this,"rpc",this.J),null===this.h&&(this.a.m=this.j),this.a.J=0;var t=Ye(this.ea);en(t,"RID","rpc"),en(t,"SID",this.B),en(t,"CI",this.U?"0":"1"),en(t,"AID",this.G),Jn(this,t),en(t,"TYPE","xmlhttp"),this.h&&this.j&&Bn(t,this.h,this.j),this.D&&this.a.setTimeout(this.D);var e=this.a,n=this.R;e.B=1,e.f=nn(Ye(t)),e.j=null,e.F=!0,Ce(e,n)},T.Na=function(){null!=this.l&&(this.l=null,this.a.cancel(),this.a=null,tr(this),ge(19))},T.Ta=function(t){ge(t?2:1)},(T=ar.prototype).na=function(){},T.ma=function(){},T.la=function(){},T.ka=function(){},T.Ha=function(){},cr.prototype.a=function(t,e){return new hr(t,e)},U(hr,Bt),(T=hr.prototype).addEventListener=function(t,e,n,r){hr.M.addEventListener.call(this,t,e,n,r)},T.removeEventListener=function(t,e,n,r){hr.M.removeEventListener.call(this,t,e,n,r)},T.Ka=function(){this.a.c=this.f,this.h&&(this.a.w=!0);var t=this.a,e=this.l,n=this.b||void 0;ge(0),t.P=e,t.N=n||{},t.U=t.W,t.v=sr(t,null,t.P),Qn(t)},T.close=function(){Wn(this.a)},T.La=function(t){if("string"==typeof t){var e={};e.__data__=t,Xn(this.a,e)}else this.g?((e={}).__data__=Kt(t),Xn(this.a,e)):Xn(this.a,t)},T.C=function(){this.a.c=null,delete this.f,Wn(this.a),delete this.a,hr.M.C.call(this)},U(fr,Se),U(lr,De),U(pr,ar),pr.prototype.na=function(){this.a.dispatchEvent("a")},pr.prototype.ma=function(t){this.a.dispatchEvent(new fr(t))},pr.prototype.la=function(t){this.a.dispatchEvent(new lr)},pr.prototype.ka=function(){this.a.dispatchEvent("b")},cr.prototype.createWebChannel=cr.prototype.a,hr.prototype.send=hr.prototype.La,hr.prototype.open=hr.prototype.Ka,hr.prototype.close=hr.prototype.close,be.NO_ERROR=0,be.TIMEOUT=8,be.HTTP_ERROR=6,Ie.COMPLETE="complete",(Ne.EventType=_e).OPEN="a",_e.CLOSE="b",_e.ERROR="c",_e.MESSAGE="d",Bt.prototype.listen=Bt.prototype.ra,Pn.prototype.listenOnce=Pn.prototype.sa,Pn.prototype.getLastError=Pn.prototype.Ma,Pn.prototype.getLastErrorCode=Pn.prototype.qa,Pn.prototype.getStatus=Pn.prototype.S,Pn.prototype.getResponseJson=Pn.prototype.Ja,Pn.prototype.getResponseText=Pn.prototype.Y,Pn.prototype.send=Pn.prototype.$;var dr={createWebChannelTransport:function(){return new cr},ErrorCode:be,EventType:Ie,WebChannel:Ne,XhrIo:Pn},vr=dr.createWebChannelTransport,yr=dr.ErrorCode,gr=dr.EventType,mr=dr.WebChannel,wr=dr.XhrIo,br=(Ir.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},Ir.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},Ir.prototype.setServiceProps=function(t){return this.serviceProps=t,this},Ir);function Ir(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var Er=Fd.SDK_VERSION,Tr=new c("@firebase/firestore");function Nr(){return Tr.logLevel}function Ar(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Tr.logLevel<=p.DEBUG){var r=e.map(Sr);Tr.debug.apply(Tr,d(["Firestore ("+Er+"): "+t],r))}}function _r(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Tr.logLevel<=p.ERROR){var r=e.map(Sr);Tr.error.apply(Tr,d(["Firestore ("+Er+"): "+t],r))}}function Sr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function Dr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE ("+Er+") INTERNAL ASSERTION FAILED: "+t;throw _r(e),new Error(e)}function xr(t){t||Dr()}function Or(t){return t}function kr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Pr=(Lr.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=kr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Lr);function Lr(){}function Rr(t,e){return t<e?-1:e<t?1:0}function Cr(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function Vr(t){return t+"\0"}function Fr(t,e,n,r,i){this.s=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var Ur=(Object.defineProperty(Mr.prototype,"i",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),Mr.prototype.isEqual=function(t){return t instanceof Mr&&t.projectId===this.projectId&&t.database===this.database},Mr.prototype.o=function(t){return Rr(this.projectId,t.projectId)||Rr(this.database,t.database)},Mr);function Mr(t,e){this.projectId=t,this.database=e||"(default)"}function jr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function qr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Gr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Br,zr,Kr,Wr=(ci.prototype.get=function(t){var e=this.h(t),n=this.l[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.u(s,t))return u}},ci.prototype.has=function(t){return void 0!==this.get(t)},ci.prototype.set=function(t,e){var n=this.h(t),r=this.l[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.u(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.l[n]=[[t,e]]},ci.prototype.delete=function(t){var e=this.h(t),n=this.l[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.u(n[r][0],t))return 1===n.length?delete this.l[e]:n.splice(r,1),!0;return!1},ci.prototype.forEach=function(u){qr(this.l,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];u(o,s)}})},ci.prototype._=function(){return Gr(this.l)},ci),Hr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Xr=(n(ai,Kr=Error),ai),Qr=(ui.now=function(){return ui.fromMillis(Date.now())},ui.fromDate=function(t){return ui.fromMillis(t.getTime())},ui.fromMillis=function(t){var e=Math.floor(t/1e3);return new ui(e,1e6*(t-1e3*e))},ui.prototype.toDate=function(){return new Date(this.toMillis())},ui.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},ui.prototype.T=function(t){return this.seconds===t.seconds?Rr(this.nanoseconds,t.nanoseconds):Rr(this.seconds,t.seconds)},ui.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},ui.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},ui.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},ui),Yr=(si.I=function(t){return new si(t)},si.min=function(){return new si(new Qr(0,0))},si.prototype.o=function(t){return this.timestamp.T(t.timestamp)},si.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},si.prototype.m=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},si.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},si.prototype.A=function(){return this.timestamp},si),Jr=(Object.defineProperty(oi.prototype,"length",{get:function(){return this.R},enumerable:!1,configurable:!0}),oi.prototype.isEqual=function(t){return 0===oi.P(this,t)},oi.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof oi?t.forEach(function(t){e.push(t)}):e.push(t),this.g(e)},oi.prototype.limit=function(){return this.offset+this.length},oi.prototype.V=function(t){return t=void 0===t?1:t,this.g(this.segments,this.offset+t,this.length-t)},oi.prototype.p=function(){return this.g(this.segments,this.offset,this.length-1)},oi.prototype.v=function(){return this.segments[this.offset]},oi.prototype.S=function(){return this.get(this.length-1)},oi.prototype.get=function(t){return this.segments[this.offset+t]},oi.prototype._=function(){return 0===this.length},oi.prototype.D=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},oi.prototype.C=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},oi.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},oi.prototype.$=function(){return this.segments.slice(this.offset,this.limit())},oi.P=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},oi),Zr=(n(ii,zr=Jr),ii.prototype.g=function(t,e,n){return new ii(t,e,n)},ii.prototype.F=function(){return this.$().join("/")},ii.prototype.toString=function(){return this.F()},ii.N=function(t){if(0<=t.indexOf("//"))throw new Xr(Hr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new ii(t.split("/").filter(function(t){return 0<t.length}))},ii.k=function(){return new ii([])},ii),$r=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ti=(n(ri,Br=Jr),ri.prototype.g=function(t,e,n){return new ri(t,e,n)},ri.M=function(t){return $r.test(t)},ri.prototype.F=function(){return this.$().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),ri.M(t)||(t="`"+t+"`"),t}).join(".")},ri.prototype.toString=function(){return this.F()},ri.prototype.O=function(){return 1===this.length&&"__name__"===this.get(0)},ri.L=function(){return new ri(["__name__"])},ri.q=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Xr(Hr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Xr(Hr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Xr(Hr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Xr(Hr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ri(e)},ri.k=function(){return new ri([])},ri),ei=(ni.B=function(t){return new ni(Zr.N(t).V(5))},ni.prototype.U=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},ni.prototype.isEqual=function(t){return null!==t&&0===Zr.P(this.path,t.path)},ni.prototype.toString=function(){return this.path.toString()},ni.P=function(t,e){return Zr.P(t.path,e.path)},ni.W=function(t){return t.length%2==0},ni.j=function(t){return new ni(new Zr(t.slice()))},ni);function ni(t){this.path=t}function ri(){return null!==Br&&Br.apply(this,arguments)||this}function ii(){return null!==zr&&zr.apply(this,arguments)||this}function oi(t,e,n){void 0===e?e=0:e>t.length&&Dr(),void 0===n?n=t.length-e:n>t.length-e&&Dr(),this.segments=t,this.offset=e,this.R=n}function si(t){this.timestamp=t}function ui(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Xr(Hr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Xr(Hr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Xr(Hr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Xr(Hr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function ai(t,e){var n=this;return(n=Kr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function ci(t,e){this.h=t,this.u=e,this.l={}}function hi(t){return null==t}function fi(t){return-0===t&&1/t==-1/0}function li(t){return"number"==typeof t&&Number.isInteger(t)&&!fi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var pi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.K=null};function di(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new pi(t,e,n,r,i,o,s)}function vi(t){var e=Or(t);if(null===e.K){var n=e.path.F();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return(e=t).field.F()+e.op.toString()+Eo(e.value);var e}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return(e=t).field.F()+e.dir;var e}).join(","),hi(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=Qu(e.startAt)),e.endAt&&(n+="|ub:",n+=Qu(e.endAt)),e.K=n}return e.K}function yi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(r=t.orderBy[n],i=e.orderBy[n],r.dir!==i.dir||!r.field.isEqual(i.field))return!1;var r,i,o,s;if(t.filters.length!==e.filters.length)return!1;for(var u=0;u<t.filters.length;u++)if(o=t.filters[u],s=e.filters[u],!(o instanceof ku&&s instanceof ku&&o.op===s.op&&o.field.isEqual(s.field)&&mo(o.value,s.value)))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Ju(t.startAt,e.startAt)&&Ju(t.endAt,e.endAt)}function gi(t){return ei.W(t.path)&&null===t.collectionGroup&&0===t.filters.length}var mi=(wi.fromBase64String=function(t){return new wi(atob(t))},wi.fromUint8Array=function(t){return new wi(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},wi.prototype.toBase64=function(){return t=this.G,btoa(t);var t},wi.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.G)},wi.prototype.H=function(){return 2*this.G.length},wi.prototype.o=function(t){return Rr(this.G,t.G)},wi.prototype.isEqual=function(t){return this.G===t.G},wi);function wi(t){this.G=t}mi.Y=new mi("");function bi(t){this.count=t}var Ii,Ei,Ti=(Ni.prototype.Z=function(t){return new Ni(this.target,this.targetId,this.J,t,this.X,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Ni.prototype.tt=function(t,e){return new Ni(this.target,this.targetId,this.J,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Ni.prototype.et=function(t){return new Ni(this.target,this.targetId,this.J,this.sequenceNumber,this.X,t,this.resumeToken)},Ni);function Ni(t,e,n,r,i,o,s){void 0===i&&(i=Yr.min()),void 0===o&&(o=Yr.min()),void 0===s&&(s=mi.Y),this.target=t,this.targetId=e,this.J=n,this.sequenceNumber=r,this.X=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Ai(t){switch(t){case Hr.OK:return Dr();case Hr.CANCELLED:case Hr.UNKNOWN:case Hr.DEADLINE_EXCEEDED:case Hr.RESOURCE_EXHAUSTED:case Hr.INTERNAL:case Hr.UNAVAILABLE:case Hr.UNAUTHENTICATED:return;case Hr.INVALID_ARGUMENT:case Hr.NOT_FOUND:case Hr.ALREADY_EXISTS:case Hr.PERMISSION_DENIED:case Hr.FAILED_PRECONDITION:case Hr.ABORTED:case Hr.OUT_OF_RANGE:case Hr.UNIMPLEMENTED:case Hr.DATA_LOSS:return 1;default:return Dr()}}function _i(t){if(void 0===t)return _r("GRPC error has no .code"),Hr.UNKNOWN;switch(t){case Ii.OK:return Hr.OK;case Ii.CANCELLED:return Hr.CANCELLED;case Ii.UNKNOWN:return Hr.UNKNOWN;case Ii.DEADLINE_EXCEEDED:return Hr.DEADLINE_EXCEEDED;case Ii.RESOURCE_EXHAUSTED:return Hr.RESOURCE_EXHAUSTED;case Ii.INTERNAL:return Hr.INTERNAL;case Ii.UNAVAILABLE:return Hr.UNAVAILABLE;case Ii.UNAUTHENTICATED:return Hr.UNAUTHENTICATED;case Ii.INVALID_ARGUMENT:return Hr.INVALID_ARGUMENT;case Ii.NOT_FOUND:return Hr.NOT_FOUND;case Ii.ALREADY_EXISTS:return Hr.ALREADY_EXISTS;case Ii.PERMISSION_DENIED:return Hr.PERMISSION_DENIED;case Ii.FAILED_PRECONDITION:return Hr.FAILED_PRECONDITION;case Ii.ABORTED:return Hr.ABORTED;case Ii.OUT_OF_RANGE:return Hr.OUT_OF_RANGE;case Ii.UNIMPLEMENTED:return Hr.UNIMPLEMENTED;case Ii.DATA_LOSS:return Hr.DATA_LOSS;default:return Dr()}}(Ei=Ii=Ii||{})[Ei.OK=0]="OK",Ei[Ei.CANCELLED=1]="CANCELLED",Ei[Ei.UNKNOWN=2]="UNKNOWN",Ei[Ei.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ei[Ei.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ei[Ei.NOT_FOUND=5]="NOT_FOUND",Ei[Ei.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ei[Ei.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ei[Ei.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ei[Ei.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ei[Ei.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ei[Ei.ABORTED=10]="ABORTED",Ei[Ei.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ei[Ei.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ei[Ei.INTERNAL=13]="INTERNAL",Ei[Ei.UNAVAILABLE=14]="UNAVAILABLE",Ei[Ei.DATA_LOSS=15]="DATA_LOSS";var Si=(Pi.prototype.nt=function(t,e){return new Pi(this.P,this.root.nt(t,e,this.P).copy(null,null,xi.st,null,null))},Pi.prototype.remove=function(t){return new Pi(this.P,this.root.remove(t,this.P).copy(null,null,xi.st,null,null))},Pi.prototype.get=function(t){for(var e=this.root;!e._();){var n=this.P(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Pi.prototype.indexOf=function(t){for(var e=0,n=this.root;!n._();){var r=this.P(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Pi.prototype._=function(){return this.root._()},Object.defineProperty(Pi.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),Pi.prototype.it=function(){return this.root.it()},Pi.prototype.rt=function(){return this.root.rt()},Pi.prototype.ot=function(t){return this.root.ot(t)},Pi.prototype.forEach=function(n){this.ot(function(t,e){return n(t,e),!1})},Pi.prototype.toString=function(){var n=[];return this.ot(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},Pi.prototype.ht=function(t){return this.root.ht(t)},Pi.prototype.at=function(){return new Di(this.root,null,this.P,!1)},Pi.prototype.ut=function(t){return new Di(this.root,t,this.P,!1)},Pi.prototype.ct=function(){return new Di(this.root,null,this.P,!0)},Pi.prototype.lt=function(t){return new Di(this.root,t,this.P,!0)},Pi),Di=(ki.prototype.dt=function(){var t=this.ft.pop(),e={key:t.key,value:t.value};if(this._t)for(t=t.left;!t._();)this.ft.push(t),t=t.right;else for(t=t.right;!t._();)this.ft.push(t),t=t.left;return e},ki.prototype.wt=function(){return 0<this.ft.length},ki.prototype.Tt=function(){if(0===this.ft.length)return null;var t=this.ft[this.ft.length-1];return{key:t.key,value:t.value}},ki),xi=(Oi.prototype.copy=function(t,e,n,r,i){return new Oi(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Oi.prototype._=function(){return!1},Oi.prototype.ot=function(t){return this.left.ot(t)||t(this.key,this.value)||this.right.ot(t)},Oi.prototype.ht=function(t){return this.right.ht(t)||t(this.key,this.value)||this.left.ht(t)},Oi.prototype.min=function(){return this.left._()?this:this.left.min()},Oi.prototype.it=function(){return this.min().key},Oi.prototype.rt=function(){return this.right._()?this.key:this.right.rt()},Oi.prototype.nt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.nt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.nt(t,e,n))).Et()},Oi.prototype.It=function(){if(this.left._())return Oi.EMPTY;var t=this;return t.left.At()||t.left.left.At()||(t=t.Rt()),(t=t.copy(null,null,null,t.left.It(),null)).Et()},Oi.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left._()||r.left.At()||r.left.left.At()||(r=r.Rt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.At()&&(r=r.Pt()),r.right._()||r.right.At()||r.right.left.At()||(r=r.gt()),0===e(t,r.key)){if(r.right._())return Oi.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.It())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Et()},Oi.prototype.At=function(){return this.color},Oi.prototype.Et=function(){var t=this;return t.right.At()&&!t.left.At()&&(t=t.Vt()),t.left.At()&&t.left.left.At()&&(t=t.Pt()),t.left.At()&&t.right.At()&&(t=t.yt()),t},Oi.prototype.Rt=function(){var t=this.yt();return t.right.left.At()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Pt())).Vt()).yt()),t},Oi.prototype.gt=function(){var t=this.yt();return t.left.left.At()&&(t=(t=t.Pt()).yt()),t},Oi.prototype.Vt=function(){var t=this.copy(null,null,Oi.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Oi.prototype.Pt=function(){var t=this.copy(null,null,Oi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Oi.prototype.yt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Oi.prototype.pt=function(){var t=this.bt();return Math.pow(2,t)<=this.size+1},Oi.prototype.bt=function(){if(this.At()&&this.left.At())throw Dr();if(this.right.At())throw Dr();var t=this.left.bt();if(t!==this.right.bt())throw Dr();return t+(this.At()?0:1)},Oi);function Oi(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Oi.RED,this.left=null!=r?r:Oi.EMPTY,this.right=null!=i?i:Oi.EMPTY,this.size=this.left.size+1+this.right.size}function ki(t,e,n,r){this._t=r,this.ft=[];for(var i=1;!t._();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this._t?t.left:t.right;else{if(0===i){this.ft.push(t);break}this.ft.push(t),t=this._t?t.right:t.left}}function Pi(t,e){this.P=t,this.root=e||xi.EMPTY}function Li(){this.size=0}xi.EMPTY=null,xi.RED=!0,xi.st=!1,xi.EMPTY=(Object.defineProperty(Li.prototype,"key",{get:function(){throw Dr()},enumerable:!1,configurable:!0}),Object.defineProperty(Li.prototype,"value",{get:function(){throw Dr()},enumerable:!1,configurable:!0}),Object.defineProperty(Li.prototype,"color",{get:function(){throw Dr()},enumerable:!1,configurable:!0}),Object.defineProperty(Li.prototype,"left",{get:function(){throw Dr()},enumerable:!1,configurable:!0}),Object.defineProperty(Li.prototype,"right",{get:function(){throw Dr()},enumerable:!1,configurable:!0}),Li.prototype.copy=function(t,e,n,r,i){return this},Li.prototype.nt=function(t,e,n){return new xi(t,e)},Li.prototype.remove=function(t,e){return this},Li.prototype._=function(){return!0},Li.prototype.ot=function(t){return!1},Li.prototype.ht=function(t){return!1},Li.prototype.it=function(){return null},Li.prototype.rt=function(){return null},Li.prototype.At=function(){return!1},Li.prototype.pt=function(){return!0},Li.prototype.bt=function(){return 0},new Li);var Ri=(Ui.prototype.has=function(t){return null!==this.data.get(t)},Ui.prototype.first=function(){return this.data.it()},Ui.prototype.last=function(){return this.data.rt()},Object.defineProperty(Ui.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Ui.prototype.indexOf=function(t){return this.data.indexOf(t)},Ui.prototype.forEach=function(n){this.data.ot(function(t,e){return n(t),!1})},Ui.prototype.vt=function(t,e){for(var n=this.data.ut(t[0]);n.wt();){var r=n.dt();if(0<=this.P(r.key,t[1]))return;e(r.key)}},Ui.prototype.St=function(t,e){var n;for(n=void 0!==e?this.data.ut(e):this.data.at();n.wt();)if(!t(n.dt().key))return},Ui.prototype.Dt=function(t){var e=this.data.ut(t);return e.wt()?e.dt().key:null},Ui.prototype.at=function(){return new Ci(this.data.at())},Ui.prototype.ut=function(t){return new Ci(this.data.ut(t))},Ui.prototype.add=function(t){return this.copy(this.data.remove(t).nt(t,!0))},Ui.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Ui.prototype._=function(){return this.data._()},Ui.prototype.Ct=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},Ui.prototype.isEqual=function(t){if(!(t instanceof Ui))return!1;if(this.size!==t.size)return!1;for(var e=this.data.at(),n=t.data.at();e.wt();){var r=e.dt().key,i=n.dt().key;if(0!==this.P(r,i))return!1}return!0},Ui.prototype.$=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Ui.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Ui.prototype.copy=function(t){var e=new Ui(this.P);return e.data=t,e},Ui),Ci=(Fi.prototype.dt=function(){return this.$t.dt().key},Fi.prototype.wt=function(){return this.$t.wt()},Fi),Vi=new Si(ei.P);function Fi(t){this.$t=t}function Ui(t){this.P=t,this.data=new Si(this.P)}function Mi(){return Vi}function ji(){return Mi()}var qi=new Si(ei.P);function Gi(){return qi}var Bi=new Si(ei.P),zi=new Ri(ei.P);function Ki(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=zi,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Wi=new Ri(Rr);function Hi(){return Wi}function Xi(t,e,n,r){this.Zt=t,this.removedTargetIds=e,this.key=n,this.te=r}function Qi(t,e){this.targetId=t,this.ee=e}function Yi(t,e,n,r){void 0===n&&(n=mi.Y),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var Ji=(ho.kt=function(t){return new ho(t.P)},ho.prototype.has=function(t){return null!=this.Ft.get(t)},ho.prototype.get=function(t){return this.Ft.get(t)},ho.prototype.first=function(){return this.Nt.it()},ho.prototype.last=function(){return this.Nt.rt()},ho.prototype._=function(){return this.Nt._()},ho.prototype.indexOf=function(t){var e=this.Ft.get(t);return e?this.Nt.indexOf(e):-1},Object.defineProperty(ho.prototype,"size",{get:function(){return this.Nt.size},enumerable:!1,configurable:!0}),ho.prototype.forEach=function(n){this.Nt.ot(function(t,e){return n(t),!1})},ho.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Ft.nt(t.key,t),e.Nt.nt(t,null))},ho.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Ft.remove(t),this.Nt.remove(e)):this},ho.prototype.isEqual=function(t){if(!(t instanceof ho))return!1;if(this.size!==t.size)return!1;for(var e=this.Nt.at(),n=t.Nt.at();e.wt();){var r=e.dt().key,i=n.dt().key;if(!r.isEqual(i))return!1}return!0},ho.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},ho.prototype.copy=function(t,e){var n=new ho;return n.P=this.P,n.Ft=t,n.Nt=e,n},ho),Zi=(co.prototype.track=function(t){var e=t.doc.key,n=this.xt.get(e);!n||0!==t.type&&3===n.type?this.xt=this.xt.nt(e,t):3===t.type&&1!==n.type?this.xt=this.xt.nt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.xt=this.xt.nt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.xt=this.xt.nt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.xt=this.xt.remove(e):1===t.type&&2===n.type?this.xt=this.xt.nt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.xt=this.xt.nt(e,{type:2,doc:t.doc}):Dr()},co.prototype.Mt=function(){var n=[];return this.xt.ot(function(t,e){n.push(e)}),n},co),$i=(ao.Ut=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new ao(t,e,Ji.kt(e),i,n,r,!0,!1)},Object.defineProperty(ao.prototype,"hasPendingWrites",{get:function(){return!this.Lt._()},enumerable:!1,configurable:!0}),ao.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.qt===t.qt&&this.Lt.isEqual(t.Lt)&&Au(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Ot.isEqual(t.Ot)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},ao),to=(uo.Gt=function(t,e){var n=new Map;return n.set(t,eo.zt(t,e)),new uo(Yr.min(),n,Hi(),Mi(),Ki())},uo),eo=(so.zt=function(t,e){return new so(mi.Y,e,Ki(),Ki(),Ki())},so),no=(Object.defineProperty(oo.prototype,"Ht",{get:function(){return this.re},enumerable:!1,configurable:!0}),Object.defineProperty(oo.prototype,"resumeToken",{get:function(){return this.ie},enumerable:!1,configurable:!0}),Object.defineProperty(oo.prototype,"he",{get:function(){return 0!==this.ne},enumerable:!1,configurable:!0}),Object.defineProperty(oo.prototype,"ae",{get:function(){return this.oe},enumerable:!1,configurable:!0}),oo.prototype.ue=function(t){0<t.H()&&(this.oe=!0,this.ie=t)},oo.prototype.ce=function(){var n=Ki(),r=Ki(),i=Ki();return this.se.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:Dr()}}),new eo(this.ie,this.re,n,r,i)},oo.prototype.le=function(){this.oe=!1,this.se=lo()},oo.prototype._e=function(t,e){this.oe=!0,this.se=this.se.nt(t,e)},oo.prototype.fe=function(t){this.oe=!0,this.se=this.se.remove(t)},oo.prototype.de=function(){this.ne+=1},oo.prototype.we=function(){--this.ne},oo.prototype.Te=function(){this.oe=!0,this.re=!0},oo),ro=(io.prototype.Pe=function(t){for(var e=0,n=t.Zt;e<n.length;e++){var r=n[e];t.te instanceof au?this.ge(r,t.te):t.te instanceof cu&&this.Ve(r,t.key,t.te)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.Ve(s,t.key,t.te)}},io.prototype.ye=function(n){var r=this;this.pe(n,function(t){var e=r.be(t);switch(n.state){case 0:r.ve(t)&&e.ue(n.resumeToken);break;case 1:e.we(),e.he||e.le(),e.ue(n.resumeToken);break;case 2:e.we(),e.he||r.removeTarget(t);break;case 3:r.ve(t)&&(e.Te(),e.ue(n.resumeToken));break;case 4:r.ve(t)&&(r.Se(t),e.ue(n.resumeToken));break;default:Dr()}})},io.prototype.pe=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Ie.forEach(function(t,e){r.ve(e)&&n(e)})},io.prototype.De=function(t){var e=t.targetId,n=t.ee.count,r=this.Ce(e);if(r){var i=r.target;if(gi(i))if(0===n){var o=new ei(i.path);this.Ve(e,o,new cu(o,Yr.min()))}else xr(1===n);else this.$e(e)!==n&&(this.Se(e),this.Re=this.Re.add(e))}},io.prototype.Fe=function(i){var o=this,s=new Map;this.Ie.forEach(function(t,e){var n=o.Ce(e);if(n){if(t.Ht&&gi(n.target)){var r=new ei(n.target.path);null!==o.me.get(r)||o.Ne(e,r)||o.Ve(e,r,new cu(r,i))}t.ae&&(s.set(e,t.ce()),t.le())}});var r=Ki();this.Ae.forEach(function(t,e){var n=!0;e.St(function(t){var e=o.Ce(t);return!e||2===e.J||(n=!1)}),n&&(r=r.add(t))});var t=new to(i,s,this.Re,this.me,r);return this.me=Mi(),this.Ae=fo(),this.Re=new Ri(Rr),t},io.prototype.ge=function(t,e){if(this.ve(t)){var n=this.Ne(t,e.key)?2:0;this.be(t)._e(e.key,n),this.me=this.me.nt(e.key,e),this.Ae=this.Ae.nt(e.key,this.ke(e.key).add(t))}},io.prototype.Ve=function(t,e,n){if(this.ve(t)){var r=this.be(t);this.Ne(t,e)?r._e(e,1):r.fe(e),this.Ae=this.Ae.nt(e,this.ke(e).delete(t)),n&&(this.me=this.me.nt(e,n))}},io.prototype.removeTarget=function(t){this.Ie.delete(t)},io.prototype.$e=function(t){var e=this.be(t).ce();return this.Ee.xe(t).size+e.Yt.size-e.Xt.size},io.prototype.de=function(t){this.be(t).de()},io.prototype.be=function(t){var e=this.Ie.get(t);return e||(e=new no,this.Ie.set(t,e)),e},io.prototype.ke=function(t){var e=this.Ae.get(t);return e||(e=new Ri(Rr),this.Ae=this.Ae.nt(t,e)),e},io.prototype.ve=function(t){var e=null!==this.Ce(t);return e||Ar("WatchChangeAggregator","Detected inactive target",t),e},io.prototype.Ce=function(t){var e=this.Ie.get(t);return e&&e.he?null:this.Ee.Me(t)},io.prototype.Se=function(e){var n=this;this.Ie.set(e,new no),this.Ee.xe(e).forEach(function(t){n.Ve(e,t,null)})},io.prototype.Ne=function(t,e){return this.Ee.xe(t).has(e)},io);function io(t){this.Ee=t,this.Ie=new Map,this.me=Mi(),this.Ae=fo(),this.Re=new Ri(Rr)}function oo(){this.ne=0,this.se=lo(),this.ie=mi.Y,this.re=!1,this.oe=!0}function so(t,e,n,r,i){this.resumeToken=t,this.Ht=e,this.Yt=n,this.Jt=r,this.Xt=i}function uo(t,e,n,r,i){this.X=t,this.Wt=e,this.Qt=n,this.jt=r,this.Kt=i}function ao(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Ot=n,this.docChanges=r,this.Lt=i,this.fromCache=o,this.qt=s,this.Bt=u}function co(){this.xt=new Si(ei.P)}function ho(n){this.P=n?function(t,e){return n(t,e)||ei.P(t.key,e.key)}:function(t,e){return ei.P(t.key,e.key)},this.Ft=Gi(),this.Nt=new Si(this.P)}function fo(){return new Si(ei.P)}function lo(){return new Si(ei.P)}function po(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function vo(t){var e=To(t.mapValue.fields.__local_write_time__.timestampValue);return new Qr(e.seconds,e.nanos)}var yo=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function go(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?po(t)?4:10:Dr()}function mo(i,t){var e,n,r,o=go(i);if(o!==go(t))return!1;switch(o){case 0:return!0;case 1:return i.booleanValue===t.booleanValue;case 4:return vo(i).isEqual(vo(t));case 3:return function(t){if("string"==typeof i.timestampValue&&"string"==typeof t.timestampValue&&i.timestampValue.length===t.timestampValue.length)return i.timestampValue===t.timestampValue;var e=To(i.timestampValue),n=To(t.timestampValue);return e.seconds===n.seconds&&e.nanos===n.nanos}(t);case 5:return i.stringValue===t.stringValue;case 6:return r=t,Ao(i.bytesValue).isEqual(Ao(r.bytesValue));case 7:return i.referenceValue===t.referenceValue;case 8:return n=t,No((e=i).geoPointValue.latitude)===No(n.geoPointValue.latitude)&&No(e.geoPointValue.longitude)===No(n.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return No(t.integerValue)===No(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=No(t.doubleValue),r=No(e.doubleValue);return n===r?fi(n)===fi(r):isNaN(n)&&isNaN(r)}return!1}(i,t);case 9:return Cr(i.arrayValue.values||[],t.arrayValue.values||[],mo);case 10:return function(t){var e=i.mapValue.fields||{},n=t.mapValue.fields||{};if(jr(e)!==jr(n))return!1;for(var r in e)if(e.hasOwnProperty(r)&&(void 0===n[r]||!mo(e[r],n[r])))return!1;return!0}(t);default:return Dr()}}function wo(t,e){return void 0!==(t.values||[]).find(function(t){return mo(t,e)})}function bo(t,e){var n,r,i,o,s,u,a,c,h,f,l=go(t),p=go(e);if(l!==p)return Rr(l,p);switch(l){case 0:return 0;case 1:return Rr(t.booleanValue,e.booleanValue);case 2:return c=e,h=No(t.integerValue||t.doubleValue),f=No(c.integerValue||c.doubleValue),h<f?-1:f<h?1:h===f?0:isNaN(h)?isNaN(f)?0:-1:1;case 3:return Io(t.timestampValue,e.timestampValue);case 4:return Io(vo(t),vo(e));case 5:return Rr(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,s=e.bytesValue,u=Ao(o),a=Ao(s),u.o(a);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Rr(n[i],r[i]);if(0!==o)return o}return Rr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,r=e.geoPointValue,0!==(i=Rr(No(n.latitude),No(r.latitude)))?i:Rr(No(n.longitude),No(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=bo(n[i],r[i]);if(o)return o}return Rr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Rr(r[s],o[s]);if(0!==u)return u;var a=bo(n[r[s]],i[o[s]]);if(0!==a)return a}return Rr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Dr()}}function Io(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Rr(t,e);var n=To(t),r=To(e),i=Rr(n.seconds,r.seconds);return 0!==i?i:Rr(n.nanos,r.nanos)}function Eo(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=To(i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?Ao(i.bytesValue).toBase64():"referenceValue"in i?(n=i.referenceValue,ei.B(n).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++){e?e=!1:t+=",",t+=s(r[n])}return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):Dr();var t,e,n}(t)}function To(t){if(xr(!!t),"string"!=typeof t)return{seconds:No(t.seconds),nanos:No(t.nanos)};var e=0,n=yo.exec(t);if(xr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}function No(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Ao(t){return"string"==typeof t?mi.fromBase64String(t):mi.fromUint8Array(t)}function _o(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.F()}}function So(t){return t&&"integerValue"in t}function Do(t){return!!t&&"arrayValue"in t}function xo(t){return t&&"nullValue"in t}function Oo(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function ko(t){return t&&"mapValue"in t}var Po={asc:"ASCENDING",desc:"DESCENDING"},Lo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ro=function(t,e){this.s=t,this.Oe=e};function Co(t){return{integerValue:""+t}}function Vo(t,e){if(t.Oe){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fi(e)?"-0":e}}function Fo(t,e){return li(e)?Co(e):Vo(t,e)}function Uo(t,e){return t.Oe?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Mo(t,e){return t.Oe?e.toBase64():e.toUint8Array()}function jo(t){return xr(!!t),Yr.I((e=To(t),new Qr(e.seconds,e.nanos)));var e}function qo(t,e){return new Zr(["projects",t.projectId,"databases",t.database]).child("documents").child(e).F()}function Go(t){var e=Zr.N(t);return xr(is(e)),e}function Bo(t,e){return qo(t.s,e.path)}function zo(t,e){var n=Go(e);return xr(n.get(1)===t.s.projectId),xr(!n.get(3)&&!t.s.database||n.get(3)===t.s.database),new ei(Xo(n))}function Ko(t,e){return qo(t.s,e)}function Wo(t){var e=Go(t);return 4===e.length?Zr.k():Xo(e)}function Ho(t){return new Zr(["projects",t.s.projectId,"databases",t.s.database]).F()}function Xo(t){return xr(4<t.length&&"documents"===t.get(4)),t.V(5)}function Qo(t,e,n){return{name:Bo(t,e),fields:n.proto.mapValue.fields}}function Yo(t,e){var n,r,i,o,s,u,a;if(e instanceof Fs)n={update:Qo(t,e.key,e.value)};else if(e instanceof Qs)n={delete:Bo(t,e.key)};else if(e instanceof Us)n={update:Qo(t,e.key,e.data),updateMask:(r=e.Le,i=[],r.fields.forEach(function(t){return i.push(t.F())}),{fieldPaths:i})};else if(e instanceof Bs)n={transform:{document:Bo(t,e.key),fieldTransforms:e.fieldTransforms.map(function(t){return function(t){var e=t.transform;if(e instanceof cs)return{fieldPath:t.field.F(),setToServerValue:"REQUEST_TIME"};if(e instanceof hs)return{fieldPath:t.field.F(),appendMissingElements:{values:e.elements}};if(e instanceof vs)return{fieldPath:t.field.F(),removeAllFromArray:{values:e.elements}};if(e instanceof ws)return{fieldPath:t.field.F(),increment:e.qe};throw Dr()}(t)})}};else{if(!(e instanceof Ys))return Dr();n={verify:Bo(t,e.key)}}return e.Ue.Be||(n.currentDocument=(o=t,void 0!==(s=e.Ue).updateTime?{updateTime:(u=o,a=s.updateTime,Uo(u,a.A()))}:void 0!==s.exists?{exists:s.exists}:Dr())),n}function Jo(e,t){var n,r,i=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?Ss.updateTime(jo(n.updateTime)):void 0!==n.exists?Ss.exists(n.exists):Ss.We():Ss.We();if(t.update){t.update.name;var o=zo(e,t.update.name),s=new Js({mapValue:{fields:t.update.fields}});if(t.updateMask){var u=(r=t.updateMask.fieldPaths||[],new Ts(r.map(function(t){return ti.q(t)})));return new Us(o,s,u,i)}return new Fs(o,s,i)}if(t.delete){var a=zo(e,t.delete);return new Qs(a,i)}if(t.transform){var c=zo(e,t.transform.document),h=t.transform.fieldTransforms.map(function(t){return function(t,e){var n=null;if("setToServerValue"in e)xr("REQUEST_TIME"===e.setToServerValue),n=new cs;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new hs(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new vs(i)}else"increment"in e?n=new ws(t,e.increment):Dr();var o=ti.q(e.fieldPath);return new Ns(o,n)}(e,t)});return xr(!0===i.exists),new Bs(c,h)}if(t.verify){var f=zo(e,t.verify);return new Ys(f,i)}return Dr()}function Zo(t,e){return{documents:[Ko(t,e.path)]}}function $o(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Ko(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Ko(t,r.p()),n.structuredQuery.from=[{collectionId:r.S()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return t instanceof ku?function(t){if("=="===t.op){if(Oo(t.value))return{unaryFilter:{field:ns(t.field),op:"IS_NAN"}};if(xo(t.value))return{unaryFilter:{field:ns(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:ns(t.field),op:(e=t.op,Lo[e]),value:t.value}};var e}(t):Dr()});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return{field:ns((e=t).field),direction:(n=e.dir,Po[n])};var e,n})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s,u,a=(s=t,u=e.limit,s.Oe||hi(u)?u:{value:u});return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=ts(e.startAt)),e.endAt&&(n.structuredQuery.endAt=ts(e.endAt)),n}function ts(t){return{before:t.before,values:t.position}}function es(t){var e=!!t.before,n=t.values||[];return new Bu(n,e)}function ns(t){return{fieldPath:t.F()}}function rs(t){return ti.q(t.fieldPath)}function is(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function os(){this.Qe=void 0}function ss(t,e){return t instanceof ws?So(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}var us,as,cs=(n(ls,as=os),ls),hs=(n(fs,us=os),fs);function fs(t){var e=this;return(e=us.call(this)||this).elements=t,e}function ls(){return null!==as&&as.apply(this,arguments)||this}function ps(t,e){for(var n=Es(e),r=function(e){n.some(function(t){return mo(t,e)})||n.push(e)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ds,vs=(n(ys,ds=os),ys);function ys(t){var e=this;return(e=ds.call(this)||this).elements=t,e}function gs(t,e){for(var n=Es(e),r=function(e){n=n.filter(function(t){return!mo(t,e)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ms,ws=(n(bs,ms=os),bs);function bs(t,e){var n=this;return(n=ms.call(this)||this).serializer=t,n.qe=e,n}function Is(t){return No(t.integerValue||t.doubleValue)}function Es(t){return Do(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Ts=(As.prototype.je=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].D(t))return!0;return!1},As.prototype.isEqual=function(t){return Cr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},As),Ns=function(t,e){this.field=t,this.transform=e};function As(t){(this.fields=t).sort(ti.P)}function _s(t,e){this.version=t,this.transformResults=e}var Ss=(Ds.We=function(){return new Ds},Ds.exists=function(t){return new Ds(void 0,t)},Ds.updateTime=function(t){return new Ds(t)},Object.defineProperty(Ds.prototype,"Be",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),Ds.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},Ds);function Ds(t,e){this.updateTime=t,this.exists=e}function xs(t,e){return void 0!==t.updateTime?e instanceof au&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof au}function Os(){}function ks(t,e,n){return t instanceof Fs?(i=n,new au(t.key,i.version,t.value,{hasCommittedMutations:!0})):t instanceof Us?function(t,e,n){if(!xs(t.Ue,e))return new hu(t.key,n.version);var r=qs(t,e);return new au(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof Bs?function(t,e,n){if(xr(null!=n.transformResults),!xs(t.Ue,e))return new hu(t.key,n.version);var r=Ks(0,e),i=function(t,e,n){var r,i,o,s=[];xr(t.length===n.length);for(var u=0;u<n.length;u++){var a=t[u],c=a.transform,h=null;e instanceof au&&(h=e.field(a.field)),s.push((r=c,i=h,o=n[u],r instanceof hs?ps(r,i):r instanceof vs?gs(r,i):o))}return s}(t.fieldTransforms,e,n.transformResults),o=n.version,s=Ws(t,r.data(),i);return new au(t.key,o,s,{hasCommittedMutations:!0})}(t,e,n):(r=n,new cu(t.key,r.version,{hasCommittedMutations:!0}));var r,i}function Ps(t,e,n,r){return t instanceof Fs?function(t,e){if(!xs(t.Ue,e))return e;var n=Rs(e);return new au(t.key,n,t.value,{Ke:!0})}(t,e):t instanceof Us?function(t,e){if(!xs(t.Ue,e))return e;var n=Rs(e),r=qs(t,e);return new au(t.key,n,r,{Ke:!0})}(t,e):t instanceof Bs?function(t,e,n,r){if(!xs(t.Ue,e))return e;var i=Ks(0,e),o=function(t,e,n,r){for(var i=[],o=0,s=t;o<s.length;o++){var u=s[o],a=u.transform,c=null;n instanceof au&&(c=n.field(u.field)),null===c&&r instanceof au&&(c=r.field(u.field)),i.push((f=c,l=e,y=v=d=p=void 0,(h=a)instanceof cs?(y={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}},f&&(y.fields.__previous_value__=f),{mapValue:y}):h instanceof hs?ps(h,f):h instanceof vs?gs(h,f):(d=ss(p=h,f),v=Is(d)+Is(p.qe),So(d)&&So(p.qe)?Co(v):Vo(p.serializer,v))))}var h,f,l,p,d,v,y;return i}(t.fieldTransforms,n,e,r),s=Ws(t,i.data(),o);return new au(t.key,i.version,s,{Ke:!0})}(t,e,r,n):(o=e,xs((i=t).Ue,o)?new cu(i.key,Yr.min()):o);var i,o}function Ls(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ue.isEqual(e.Ue)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Le.isEqual(e.Le):2!==t.type||Cr(t.fieldTransforms,t.fieldTransforms,function(t,e){return r=e,(n=t).field.isEqual(r.field)&&(i=n.transform,o=r.transform,i instanceof hs&&o instanceof hs||i instanceof vs&&o instanceof vs?Cr(i.elements,o.elements,mo):i instanceof ws&&o instanceof ws?mo(i.qe,o.qe):i instanceof cs&&o instanceof cs);var n,r,i,o}))}function Rs(t){return t instanceof au?t.version:Yr.min()}var Cs,Vs,Fs=(n(js,Vs=Os),js),Us=(n(Ms,Cs=Os),Ms);function Ms(t,e,n,r){var i=this;return(i=Cs.call(this)||this).key=t,i.data=e,i.Le=n,i.Ue=r,i.type=1,i}function js(t,e,n){var r=this;return(r=Vs.call(this)||this).key=t,r.value=e,r.Ue=n,r.type=0,r}function qs(t,e){return n=t,r=e instanceof au?e.data():Js.empty(),i=new Zs(r),n.Le.fields.forEach(function(t){if(!t._()){var e=n.data.field(t);null!==e?i.set(t,e):i.delete(t)}}),i.Ge();var n,r,i}var Gs,Bs=(n(zs,Gs=Os),zs);function zs(t,e){var n=this;return(n=Gs.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Ue=Ss.exists(!0),n}function Ks(t,e){return e}function Ws(t,e,n){for(var r=new Zs(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.Ge()}var Hs,Xs,Qs=(n(nu,Xs=Os),nu),Ys=(n(eu,Hs=Os),eu),Js=(tu.empty=function(){return new tu({mapValue:{}})},tu.prototype.field=function(t){if(t._())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!ko(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.S()])||null},tu.prototype.isEqual=function(t){return mo(this.proto,t.proto)},tu),Zs=($s.prototype.set=function(t,e){return this.Ye(t,e),this},$s.prototype.delete=function(t){return this.Ye(t,null),this},$s.prototype.Ye=function(t,e){for(var n=this.He,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map||(o=o&&10===go(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),n=o}n.set(t.S(),e)},$s.prototype.Ge=function(){var t=this.Je(ti.k(),this.He);return null!=t?new Js(t):this.ze},$s.prototype.Je=function(r,t){var i=this,o=!1,e=this.ze.field(r),s=ko(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){if(t instanceof Map){var n=i.Je(r.child(e),t);null!=n&&(s[e]=n,o=!0)}else null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},$s);function $s(t){void 0===t&&(t=Js.empty()),this.ze=t,this.He=new Map}function tu(t){this.proto=t}function eu(t,e){var n=this;return(n=Hs.call(this)||this).key=t,n.Ue=e,n.type=4,n}function nu(t,e){var n=this;return(n=Xs.call(this)||this).key=t,n.Ue=e,n.type=3,n}function ru(t){var u=[];return qr(t.fields||{},function(t,e){var n=new ti([t]);if(ko(e)){var r=ru(e.mapValue).fields;if(0===r.length)u.push(n);else for(var i=0,o=r;i<o.length;i++){var s=o[i];u.push(n.child(s))}}else u.push(n)}),new Ts(u)}function iu(t,e){this.key=t,this.version=e}var ou,su,uu,au=(n(pu,uu=iu),pu.prototype.field=function(t){return this.Xe.field(t)},pu.prototype.data=function(){return this.Xe},pu.prototype.Ze=function(){return this.Xe.proto},pu.prototype.isEqual=function(t){return t instanceof pu&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ke===t.Ke&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Xe.isEqual(t.Xe)},pu.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.Xe.toString()+", {hasLocalMutations: "+this.Ke+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(pu.prototype,"hasPendingWrites",{get:function(){return this.Ke||this.hasCommittedMutations},enumerable:!1,configurable:!0}),pu),cu=(n(lu,su=iu),lu.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(lu.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),lu.prototype.isEqual=function(t){return t instanceof lu&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},lu),hu=(n(fu,ou=iu),fu.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(fu.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),fu.prototype.isEqual=function(t){return t instanceof fu&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},fu);function fu(){return null!==ou&&ou.apply(this,arguments)||this}function lu(t,e,n){var r=this;return(r=su.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function pu(t,e,n,r){var i=this;return(i=uu.call(this,t,e)||this).Xe=n,i.Ke=!!r.Ke,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function du(t,e){if(!(t instanceof e))throw e.name===t.constructor.name?new Xr(Hr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass '"+e.name+"' from a different Firestore SDK?"):new Xr(Hr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but was '"+t.constructor.name+"'");return t}var vu=(yu.prototype.rn=function(t){return new yu(t,null,this.tn.slice(),this.filters.slice(),this.limit,this.en,this.startAt,this.endAt)},yu.prototype.on=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.tn.length||1===this.tn.length&&this.tn[0].field.O())},yu.prototype.hn=function(){return!hi(this.limit)&&"F"===this.en},yu.prototype.an=function(){return!hi(this.limit)&&"L"===this.en},yu.prototype.un=function(){return 0<this.tn.length?this.tn[0].field:null},yu.prototype.cn=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n.ln())return n.field}return null},yu.prototype._n=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(0<=t.indexOf(r.op))return r.op}return null},yu);function yu(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.tn=n,this.filters=r,this.limit=i,this.en=o,this.startAt=s,this.endAt=u,this.nn=null,this.sn=null,this.startAt,this.endAt}function gu(t,e,n,r,i,o,s,u){return new vu(t,e,n,r,i,o,s,u)}function mu(t){return new vu(t)}function wu(t){return null!==t.collectionGroup}function bu(t){var e=du(t,vu);if(null===e.nn){e.nn=[];var n=e.cn(),r=e.un();if(null!==n&&null===r)n.O()||e.nn.push(new Zu(n)),e.nn.push(new Zu(ti.L(),"asc"));else{for(var i=!1,o=0,s=e.tn;o<s.length;o++){var u=s[o];e.nn.push(u),u.field.O()&&(i=!0)}if(!i){var a=0<e.tn.length?e.tn[e.tn.length-1].dir:"asc";e.nn.push(new Zu(ti.L(),a))}}}return e.nn}function Iu(t){var e=du(t,vu);if(!e.sn)if("F"===e.en)e.sn=di(e.path,e.collectionGroup,bu(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=bu(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Zu(o.field,s))}var u=e.endAt?new Bu(e.endAt.position,!e.endAt.before):null,a=e.startAt?new Bu(e.startAt.position,!e.startAt.before):null;e.sn=di(e.path,e.collectionGroup,n,e.filters,e.limit,u,a)}return e.sn}function Eu(t,e,n){return new vu(t.path,t.collectionGroup,t.tn.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Tu(t,e){return new vu(t.path,t.collectionGroup,t.tn.slice(),t.filters.slice(),t.limit,t.en,e,t.endAt)}function Nu(t,e){return new vu(t.path,t.collectionGroup,t.tn.slice(),t.filters.slice(),t.limit,t.en,t.startAt,e)}function Au(t,e){return yi(Iu(t),Iu(e))&&t.en===e.en}function _u(t){return vi(Iu(t))+"|lt:"+t.en}function Su(t){return"Query(target="+(e=Iu(t),n=e.path.F(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return(e=t).field.F()+" "+e.op+" "+Eo(e.value);var e}).join(", ")+"]"),hi(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return(e=t).field.F()+" ("+e.dir+")";var e}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+Qu(e.startAt)),e.endAt&&(n+=", endAt: "+Qu(e.endAt)),"Target("+n+")")+"; limitType="+t.en+")";var e,n}function Du(i,t){return r=i,o=t.key.path,(null!==r.collectionGroup?t.key.U(r.collectionGroup)&&r.path.D(o):ei.W(r.path)?r.path.isEqual(o):r.path.C(o))&&function(t){for(var e=0,n=i.tn;e<n.length;e++){var r=n[e];if(!r.field.O()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(e=i).startAt||Yu(e.startAt,bu(e),n))&&(!e.endAt||!Yu(e.endAt,bu(e),n)));var e,n,r,o}function xu(u){return function(t,e){for(var n=!1,r=0,i=bu(u);r<i.length;r++){var o=i[r],s=$u(o,t,e);if(0!==s)return s;n=n||o.field.O()}return 0}}var Ou,ku=(n(Pu,Ou=function(){}),Pu.create=function(t,e,n){if(t.O())return"in"===e?new Mu(t,n):new Uu(t,e,n);if(xo(n)){if("=="!==e)throw new Xr(Hr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new Pu(t,e,n)}if(Oo(n)){if("=="!==e)throw new Xr(Hr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new Pu(t,e,n)}return"array-contains"===e?new ju(t,n):"in"===e?new qu(t,n):"array-contains-any"===e?new Gu(t,n):new Pu(t,e,n)},Pu.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&go(this.value)===go(e)&&this.fn(bo(e,this.value))},Pu.prototype.fn=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case">":return 0<t;case">=":return 0<=t;default:return Dr()}},Pu.prototype.ln=function(){return 0<=["<","<=",">",">="].indexOf(this.op)},Pu);function Pu(t,e,n){var r=this;return(r=Ou.call(this)||this).field=t,r.op=e,r.value=n,r}var Lu,Ru,Cu,Vu,Fu,Uu=(n(Xu,Fu=ku),Xu.prototype.matches=function(t){var e=ei.P(t.key,this.key);return this.fn(e)},Xu),Mu=(n(Hu,Vu=ku),Hu.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},Hu),ju=(n(Wu,Cu=ku),Wu.prototype.matches=function(t){var e=t.field(this.field);return Do(e)&&wo(e.arrayValue,this.value)},Wu),qu=(n(Ku,Ru=ku),Ku.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&wo(this.value.arrayValue,e)},Ku),Gu=(n(zu,Lu=ku),zu.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!Do(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return wo(e.value.arrayValue,t)})},zu),Bu=function(t,e){this.position=t,this.before=e};function zu(t,e){return Lu.call(this,t,"array-contains-any",e)||this}function Ku(t,e){return Ru.call(this,t,"in",e)||this}function Wu(t,e){return Cu.call(this,t,"array-contains",e)||this}function Hu(t,e){var n=this;return(n=Vu.call(this,t,"in",e)||this).keys=(e.arrayValue.values||[]).map(function(t){return ei.B(t.referenceValue)}),n}function Xu(t,e,n){var r=this;return(r=Fu.call(this,t,e,n)||this).key=ei.B(n.referenceValue),r}function Qu(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return Eo(t)}).join(",")}function Yu(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.O()?ei.P(ei.B(s.referenceValue),n.key):bo(s,n.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Ju(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!mo(t.position[n],e.position[n]))return!1;return!0}var Zu=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function $u(t,e,n){var r,i,o,s,u=t.field.O()?ei.P(e.key,n.key):(r=t.field,i=n,o=e.field(r),s=i.field(r),null!==o&&null!==s?bo(o,s):Dr());switch(t.dir){case"asc":return u;case"desc":return-1*u;default:return Dr()}}var ta=(ya.prototype.wn=function(t,e,n){for(var r=n.Tn,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=ks(o,e,r[i]))}return e},ya.prototype.En=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=Ps(i,e,e,this.dn))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=Ps(a,e,o,this.dn))}return e},ya.prototype.In=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.En(t.key,n.get(t.key));e&&(i=i.nt(t.key,e))}),i},ya.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Ki())},ya.prototype.isEqual=function(t){return this.batchId===t.batchId&&Cr(this.mutations,t.mutations,function(t,e){return Ls(t,e)})&&Cr(this.baseMutations,t.baseMutations,function(t,e){return Ls(t,e)})},ya),ea=(va.from=function(t,e,n){xr(t.mutations.length===n.length);for(var r=Bi,i=t.mutations,o=0;o<i.length;o++)r=r.nt(i[o].key,n[o].version);return new va(t,e,n,r)},va),na=(da.prototype.catch=function(t){return this.next(void 0,t)},da.prototype.next=function(r,i){var o=this;return this.Vn&&Dr(),this.Vn=!0,this.gn?this.error?this.yn(i,this.error):this.pn(r,this.result):new da(function(e,n){o.Rn=function(t){o.pn(r,t).next(e,n)},o.Pn=function(t){o.yn(i,t).next(e,n)}})},da.prototype.bn=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},da.prototype.vn=function(t){try{var e=t();return e instanceof da?e:da.resolve(e)}catch(t){return da.reject(t)}},da.prototype.pn=function(t,e){return t?this.vn(function(){return t(e)}):da.resolve(e)},da.prototype.yn=function(t,e){return t?this.vn(function(){return t(e)}):da.reject(e)},da.resolve=function(n){return new da(function(t,e){t(n)})},da.reject=function(n){return new da(function(t,e){e(n)})},da.Sn=function(t){return new da(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},da.Dn=function(t){for(var n=da.resolve(!1),e=function(e){n=n.next(function(t){return t?da.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},da.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.Sn(i)},da),ra=(Object.defineProperty(pa.prototype,"readTime",{get:function(){return this.Fn},set:function(t){this.Fn=t},enumerable:!1,configurable:!0}),pa.prototype.Nn=function(t,e){this.kn(),this.readTime=e,this.Cn.set(t.key,t)},pa.prototype.xn=function(t,e){this.kn(),e&&(this.readTime=e),this.Cn.set(t,null)},pa.prototype.Mn=function(t,e){this.kn();var n=this.Cn.get(e);return void 0!==n?na.resolve(n):this.On(t,e)},pa.prototype.getEntries=function(t,e){return this.Ln(t,e)},pa.prototype.apply=function(t){return this.kn(),this.$n=!0,this.qn(t)},pa.prototype.kn=function(){},pa),ia="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",oa=(la.prototype.Un=function(t){this.Bn.push(t)},la.prototype.Wn=function(){this.Bn.forEach(function(t){return t()})},la),sa=(fa.prototype.Gn=function(e,n){var r=this;return this.jn.zn(e,n).next(function(t){return r.Hn(e,n,t)})},fa.prototype.Hn=function(t,r,i){return this.Qn.Mn(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].En(r,t);return t})},fa.prototype.Yn=function(t,e,i){var o=ji();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].En(t,e);o=o.nt(t,e)}),o},fa.prototype.Jn=function(e,t){var n=this;return this.Qn.getEntries(e,t).next(function(t){return n.Xn(e,t)})},fa.prototype.Xn=function(r,i){var o=this;return this.jn.Zn(r,i).next(function(t){var e=o.Yn(r,i,t),n=Mi();return e.forEach(function(t,e){e=e||new cu(t,Yr.min()),n=n.nt(t,e)}),n})},fa.prototype.ts=function(t,e,n){return r=e,ei.W(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.es(t,e.path):wu(e)?this.ns(t,e,n):this.ss(t,e,n);var r},fa.prototype.es=function(t,e){return this.Gn(t,new ei(e)).next(function(t){var e=Gi();return t instanceof au&&(e=e.nt(t.key,t)),e})},fa.prototype.ns=function(n,r,i){var o=this,s=r.collectionGroup,u=Gi();return this.Kn.rs(n,s).next(function(t){return na.forEach(t,function(t){var e=r.rn(t.child(s));return o.ss(n,e,i).next(function(t){t.forEach(function(t,e){u=u.nt(t,e)})})}).next(function(){return u})})},fa.prototype.ss=function(e,n,t){var h,f,r=this;return this.Qn.ts(e,n,t).next(function(t){return h=t,r.jn.os(e,n)}).next(function(t){return f=t,r.hs(e,f,h).next(function(t){h=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=h.get(u),c=Ps(s,a,a,r.dn);h=c instanceof au?h.nt(u,c):h.remove(u)}})}).next(function(){return h.forEach(function(t,e){Du(n,e)||(h=h.remove(t))}),h})},fa.prototype.hs=function(t,e,n){for(var r=Ki(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof Us&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.Qn.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof au&&(c=c.nt(t,e))}),c})},fa),ua=(ha.cs=function(t,e){for(var n=Ki(),r=Ki(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new ha(t,e.fromCache,n,r)},ha),aa=(ca.prototype._s=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},ca.prototype.next=function(){var t=++this.previousValue;return this.fs&&this.fs(t),t},ca);function ca(t,e){var n=this;this.previousValue=t,e&&(e.ls=function(t){return n._s(t)},this.fs=function(t){return e.ds(t)})}function ha(t,e,n,r){this.targetId=t,this.fromCache=e,this.as=n,this.us=r}function fa(t,e,n){this.Qn=t,this.jn=e,this.Kn=n}function la(){this.Bn=[]}function pa(){this.Cn=new Wr(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.$n=!1}function da(t){var e=this;this.Rn=null,this.Pn=null,this.result=void 0,this.error=void 0,this.gn=!1,this.Vn=!1,t(function(t){e.gn=!0,e.result=t,e.Rn&&e.Rn(t)},function(t){e.gn=!0,e.error=t,e.Pn&&e.Pn(t)})}function va(t,e,n,r){this.batch=t,this.mn=e,this.Tn=n,this.An=r}function ya(t,e,n,r){this.batchId=t,this.dn=e,this.baseMutations=n,this.mutations=r}aa.ws=-1;function ga(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}var ma=(wa.prototype.reset=function(){this.Rs=0},wa.prototype.Vs=function(){this.Rs=this.As},wa.prototype.ys=function(t){var e=this;this.cancel();var n=Math.floor(this.Rs+this.ps()),r=Math.max(0,Date.now()-this.gs),i=Math.max(0,n-r);0<i&&Ar("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Rs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ps=this.Ts.bs(this.Es,i,function(){return e.gs=Date.now(),t()}),this.Rs*=this.ms,this.Rs<this.Is&&(this.Rs=this.Is),this.Rs>this.As&&(this.Rs=this.As)},wa.prototype.vs=function(){null!==this.Ps&&(this.Ps.Ss(),this.Ps=null)},wa.prototype.cancel=function(){null!==this.Ps&&(this.Ps.cancel(),this.Ps=null)},wa.prototype.ps=function(){return(Math.random()-.5)*this.Rs},wa);function wa(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Ts=t,this.Es=e,this.Is=n,this.ms=r,this.As=i,this.Rs=0,this.Ps=null,this.gs=Date.now(),this.reset()}function ba(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Ea(e)),e=Ia(t.get(n),e);return Ea(e)}function Ia(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function Ea(t){return t+""}function Ta(t){var e=t.length;if(xr(2<=e),2===e)return xr(""===t.charAt(0)&&""===t.charAt(1)),Zr.k();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&Dr(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Dr()}o=s+2}return new Zr(r)}var Na=(xa.prototype.Cs=function(t,e){return this.Ds.add(e),na.resolve()},xa.prototype.rs=function(t,e){return na.resolve(this.Ds.getEntries(e))},xa),Aa=(Da.prototype.add=function(t){var e=t.S(),n=t.p(),r=this.index[e]||new Ri(Zr.P),i=!r.has(n);return this.index[e]=r.add(n),i},Da.prototype.has=function(t){var e=t.S(),n=t.p(),r=this.index[e];return r&&r.has(n)},Da.prototype.getEntries=function(t){return(this.index[t]||new Ri(Zr.P)).$()},Da),_a=(Sa.prototype.Cs=function(t,e){var n=this;if(this.$s.has(e))return na.resolve();var r=e.S(),i=e.p();t.Un(function(){n.$s.add(e)});var o={collectionId:r,parent:ba(i)};return Oa(t).put(o)},Sa.prototype.rs=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Vr(i),""],!1,!0);return Oa(t).Fs(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Ta(r.parent))}return o})},Sa);function Sa(){this.$s=new Aa}function Da(){this.index={}}function xa(){this.Ds=new Aa}function Oa(t){return oc.Ns(t,Fc.store)}function ka(t){this.ks=t}function Pa(t,e){if(e.document)return n=t.ks,r=e.document,i=!!e.hasCommittedMutations,o=zo(n,r.name),s=jo(r.updateTime),u=new Js({mapValue:{fields:r.fields}}),new au(o,s,u,{hasCommittedMutations:!!i});var n,r,i,o,s,u;if(e.noDocument){var a=ei.j(e.noDocument.path),c=Fa(e.noDocument.readTime);return new cu(a,c,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var h=ei.j(e.unknownDocument.path),f=Fa(e.unknownDocument.version);return new hu(h,f)}return Dr()}function La(t,e,n){var r,i,o=Ra(n),s=e.key.path.p().$();if(e instanceof au){var u={name:Bo(r=t.ks,(i=e).key),fields:i.Ze().mapValue.fields,updateTime:Uo(r,i.version.A())},a=e.hasCommittedMutations;return new Pc(null,null,u,a,o,s)}if(e instanceof cu){var c=e.key.path.$(),h=Va(e.version),f=e.hasCommittedMutations;return new Pc(null,new Oc(c,h),null,f,o,s)}if(e instanceof hu){var l=e.key.path.$(),p=Va(e.version);return new Pc(new kc(l,p),null,null,!0,o,s)}return Dr()}function Ra(t){var e=t.A();return[e.seconds,e.nanoseconds]}function Ca(t){var e=new Qr(t[0],t[1]);return Yr.I(e)}function Va(t){var e=t.A();return new Tc(e.seconds,e.nanoseconds)}function Fa(t){var e=new Qr(t.seconds,t.nanoseconds);return Yr.I(e)}function Ua(e,t){var n=(t.baseMutations||[]).map(function(t){return Jo(e.ks,t)}),r=t.mutations.map(function(t){return Jo(e.ks,t)}),i=Qr.fromMillis(t.localWriteTimeMs);return new ta(t.batchId,i,n,r)}function Ma(t){var e,n,r=Fa(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?Fa(t.lastLimboFreeSnapshotVersion):Yr.min();return e=void 0!==t.query.documents?(xr(1===(n=t.query).documents.length),Iu(mu(Wo(n.documents[0])))):function(t){var e=Wo(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){xr(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=function e(t){return t?void 0!==t.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=rs(t.unaryFilter.field);return ku.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=rs(t.unaryFilter.field);return ku.create(n,"==",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Dr()}}(t)]:void 0!==t.fieldFilter?[(n=t,ku.create(rs(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Dr()}}(),n.fieldFilter.value))]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e(t)}).reduce(function(t,e){return t.concat(e)}):Dr():[];var n}(n.where));var u=[];n.orderBy&&(u=n.orderBy.map(function(t){return new Zu(rs((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}));var a,c,h=null;n.limit&&(a=n.limit,h=hi(c="object"==typeof a?a.value:a)?null:c);var f=null;n.startAt&&(f=es(n.startAt));var l=null;return n.endAt&&(l=es(n.endAt)),Iu(gu(e,i,u,s,h,"F",f,l))}(t.query),new Ti(e,t.targetId,0,t.lastListenSequenceNumber,r,i,mi.fromBase64String(t.resumeToken))}function ja(t,e){var n,r=Va(e.X),i=Va(e.lastLimboFreeSnapshotVersion);n=(gi(e.target)?Zo:$o)(t.ks,e.target);var o=e.resumeToken.toBase64();return new Rc(e.targetId,vi(e.target),r,o,e.sequenceNumber,i,n)}var qa,Ga=(Ba.prototype.Nn=function(t,e,n){return Ka(t).put(Wa(e),n)},Ba.prototype.xn=function(t,e){var n=Ka(t),r=Wa(e);return n.delete(r)},Ba.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.xs(e,t)})},Ba.prototype.Mn=function(t,e){var n=this;return Ka(t).get(Wa(e)).next(function(t){return n.Ms(t)})},Ba.prototype.Os=function(t,e){var n=this;return Ka(t).get(Wa(e)).next(function(t){var e=n.Ms(t);return e?{Ls:e,size:Ha(t)}:null})},Ba.prototype.getEntries=function(t,e){var r=this,i=ji();return this.qs(t,e,function(t,e){var n=r.Ms(e);i=i.nt(t,n)}).next(function(){return i})},Ba.prototype.Bs=function(t,e){var r=this,i=ji(),o=new Si(ei.P);return this.qs(t,e,function(t,e){var n=r.Ms(e);o=n?(i=i.nt(t,n),o.nt(t,Ha(e))):(i=i.nt(t,null),o.nt(t,0))}).next(function(){return{Us:i,Ws:o}})},Ba.prototype.qs=function(t,e,i){if(e._())return na.resolve();var n=IDBKeyRange.bound(e.first().path.$(),e.last().path.$()),o=e.at(),s=o.dt();return Ka(t).Qs({range:n},function(t,e,n){for(var r=ei.j(t);s&&ei.P(s,r)<0;)i(s,null),s=o.dt();s&&s.isEqual(r)&&(i(s,e),s=o.wt()?o.dt():null),s?n.js(s.path.$()):n.done()}).next(function(){for(;s;)i(s,null),s=o.wt()?o.dt():null})},Ba.prototype.ts=function(t,i,e){var o=this,s=Gi(),u=i.path.length+1,n={};if(e.isEqual(Yr.min())){var r=i.path.$();n.range=IDBKeyRange.lowerBound(r)}else{var a=i.path.$(),c=Ra(e);n.range=IDBKeyRange.lowerBound([a,c],!0),n.index=Pc.collectionReadTimeIndex}return Ka(t).Qs(n,function(t,e,n){if(t.length===u){var r=Pa(o.serializer,e);i.path.D(r.key.path)?r instanceof au&&Du(i,r)&&(s=s.nt(r.key,r)):n.done()}}).next(function(){return s})},Ba.prototype.Ks=function(t,e){var r=this,i=Mi(),o=Ra(e),n=Ka(t),s=IDBKeyRange.lowerBound(o,!0);return n.Qs({index:Pc.readTimeIndex,range:s},function(t,e){var n=Pa(r.serializer,e);i=i.nt(n.key,n),o=e.readTime}).next(function(){return{Gs:i,readTime:Ca(o)}})},Ba.prototype.zs=function(t){var e=Ka(t),r=Yr.min();return e.Qs({index:Pc.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=Ca(e.readTime)),n.done()}).next(function(){return r})},Ba.prototype.Hs=function(t){return new Ba.Ys(this,!!t&&t.Js)},Ba.prototype.Xs=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Ba.prototype.getMetadata=function(t){return za(t).get(Lc.key).next(function(t){return xr(!!t),t})},Ba.prototype.xs=function(t,e){return za(t).put(Lc.key,e)},Ba.prototype.Ms=function(t){if(t){var e=Pa(this.serializer,t);return e instanceof cu&&e.version.isEqual(Yr.min())?null:e}return null},Ba);function Ba(t,e){this.serializer=t,this.Kn=e}function za(t){return oc.Ns(t,Lc.store)}function Ka(t){return oc.Ns(t,Pc.store)}function Wa(t){return t.path.$()}function Ha(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Dr();e=t.noDocument}return JSON.stringify(e).length}function Xa(t,e){var n=this;return(n=qa.call(this)||this).Zs=t,n.Js=e,n.ti=new Wr(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}Ga.Ys=(n(Xa,qa=ra),Xa.prototype.qn=function(s){var u=this,a=[],c=0,h=new Ri(function(t,e){return Rr(t.F(),e.F())});return this.Cn.forEach(function(t,e){var n=u.ti.get(t);if(e){var r=La(u.Zs.serializer,e,u.readTime);h=h.add(t.path.p());var i=Ha(r);c+=i-n,a.push(u.Zs.Nn(s,t,r))}else if(c-=n,u.Js){var o=La(u.Zs.serializer,new cu(t,Yr.min()),u.readTime);a.push(u.Zs.Nn(s,t,o))}else a.push(u.Zs.xn(s,t))}),h.forEach(function(t){a.push(u.Zs.Kn.Cs(s,t))}),a.push(this.Zs.updateMetadata(s,c)),na.Sn(a)},Xa.prototype.On=function(t,e){var n=this;return this.Zs.Os(t,e).next(function(t){return null===t?(n.ti.set(e,0),null):(n.ti.set(e,t.size),t.Ls)})},Xa.prototype.Ln=function(t,e){var n=this;return this.Zs.Bs(t,e).next(function(t){var e=t.Us;return t.Ws.forEach(function(t,e){n.ti.set(t,e)}),e})},Xa);var Qa=(Za.prototype.next=function(){return this.ei+=2,this.ei},Za.ni=function(){return new Za(0)},Za.si=function(){return new Za(-1)},Za),Ya=(Ja.prototype.ri=function(n){var r=this;return this.oi(n).next(function(t){var e=new Qa(t.highestTargetId);return t.highestTargetId=e.next(),r.hi(n,t).next(function(){return t.highestTargetId})})},Ja.prototype.ai=function(t){return this.oi(t).next(function(t){return Yr.I(new Qr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},Ja.prototype.ui=function(t){return this.oi(t).next(function(t){return t.highestListenSequenceNumber})},Ja.prototype.ci=function(e,n,r){var i=this;return this.oi(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.A()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.hi(e,t)})},Ja.prototype.li=function(e,n){var r=this;return this._i(e,n).next(function(){return r.oi(e).next(function(t){return t.targetCount+=1,r.fi(n,t),r.hi(e,t)})})},Ja.prototype.di=function(t,e){return this._i(t,e)},Ja.prototype.wi=function(e,t){var n=this;return this.Ti(e,t.targetId).next(function(){return $a(e).delete(t.targetId)}).next(function(){return n.oi(e)}).next(function(t){return xr(0<t.targetCount),--t.targetCount,n.hi(e,t)})},Ja.prototype.Ei=function(r,i,o){var s=this,u=0,a=[];return $a(r).Qs(function(t,e){var n=Ma(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(u++,a.push(s.wi(r,n)))}).next(function(){return na.Sn(a)}).next(function(){return u})},Ja.prototype.pe=function(t,r){return $a(t).Qs(function(t,e){var n=Ma(e);r(n)})},Ja.prototype.oi=function(t){return tc(t).get(Vc.key).next(function(t){return xr(null!==t),t})},Ja.prototype.hi=function(t,e){return tc(t).put(Vc.key,e)},Ja.prototype._i=function(t,e){return $a(t).put(ja(this.serializer,e))},Ja.prototype.fi=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Ja.prototype.Ii=function(t){return this.oi(t).next(function(t){return t.targetCount})},Ja.prototype.mi=function(t,i){var e=vi(i),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),o=null;return $a(t).Qs({range:n,index:Rc.queryTargetsIndexName},function(t,e,n){var r=Ma(e);yi(i,r.target)&&(o=r,n.done())}).next(function(){return o})},Ja.prototype.Ai=function(n,t,r){var i=this,o=[],s=ec(n);return t.forEach(function(t){var e=ba(t.path);o.push(s.put(new Cc(r,e))),o.push(i.ii.Ri(n,r,t))}),na.Sn(o)},Ja.prototype.Pi=function(n,t,r){var i=this,o=ec(n);return na.forEach(t,function(t){var e=ba(t.path);return na.Sn([o.delete([r,e]),i.ii.gi(n,r,t)])})},Ja.prototype.Ti=function(t,e){var n=ec(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},Ja.prototype.Vi=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=ec(t),o=Ki();return r.Qs({range:n,yi:!0},function(t,e,n){var r=Ta(t[1]),i=new ei(r);o=o.add(i)}).next(function(){return o})},Ja.prototype.pi=function(t,e){var n=ba(e.path),r=IDBKeyRange.bound([n],[Vr(n)],!1,!0),i=0;return ec(t).Qs({index:Cc.documentTargetsIndex,yi:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},Ja.prototype.Me=function(t,e){return $a(t).get(e).next(function(t){return t?Ma(t):null})},Ja);function Ja(t,e){this.ii=t,this.serializer=e}function Za(t){this.ei=t}function $a(t){return oc.Ns(t,Rc.store)}function tc(t){return oc.Ns(t,Vc.store)}function ec(t){return oc.Ns(t,Cc.store)}var nc,rc="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",ic=(n(uc,nc=oa),uc),oc=(sc.Ns=function(t,e){if(t instanceof ic)return Gc.Ns(t.bi,e);throw Dr()},sc.prototype.start=function(){var e=this;return Gc.Ui(this.Li,Ic,new Ec(this.serializer)).then(function(t){return e.Wi=t,e.Qi()}).then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new Xr(Hr.FAILED_PRECONDITION,rc);return e.ji(),e.Ki(),e.Gi(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.qi.ui(t)})}).then(function(t){e.Ci=new aa(t,e.Si)}).then(function(){e.$i=!0}).catch(function(t){return e.Wi&&e.Wi.close(),Promise.reject(t)})},sc.prototype.zi=function(n){var t=this;return this.Mi=function(e){return g(t,void 0,void 0,function(){return w(this,function(t){return this.Hi?[2,n(e)]:[2]})})},n(this.isPrimary)},sc.prototype.Yi=function(n){var t=this;this.Wi.Ji(function(e){return g(t,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},sc.prototype.Xi=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Ts.Zi(function(){return g(e,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Hi?[4,this.Qi()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},sc.prototype.Qi=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return cc(e).put(new Mc(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.tr(e).next(function(t){t||(n.isPrimary=!1,n.Ts.er(function(){return n.Mi(!1)}))})}).next(function(){return n.nr(e)}).next(function(t){return n.isPrimary&&!t?n.sr(e).next(function(){return!1}):!!t&&n.ir(e).next(function(){return!0})})}).catch(function(t){if(Xc(t))return Ar("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return Ar("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.Ts.er(function(){return n.Mi(t)}),n.isPrimary=t})},sc.prototype.tr=function(t){var e=this;return ac(t).get(Nc.key).next(function(t){return na.resolve(e.rr(t))})},sc.prototype.or=function(t){return cc(t).delete(this.clientId)},sc.prototype.hr=function(){return g(this,void 0,void 0,function(){var e,n,r,i,o=this;return w(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.ar(this.xi,18e5)?[3,2]:(this.xi=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=sc.Ns(t,Mc.store);return r.Fs().next(function(t){var e=o.ur(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return na.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.Bi)for(n=0,r=e;n<r.length;n++)i=r[n],this.Bi.removeItem(this.cr(i.clientId));t.label=2;case 2:return[2]}})})},sc.prototype.Gi=function(){var t=this;this.ki=this.Ts.bs("client_metadata_refresh",4e3,function(){return t.Qi().then(function(){return t.hr()}).then(function(){return t.Gi()})})},sc.prototype.rr=function(t){return!!t&&t.ownerId===this.clientId},sc.prototype.nr=function(e){var i=this;return this.Di?na.resolve(!0):ac(e).get(Nc.key).next(function(t){if(null!==t&&i.ar(t.leaseTimestampMs,5e3)&&!i.lr(t.ownerId)){if(i.rr(t)&&i.networkEnabled)return!0;if(!i.rr(t)){if(!t.allowTabSynchronization)throw new Xr(Hr.FAILED_PRECONDITION,rc);return!1}}return!(!i.networkEnabled||!i.inForeground)||cc(e).Fs().next(function(t){return void 0===i.ur(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Ar("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},sc.prototype._r=function(){return g(this,void 0,void 0,function(){var e=this;return w(this,function(t){switch(t.label){case 0:return this.$i=!1,this.dr(),this.ki&&(this.ki.cancel(),this.ki=null),this.wr(),this.Tr(),[4,this.runTransaction("shutdown","readwrite",function(t){return e.sr(t).next(function(){return e.or(t)})}).catch(function(t){Ar("IndexedDbPersistence","Proceeding with shutdown despite failure: ",t)})];case 1:return t.sent(),this.Wi.close(),this.Er(),[2]}})})},sc.prototype.ur=function(t,e){var n=this;return t.filter(function(t){return n.ar(t.updateTimeMs,e)&&!n.lr(t.clientId)})},sc.prototype.Ir=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return cc(t).Fs().next(function(t){return e.ur(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(sc.prototype,"Hi",{get:function(){return this.$i},enumerable:!1,configurable:!0}),sc.prototype.mr=function(t){return dc.Ar(t,this.serializer,this.Kn,this.ii)},sc.prototype.Rr=function(){return this.qi},sc.prototype.Pr=function(){return this.Qn},sc.prototype.gr=function(){return this.Kn},sc.prototype.runTransaction=function(e,n,r){var i=this;Ar("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.Wi.runTransaction(t,qc,function(t){return o=new ic(t,i.Ci?i.Ci.next():aa.ws),"readwrite-primary"===n?i.tr(o).next(function(t){return!!t||i.nr(o)}).next(function(t){if(!t)throw _r("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.Ts.er(function(){return i.Mi(!1)}),new Xr(Hr.FAILED_PRECONDITION,ia);return r(o)}).next(function(t){return i.ir(o).next(function(){return t})}):i.Vr(o).next(function(){return r(o)})}).then(function(t){return o.Wn(),t})},sc.prototype.Vr=function(t){var e=this;return ac(t).get(Nc.key).next(function(t){if(null!==t&&e.ar(t.leaseTimestampMs,5e3)&&!e.lr(t.ownerId)&&!e.rr(t)&&!(e.Di||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Xr(Hr.FAILED_PRECONDITION,rc)})},sc.prototype.ir=function(t){var e=new Nc(this.clientId,this.allowTabSynchronization,Date.now());return ac(t).put(Nc.key,e)},sc.Oi=function(){return Gc.Oi()},sc.prototype.sr=function(t){var e=this,n=ac(t);return n.get(Nc.key).next(function(t){return e.rr(t)?(Ar("IndexedDbPersistence","Releasing primary lease."),n.delete(Nc.key)):na.resolve()})},sc.prototype.ar=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(_r("Detected an update time that is in the future: "+t+" > "+n),1))},sc.prototype.ji=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ni=function(){t.Ts.Zi(function(){return t.inForeground="visible"===t.document.visibilityState,t.Qi()})},this.document.addEventListener("visibilitychange",this.Ni),this.inForeground="visible"===this.document.visibilityState)},sc.prototype.wr=function(){this.Ni&&(this.document.removeEventListener("visibilitychange",this.Ni),this.Ni=null)},sc.prototype.Ki=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fi=function(){e.dr(),e.Ts.Zi(function(){return e._r()})},this.window.addEventListener("unload",this.Fi))},sc.prototype.Tr=function(){this.Fi&&(this.window.removeEventListener("unload",this.Fi),this.Fi=null)},sc.prototype.lr=function(t){var e;try{var n=null!==(null===(e=this.Bi)||void 0===e?void 0:e.getItem(this.cr(t)));return Ar("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return _r("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},sc.prototype.dr=function(){if(this.Bi)try{this.Bi.setItem(this.cr(this.clientId),String(Date.now()))}catch(t){_r("Failed to set zombie client id.",t)}},sc.prototype.Er=function(){if(this.Bi)try{this.Bi.removeItem(this.cr(this.clientId))}catch(t){}},sc.prototype.cr=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},sc);function sc(t,e,n,r,i,o,s,u,a,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Ts=i,this.window=o,this.document=s,this.Si=a,this.Di=c,this.Ci=null,this.$i=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fi=null,this.inForeground=!1,this.Ni=null,this.ki=null,this.xi=Number.NEGATIVE_INFINITY,this.Mi=function(t){return Promise.resolve()},!sc.Oi())throw new Xr(Hr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.ii=new hc(this,r),this.Li=e+"main",this.serializer=new ka(u),this.qi=new Ya(this.ii,this.serializer),this.Kn=new _a,this.Qn=new Ga(this.serializer,this.Kn),this.window&&this.window.localStorage?this.Bi=this.window.localStorage:(this.Bi=null,!1===c&&_r("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function uc(t,e){var n=this;return(n=nc.call(this)||this).bi=t,n.vi=e,n}function ac(t){return oc.Ns(t,Nc.store)}function cc(t){return oc.Ns(t,Mc.store)}var hc=(fc.prototype.pr=function(t){var n=this.br(t);return this.db.Rr().Ii(t).next(function(e){return n.next(function(t){return e+t})})},fc.prototype.br=function(t){var e=0;return this.vr(t,function(t){e++}).next(function(){return e})},fc.prototype.pe=function(t,e){return this.db.Rr().pe(t,e)},fc.prototype.vr=function(t,n){return this.Sr(t,function(t,e){return n(e)})},fc.prototype.Ri=function(t,e,n){return lc(t,n)},fc.prototype.gi=function(t,e,n){return lc(t,n)},fc.prototype.Ei=function(t,e,n){return this.db.Rr().Ei(t,e,n)},fc.prototype.Dr=function(t,e){return lc(t,e)},fc.prototype.Cr=function(t,e){return r=e,i=!1,bc(n=t).$r(function(t){return yc(n,t,r).next(function(t){return t&&(i=!0),na.resolve(!t)})}).next(function(){return i});var n,r,i},fc.prototype.Fr=function(r,i){var o=this,s=this.db.Pr().Hs(),u=[],a=0;return this.Sr(r,function(e,t){if(t<=i){var n=o.Cr(r,e).next(function(t){if(!t)return a++,s.Mn(r,e).next(function(){return s.xn(e),ec(r).delete([0,ba(e.path)])})});u.push(n)}}).next(function(){return na.Sn(u)}).next(function(){return s.apply(r)}).next(function(){return a})},fc.prototype.removeTarget=function(t,e){var n=e.Z(t.vi);return this.db.Rr().di(t,n)},fc.prototype.Nr=function(t,e){return lc(t,e)},fc.prototype.Sr=function(t,o){var s,e=ec(t),u=aa.ws;return e.Qs({index:Cc.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(u!==aa.ws&&o(new ei(Ta(s)),u),u=i,s=r):u=aa.ws}).next(function(){u!==aa.ws&&o(new ei(Ta(s)),u)})},fc.prototype.kr=function(t){return this.db.Pr().Xs(t)},fc);function fc(t,e){this.db=t,this.yr=new vh(this,e)}function lc(t,e){return ec(t).put((n=e,r=t.vi,new Cc(0,ba(n.path),r)));var n,r}function pc(t,e){var n=t.projectId;return t.i||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var dc=(vc.Ar=function(t,e,n,r){return xr(""!==t.uid),new vc(t.Mr()?t.uid:"",e,n,r)},vc.prototype.Or=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return mc(t).Qs({index:Sc.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},vc.prototype.Lr=function(c,h,f,l){var p=this,d=wc(c),v=mc(c);return v.add({}).next(function(t){xr("number"==typeof t);for(var e=new ta(t,h,f,l),n=function(e,t,n){var r=n.baseMutations.map(function(t){return Yo(e.ks,t)}),i=n.mutations.map(function(t){return Yo(e.ks,t)});return new Sc(t,n.batchId,n.dn.toMillis(),r,i)}(p.serializer,p.userId,e),r=[],i=new Ri(function(t,e){return Rr(t.F(),e.F())}),o=0,s=l;o<s.length;o++){var u=s[o],a=Dc.key(p.userId,u.key.path,t);i=i.add(u.key.path.p()),r.push(v.put(n)),r.push(d.put(a,Dc.PLACEHOLDER))}return i.forEach(function(t){r.push(p.Kn.Cs(c,t))}),c.Un(function(){p.xr[t]=e.keys()}),na.Sn(r).next(function(){return e})})},vc.prototype.qr=function(t,e){var n=this;return mc(t).get(e).next(function(t){return t?(xr(t.userId===n.userId),Ua(n.serializer,t)):null})},vc.prototype.Br=function(t,n){var r=this;return this.xr[n]?na.resolve(this.xr[n]):this.qr(t,n).next(function(t){if(t){var e=t.keys();return r.xr[n]=e}return null})},vc.prototype.Ur=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return mc(t).Qs({index:Sc.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(xr(e.batchId>=i),o=Ua(r.serializer,e)),n.done()}).next(function(){return o})},vc.prototype.Wr=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return mc(t).Qs({index:Sc.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},vc.prototype.Qr=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return mc(t).Fs(Sc.userMutationsIndex,n).next(function(t){return t.map(function(t){return Ua(e.serializer,t)})})},vc.prototype.zn=function(u,a){var c=this,t=Dc.prefixForPath(this.userId,a.path),e=IDBKeyRange.lowerBound(t),h=[];return wc(u).Qs({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Ta(i);if(r===c.userId&&a.path.isEqual(s))return mc(u).get(o).next(function(t){if(!t)throw Dr();xr(t.userId===c.userId),h.push(Ua(c.serializer,t))});n.done()}).next(function(){return h})},vc.prototype.Zn=function(r,t){var a=this,c=new Ri(Rr),i=[];return t.forEach(function(u){var t=Dc.prefixForPath(a.userId,u.path),e=IDBKeyRange.lowerBound(t),n=wc(r).Qs({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Ta(i);r===a.userId&&u.path.isEqual(s)?c=c.add(o):n.done()});i.push(n)}),na.Sn(i).next(function(){return a.jr(r,c)})},vc.prototype.os=function(t,e){var u=this,a=e.path,c=a.length+1,n=Dc.prefixForPath(this.userId,a),r=IDBKeyRange.lowerBound(n),h=new Ri(Rr);return wc(t).Qs({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Ta(i);r===u.userId&&a.D(s)?s.length===c&&(h=h.add(o)):n.done()}).next(function(){return u.jr(t,h)})},vc.prototype.jr=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(mc(e).get(t).next(function(t){if(null===t)throw Dr();xr(t.userId===n.userId),r.push(Ua(n.serializer,t))}))}),na.Sn(i).next(function(){return r})},vc.prototype.Kr=function(e,n){var r=this;return gc(e.bi,this.userId,n).next(function(t){return e.Un(function(){r.Gr(n.batchId)}),na.forEach(t,function(t){return r.ii.Dr(e,t)})})},vc.prototype.Gr=function(t){delete this.xr[t]},vc.prototype.zr=function(n){var o=this;return this.Or(n).next(function(t){if(!t)return na.resolve();var e=IDBKeyRange.lowerBound(Dc.prefixForUser(o.userId)),i=[];return wc(n).Qs({range:e},function(t,e,n){if(t[0]===o.userId){var r=Ta(t[1]);i.push(r)}else n.done()}).next(function(){xr(0===i.length)})})},vc.prototype.pi=function(t,e){return yc(t,this.userId,e)},vc.prototype.Hr=function(t){var e=this;return bc(t).get(this.userId).next(function(t){return t||new _c(e.userId,-1,"")})},vc);function vc(t,e,n,r){this.userId=t,this.serializer=e,this.Kn=n,this.ii=r,this.xr={}}function yc(t,o,e){var n=Dc.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),u=!1;return wc(t).Qs({range:r,yi:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function gc(t,e,n){var r=t.store(Sc.store),i=t.store(Dc.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.Qs({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){xr(1===u)}));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=Dc.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return na.Sn(o).next(function(){return c})}function mc(t){return oc.Ns(t,Sc.store)}function wc(t){return oc.Ns(t,Dc.store)}function bc(t){return oc.Ns(t,_c.store)}var Ic=10,Ec=(Ac.prototype.createOrUpgrade=function(n,r,t,e){var i=this;xr(t<e&&0<=t&&e<=Ic);var o,s=new Qc(r);t<1&&1<=e&&(n.createObjectStore(Nc.store),(o=n).createObjectStore(_c.store,{keyPath:_c.keyPath}),o.createObjectStore(Sc.store,{keyPath:Sc.keyPath,autoIncrement:!0}).createIndex(Sc.userMutationsIndex,Sc.userMutationsKeyPath,{unique:!0}),o.createObjectStore(Dc.store),Uc(n),n.createObjectStore(Pc.store));var u,a=na.resolve();return t<3&&3<=e&&(0!==t&&((u=n).deleteObjectStore(Cc.store),u.deleteObjectStore(Rc.store),u.deleteObjectStore(Vc.store),Uc(n)),a=a.next(function(){return t=s.store(Vc.store),e=new Vc(0,0,Yr.min().A(),0),t.put(Vc.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(a=a.next(function(){return r=n,(i=s).store(Sc.store).Fs().next(function(t){r.deleteObjectStore(Sc.store),r.createObjectStore(Sc.store,{keyPath:Sc.keyPath,autoIncrement:!0}).createIndex(Sc.userMutationsIndex,Sc.userMutationsKeyPath,{unique:!0});var e=i.store(Sc.store),n=t.map(function(t){return e.put(t)});return na.Sn(n)});var r,i})),a=a.next(function(){n.createObjectStore(Mc.store,{keyPath:Mc.keyPath})})),t<5&&5<=e&&(a=a.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(a=a.next(function(){return n.createObjectStore(Lc.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(a=a.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(a=a.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(a=a.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(Pc.store)).createIndex(Pc.readTimeIndex,Pc.readTimeIndexPath,{unique:!1}),t.createIndex(Pc.collectionReadTimeIndex,Pc.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=e&&(a=a.next(function(){return i.rewriteCanonicalIds(s)})),a},Ac.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Pc.store).Qs(function(t,e){n+=Ha(e)}).next(function(){var t=new Lc(n);return e.store(Lc.store).put(Lc.key,t)})},Ac.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(_c.store),e=r.store(Sc.store);return t.Fs().next(function(t){return na.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.Fs(Sc.userMutationsIndex,t).next(function(t){return na.forEach(t,function(t){xr(t.userId===n.userId);var e=Ua(i.serializer,t);return gc(r,n.userId,e).next(function(){})})})})})},Ac.prototype.ensureSequenceNumbers=function(t){var s=t.store(Cc.store),e=t.store(Pc.store);return t.store(Vc.store).get(Vc.key).next(function(i){var o=[];return e.Qs(function(t,e){var n=new Zr(t),r=[0,ba(n)];o.push(s.get(r).next(function(t){return t?na.resolve():(e=n,s.put(new Cc(0,ba(e),i.highestListenSequenceNumber)));var e}))}).next(function(){return na.Sn(o)})})},Ac.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.S(),n=t.p();return r.put({collectionId:e,parent:ba(n)})}}t.createObjectStore(Fc.store,{keyPath:Fc.keyPath});var r=e.store(Fc.store),o=new Aa;return e.store(Pc.store).Qs({yi:!0},function(t,e){var n=new Zr(t);return i(n.p())}).next(function(){return e.store(Dc.store).Qs({yi:!0},function(t,e){t[0];var n=t[1],r=(t[2],Ta(n));return i(r.p())})})},Ac.prototype.rewriteCanonicalIds=function(t){var i=this,o=t.store(Rc.store);return o.Qs(function(t,e){var n=Ma(e),r=ja(i.serializer,n);return o.put(r)})},Ac),Tc=function(t,e){this.seconds=t,this.nanoseconds=e},Nc=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function Ac(t){this.serializer=t}Nc.store="owner",Nc.key="owner";var _c=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};_c.store="mutationQueues",_c.keyPath="userId";var Sc=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Sc.store="mutations",Sc.keyPath="batchId",Sc.userMutationsIndex="userMutationsIndex",Sc.userMutationsKeyPath=["userId","batchId"];var Dc=(xc.prefixForUser=function(t){return[t]},xc.prefixForPath=function(t,e){return[t,ba(e)]},xc.key=function(t,e,n){return[t,ba(e),n]},xc);function xc(){}Dc.store="documentMutations",Dc.PLACEHOLDER=new Dc;var Oc=function(t,e){this.path=t,this.readTime=e},kc=function(t,e){this.path=t,this.version=e},Pc=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Pc.store="remoteDocuments",Pc.readTimeIndex="readTimeIndex",Pc.readTimeIndexPath="readTime",Pc.collectionReadTimeIndex="collectionReadTimeIndex",Pc.collectionReadTimeIndexPath=["parentPath","readTime"];var Lc=function(t){this.byteSize=t};Lc.store="remoteDocumentGlobal",Lc.key="remoteDocumentGlobalKey";var Rc=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Rc.store="targets",Rc.keyPath="targetId",Rc.queryTargetsIndexName="queryTargetsIndex",Rc.queryTargetsKeyPath=["canonicalId","targetId"];var Cc=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Cc.store="targetDocuments",Cc.keyPath=["targetId","path"],Cc.documentTargetsIndex="documentTargetsIndex",Cc.documentTargetsKeyPath=["path","targetId"];var Vc=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Vc.key="targetGlobalKey",Vc.store="targetGlobal";var Fc=function(t,e){this.collectionId=t,this.parent=e};function Uc(t){t.createObjectStore(Cc.store,{keyPath:Cc.keyPath}).createIndex(Cc.documentTargetsIndex,Cc.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Rc.store,{keyPath:Rc.keyPath}).createIndex(Rc.queryTargetsIndexName,Rc.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Vc.store)}Fc.store="collectionParents",Fc.keyPath=["collectionId","parent"];var Mc=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Mc.store="clientMetadata",Mc.keyPath="clientId";var jc,qc=d(d(d([_c.store,Sc.store,Dc.store,Pc.store,Rc.store,Nc.store,Vc.store,Cc.store],[Mc.store]),[Lc.store]),[Fc.store]),Gc=(Hc.Ui=function(o,t,s){return Ar("SimpleDb","Opening database:",o),new na(function(n,r){var i=indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new Hc(e))},i.onblocked=function(){r(new Xr(Hr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new Xr(Hr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Ar("SimpleDb",'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;s.createOrUpgrade(e,i.transaction,t.oldVersion,Ic).next(function(){Ar("SimpleDb","Database upgrade to version "+Ic+" complete")})}}).bn()},Hc.delete=function(t){return Ar("SimpleDb","Removing database:",t),$c(window.indexedDB.deleteDatabase(t)).bn()},Hc.Oi=function(){if("undefined"==typeof indexedDB)return!1;if(Hc.Jr())return!0;var t=v(),e=Hc.Yr(t),n=0<e&&e<10,r=Hc.Xr(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Hc.Jr=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Zr)},Hc.Ns=function(t,e){return t.store(e)},Hc.Yr=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Hc.Xr=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Hc.prototype.Ji=function(e){this.db.onversionchange=function(t){return e(t)}},Hc.prototype.runTransaction=function(r,c,h){return g(this,void 0,void 0,function(){var s,u,e,a,n;return w(this,function(t){switch(t.label){case 0:s="readonly"===r,u=0,e=function(){var e,n,r,i,o;return w(this,function(t){switch(t.label){case 0:++u,e=Qc.open(a.db,s?"readonly":"readwrite",c),t.label=1;case 1:return t.trys.push([1,3,,4]),n=h(e).catch(function(t){return e.abort(t),na.reject(t)}).bn(),r={},n.catch(function(){}),[4,e.to];case 2:return[2,(r.value=(t.sent(),n),r)];case 3:return i=t.sent(),o="FirebaseError"!==i.name&&u<3,Ar("SimpleDb","Transaction failed with error: %s. Retrying: %s.",i.message,o),o?[3,4]:[2,{value:Promise.reject(i)}];case 4:return[2]}})},a=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(n=t.sent()))return[2,n.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},Hc.prototype.close=function(){this.db.close()},Hc),Bc=(Object.defineProperty(Wc.prototype,"gn",{get:function(){return this.no},enumerable:!1,configurable:!0}),Object.defineProperty(Wc.prototype,"io",{get:function(){return this.so},enumerable:!1,configurable:!0}),Object.defineProperty(Wc.prototype,"cursor",{set:function(t){this.eo=t},enumerable:!1,configurable:!0}),Wc.prototype.done=function(){this.no=!0},Wc.prototype.js=function(t){this.so=t},Wc.prototype.delete=function(){return $c(this.eo.delete())},Wc),zc=(n(Kc,jc=Xr),Kc);function Kc(t){var e=this;return(e=jc.call(this,Hr.UNAVAILABLE,"IndexedDB transaction failed: "+t)||this).name="IndexedDbTransactionError",e}function Wc(t){this.eo=t,this.no=!1,this.so=null}function Hc(t){this.db=t,12.2===Hc.Yr(v())&&_r("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Xc(t){return"IndexedDbTransactionError"===t.name}var Qc=(Zc.open=function(t,e,n){return new Zc(t.transaction(n,e))},Object.defineProperty(Zc.prototype,"to",{get:function(){return this.ro.promise},enumerable:!1,configurable:!0}),Zc.prototype.abort=function(t){t&&this.ro.reject(t),this.aborted||(Ar("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Zc.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Yc(e)},Zc),Yc=(Jc.prototype.put=function(t,e){return $c(void 0!==e?(Ar("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Ar("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Jc.prototype.add=function(t){return Ar("SimpleDb","ADD",this.store.name,t,t),$c(this.store.add(t))},Jc.prototype.get=function(e){var n=this;return $c(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Ar("SimpleDb","GET",n.store.name,e,t),t})},Jc.prototype.delete=function(t){return Ar("SimpleDb","DELETE",this.store.name,t),$c(this.store.delete(t))},Jc.prototype.count=function(){return Ar("SimpleDb","COUNT",this.store.name),$c(this.store.count())},Jc.prototype.Fs=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.oo(n,function(t,e){r.push(e)}).next(function(){return r})},Jc.prototype.ho=function(t,e){Ar("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.yi=!1;var r=this.cursor(n);return this.oo(r,function(t,e,n){return n.delete()})},Jc.prototype.Qs=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.oo(r,e)},Jc.prototype.$r=function(i){var t=this.cursor({});return new na(function(n,r){t.onerror=function(t){var e=eh(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},Jc.prototype.oo=function(t,s){var u=[];return new na(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new Bc(e),r=s(e.primaryKey,e.value,n);if(r instanceof na){var i=r.catch(function(t){return n.done(),na.reject(t)});u.push(i)}n.gn?o():null===n.io?e.continue():e.continue(n.io)}else o()}}).next(function(){return na.Sn(u)})},Jc.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},Jc.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.yi?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Jc);function Jc(t){this.store=t}function Zc(t){var n=this;this.transaction=t,this.aborted=!1,this.ro=new ga,this.transaction.oncomplete=function(){n.ro.resolve()},this.transaction.onabort=function(){t.error?n.ro.reject(new zc(t.error)):n.ro.resolve()},this.transaction.onerror=function(t){var e=eh(t.target.error);n.ro.reject(new zc(e))}}function $c(t){return new na(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=eh(t.target.error);r(e)}})}var th=!1;function eh(t){var e=Gc.Yr(v());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Xr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return th||(th=!0,setTimeout(function(){throw r},0)),r}}return t}function nh(){return"undefined"!=typeof window?window:null}var rh=(sh._o=function(t,e,n,r,i){var o=new sh(t,e,Date.now()+n,r,i);return o.start(n),o},sh.prototype.start=function(t){var e=this;this.fo=setTimeout(function(){return e.do()},t)},sh.prototype.Ss=function(){return this.do()},sh.prototype.cancel=function(t){null!==this.fo&&(this.clearTimeout(),this.lo.reject(new Xr(Hr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},sh.prototype.do=function(){var e=this;this.ao.Zi(function(){return null!==e.fo?(e.clearTimeout(),e.op().then(function(t){return e.lo.resolve(t)})):Promise.resolve()})},sh.prototype.clearTimeout=function(){null!==this.fo&&(this.co(this),clearTimeout(this.fo),this.fo=null)},sh),ih=(Object.defineProperty(oh.prototype,"yo",{get:function(){return this.Eo},enumerable:!1,configurable:!0}),oh.prototype.Zi=function(t){this.enqueue(t)},oh.prototype.po=function(t){this.bo(),this.vo(t)},oh.prototype.So=function(t){return this.bo(),this.vo(t)},oh.prototype.Do=function(n){return g(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return this.bo(),this.Eo?[3,2]:(this.Eo=!0,(e=nh())&&e.removeEventListener("visibilitychange",this.Vo),[4,this.So(n)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},oh.prototype.enqueue=function(t){return this.bo(),this.Eo?new Promise(function(t){}):this.vo(t)},oh.prototype.er=function(t){var e=this;this.To.push(t),this.Zi(function(){return e.Co()})},oh.prototype.Co=function(){return g(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:if(0===this.To.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.To[0]()];case 2:return t.sent(),this.To.shift(),this.Po.reset(),[3,4];case 3:if(!Xc(e=t.sent()))throw e;return Ar("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.To.length&&this.Po.ys(function(){return n.Co()}),t.label=5;case 5:return[2]}})})},oh.prototype.vo=function(t){var r=this,e=this.wo.then(function(){return r.Ao=!0,t().catch(function(t){throw r.mo=t,r.Ao=!1,_r("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",e.stack&&(n=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),n)),t;var e,n}).then(function(t){return r.Ao=!1,t})});return this.wo=e},oh.prototype.bs=function(t,e,n){var r=this;this.bo(),-1<this.Ro.indexOf(t)&&(e=0);var i=rh._o(this,t,e,n,function(t){return r.$o(t)});return this.Io.push(i),i},oh.prototype.bo=function(){this.mo&&Dr()},oh.prototype.Fo=function(){},oh.prototype.No=function(){return g(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return[4,e=this.wo];case 1:t.sent(),t.label=2;case 2:if(e!==this.wo)return[3,0];t.label=3;case 3:return[2]}})})},oh.prototype.ko=function(t){for(var e=0,n=this.Io;e<n.length;e++)if(n[e].Es===t)return!0;return!1},oh.prototype.xo=function(r){var i=this;return this.No().then(function(){i.Io.sort(function(t,e){return t.uo-e.uo});for(var t=0,e=i.Io;t<e.length;t++){var n=e[t];if(n.Ss(),"all"!==r&&n.Es===r)break}return i.No()})},oh.prototype.Mo=function(t){this.Ro.push(t)},oh.prototype.$o=function(t){var e=this.Io.indexOf(t);this.Io.splice(e,1)},oh);function oh(){var t=this;this.wo=Promise.resolve(),this.To=[],this.Eo=!1,this.Io=[],this.mo=null,this.Ao=!1,this.Ro=[],this.Po=new ma(this,"async_queue_retry"),this.Vo=function(){return t.Po.vs()};var e=nh();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Vo)}function sh(t,e,n,r,i){this.ao=t,this.Es=e,this.uo=n,this.op=r,this.co=i,this.lo=new ga,this.then=this.lo.promise.then.bind(this.lo.promise),this.lo.promise.catch(function(t){})}function uh(t,e){if(_r("AsyncQueue",e+": "+t),Xc(t))return new Xr(Hr.UNAVAILABLE,e+": "+t);throw t}function ah(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Rr(n,i);return 0===s?Rr(r,o):s}var ch=(ph.prototype.qo=function(){return++this.Lo},ph.prototype.Bo=function(t){var e=[t,this.qo()];if(this.buffer.size<this.Oo)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();ah(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(ph.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),ph),hh={Uo:!1,Wo:0,Qo:0,jo:0},fh=(lh.Ho=function(t){return new lh(t,lh.Yo,lh.Jo)},lh);function lh(t,e,n){this.Ko=t,this.Go=e,this.zo=n}function ph(t){this.Oo=t,this.buffer=new Ri(ah),this.Lo=0}fh.Xo=-1,fh.Zo=1048576,fh.th=41943040,fh.Yo=10,fh.Jo=1e3,fh.eh=new fh(fh.th,fh.Yo,fh.Jo),fh.nh=new fh(fh.Xo,0,0);var dh=(wh.prototype.start=function(t){this.yr.params.Ko!==fh.Xo&&this.rh(t)},wh.prototype.stop=function(){this.ih&&(this.ih.cancel(),this.ih=null)},Object.defineProperty(wh.prototype,"Hi",{get:function(){return null!==this.ih},enumerable:!1,configurable:!0}),wh.prototype.rh=function(n){var t=this,e=this.sh?3e5:6e4;Ar("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.ih=this.ao.bs("lru_garbage_collection",e,function(){return g(t,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:this.ih=null,this.sh=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.oh(this.yr)];case 2:return t.sent(),[3,7];case 3:return Xc(e=t.sent())?(Ar("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Eh(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.rh(n)];case 8:return t.sent(),[2]}})})})},wh),vh=(mh.prototype.ah=function(t,e){return this.hh.pr(t).next(function(t){return Math.floor(e/100*t)})},mh.prototype.uh=function(t,e){var n=this;if(0===e)return na.resolve(aa.ws);var r=new ch(e);return this.hh.pe(t,function(t){return r.Bo(t.sequenceNumber)}).next(function(){return n.hh.vr(t,function(t){return r.Bo(t)})}).next(function(){return r.maxValue})},mh.prototype.Ei=function(t,e,n){return this.hh.Ei(t,e,n)},mh.prototype.Fr=function(t,e){return this.hh.Fr(t,e)},mh.prototype.lh=function(e,n){var r=this;return this.params.Ko===fh.Xo?(Ar("LruGarbageCollector","Garbage collection skipped; disabled"),na.resolve(hh)):this.kr(e).next(function(t){return t<r.params.Ko?(Ar("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.Ko),hh):r._h(e,n)})},mh.prototype.kr=function(t){return this.hh.kr(t)},mh.prototype._h=function(e,n){var r,i,o,s,u,a,c,h=this,f=Date.now();return this.ah(e,this.params.Go).next(function(t){return i=t>h.params.zo?(Ar("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.zo+" from "+t),h.params.zo):t,s=Date.now(),h.uh(e,i)}).next(function(t){return r=t,u=Date.now(),h.Ei(e,r,n)}).next(function(t){return o=t,a=Date.now(),h.Fr(e,r)}).next(function(t){return c=Date.now(),Nr()<=p.DEBUG&&Ar("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-f)+"ms"),na.resolve({Uo:!0,Wo:i,Qo:o,jo:t})})},mh),yh=(gh.prototype.Ah=function(i){return g(this,void 0,void 0,function(){var e,m,n,r=this;return w(this,function(t){switch(t.label){case 0:return e=this.jn,m=this.Ih,[4,this.persistence.runTransaction("Handle user change","readonly",function(y){var g;return r.jn.Qr(y).next(function(t){return g=t,e=r.persistence.mr(i),m=new sa(r.Eh,e,r.persistence.gr()),e.Qr(y)}).next(function(t){for(var e=[],n=[],r=Ki(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++){var c=a[u];r=r.add(c.key)}}for(var h=0,f=t;h<f.length;h++){var l=f[h];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var v=d[p];r=r.add(v.key)}}return m.Jn(y,r).next(function(t){return{Rh:t,Ph:e,gh:n}})})})];case 1:return n=t.sent(),[2,(this.jn=e,this.Ih=m,this.fh.mh(this.Ih),n)]}})})},gh.prototype.Vh=function(c){var h,f=this,l=Qr.now(),t=c.reduce(function(t,e){return t.add(e.key)},Ki());return this.persistence.runTransaction("Locally write mutations","readwrite",function(a){return f.Ih.Jn(a,t).next(function(t){h=t;for(var e=[],n=0,r=c;n<r.length;n++){var i=r[n],o=(u=i,s=h.get(i.key),u instanceof Bs?function(t){for(var e=null,n=0,r=u.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof au?t.field(i.field):void 0,s=ss(i.transform,o||null);null!=s&&(e=null==e?(new Zs).set(i.field,s):e.set(i.field,s))}return e?e.Ge():null}(s):null);null!=o&&e.push(new Us(i.key,o,ru(o.proto.mapValue),Ss.exists(!0)))}var u,s;return f.jn.Lr(a,l,e,c)})}).then(function(t){var e=t.In(h);return{batchId:t.batchId,Cn:e}})},gh.prototype.yh=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e=r.batch.keys(),n=i.Eh.Hs({Js:!0});return i.ph(t,r,n).next(function(){return n.apply(t)}).next(function(){return i.jn.zr(t)}).next(function(){return i.Ih.Jn(t,e)})})},gh.prototype.bh=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return r.jn.qr(e,t).next(function(t){return xr(null!==t),n=t.keys(),r.jn.Kr(e,t)}).next(function(){return r.jn.zr(e)}).next(function(){return r.Ih.Jn(e,n)})})},gh.prototype.Wr=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.jn.Wr(t)})},gh.prototype.ai=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qi.ai(t)})},gh.prototype.vh=function(a){var c=this,h=a.X,f=this.dh;return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var i=c.Eh.Hs({Js:!0});f=c.dh;var s=[];a.Wt.forEach(function(t,e){var n=f.get(e);if(n){s.push(c.qi.Pi(o,t.Xt,e).next(function(){return c.qi.Ai(o,t.Yt,e)}));var r=t.resumeToken;if(0<r.H()){var i=n.tt(r,h).Z(o.vi);f=f.nt(e,i),gh.Sh(n,i,t)&&s.push(c.qi.di(o,i))}}});var u=Mi(),n=Ki();if(a.jt.forEach(function(t,e){n=n.add(t)}),s.push(i.getEntries(o,n).next(function(r){a.jt.forEach(function(t,e){var n=r.get(t);e instanceof cu&&e.version.isEqual(Yr.min())?(i.xn(t,h),u=u.nt(t,e)):null==n||0<e.version.o(n.version)||0===e.version.o(n.version)&&n.hasPendingWrites?(i.Nn(e,h),u=u.nt(t,e)):Ar("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),a.Kt.has(t)&&s.push(c.persistence.ii.Nr(o,t))})})),!h.isEqual(Yr.min())){var t=c.qi.ai(o).next(function(t){return c.qi.ci(o,o.vi,h)});s.push(t)}return na.Sn(s).next(function(){return i.apply(o)}).next(function(){return c.Ih.Xn(o,u)})}).then(function(t){return c.dh=f,t})},gh.Sh=function(t,e,n){return xr(0<e.resumeToken.H()),0===t.resumeToken.H()||e.X.m()-t.X.m()>=this.Dh||0<n.Yt.size+n.Jt.size+n.Xt.size},gh.prototype.Ch=function(h){return g(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c=this;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return na.forEach(h,function(e){return na.forEach(e.as,function(t){return c.persistence.ii.Ri(n,e.targetId,t)}).next(function(){return na.forEach(e.us,function(t){return c.persistence.ii.gi(n,e.targetId,t)})})})})];case 1:return t.sent(),[3,3];case 2:if(!Xc(e=t.sent()))throw e;return Ar("LocalStore","Failed to update sequence numbers: "+e),[3,3];case 3:for(n=0,r=h;n<r.length;n++)i=r[n],o=i.targetId,i.fromCache||(s=this.dh.get(o),u=s.X,a=s.et(u),this.dh=this.dh.nt(o,a));return[2]}})})},gh.prototype.$h=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.jn.Ur(t,e)})},gh.prototype.Fh=function(e){var n=this;return this.persistence.runTransaction("read document","readonly",function(t){return n.Ih.Gn(t,e)})},gh.prototype.Nh=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.qi.mi(e,r).next(function(t){return t?(n=t,na.resolve(n)):i.qi.ri(e).next(function(t){return n=new Ti(r,t,0,e.vi),i.qi.li(e,n).next(function(){return n})})})}).then(function(t){var e=i.dh.get(t.targetId);return(null===e||0<t.X.o(e.X))&&(i.dh=i.dh.nt(t.targetId,t),i.wh.set(r,t.targetId)),t})},gh.prototype.mi=function(t,e){var n=this.wh.get(e);return void 0!==n?na.resolve(this.dh.get(n)):this.qi.mi(t,e)},gh.prototype.kh=function(o,s){return g(this,void 0,void 0,function(){var e,n,r,i=this;return w(this,function(t){switch(t.label){case 0:e=this.dh.get(o),n=s?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),s?[3,3]:[4,this.persistence.runTransaction("Release target",n,function(t){return i.persistence.ii.removeTarget(t,e)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!Xc(r=t.sent()))throw r;return Ar("LocalStore","Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return this.dh=this.dh.remove(o),this.wh.delete(e.target),[2]}})})},gh.prototype.xh=function(t,n){var r=this,i=Yr.min(),o=Ki();return this.persistence.runTransaction("Execute query","readonly",function(e){return r.mi(e,Iu(t)).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.qi.Vi(e,t.targetId).next(function(t){o=t})}).next(function(){return r.fh.ts(e,t,n?i:Yr.min(),n?o:Ki())}).next(function(t){return{documents:t,Mh:o}})})},gh.prototype.ph=function(t,i,o){var e=this,s=i.batch,n=s.keys(),u=na.resolve();return n.forEach(function(r){u=u.next(function(){return o.Mn(t,r)}).next(function(t){var e=t,n=i.An.get(r);xr(null!==n),(!e||e.version.o(n)<0)&&(e=s.wn(r,e,i))&&o.Nn(e,i.mn)})}),u.next(function(){return e.jn.Kr(t,s)})},gh.prototype.oh=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.lh(t,n.dh)})},gh);function gh(t,e,n){this.persistence=t,this.fh=e,this.dh=new Si(Rr),this.wh=new Wr(function(t){return vi(t)},yi),this.Th=Yr.min(),this.jn=t.mr(n),this.Eh=t.Pr(),this.qi=t.Rr(),this.Ih=new sa(this.Eh,this.jn,this.persistence.gr()),this.fh.mh(this.Ih)}function mh(t,e){this.hh=t,this.params=e}function wh(t,e){this.yr=t,this.ao=e,this.sh=!1,this.ih=null}function bh(t,e,n){return new yh(t,e,n)}function Ih(t,e){var n=Or(t),r=Or(n.qi),i=n.dh.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.Me(t,e).next(function(t){return t?t.target:null})})}function Eh(e){return g(this,void 0,void 0,function(){return w(this,function(t){if(e.code!==Hr.FAILED_PRECONDITION||e.message!==ia)throw e;return Ar("LocalStore","Unexpectedly lost primary lease"),[2]})})}yh.Dh=3e8;var Th=(_h.prototype._=function(){return this.Oh._()},_h.prototype.Ri=function(t,e){var n=new Nh(t,e);this.Oh=this.Oh.add(n),this.qh=this.qh.add(n)},_h.prototype.Uh=function(t,e){var n=this;t.forEach(function(t){return n.Ri(t,e)})},_h.prototype.gi=function(t,e){this.Wh(new Nh(t,e))},_h.prototype.Qh=function(t,e){var n=this;t.forEach(function(t){return n.gi(t,e)})},_h.prototype.jh=function(t){var e=this,n=new ei(new Zr([])),r=new Nh(n,t),i=new Nh(n,t+1),o=[];return this.qh.vt([r,i],function(t){e.Wh(t),o.push(t.key)}),o},_h.prototype.Kh=function(){var e=this;this.Oh.forEach(function(t){return e.Wh(t)})},_h.prototype.Wh=function(t){this.Oh=this.Oh.delete(t),this.qh=this.qh.delete(t)},_h.prototype.Gh=function(t){var e=new ei(new Zr([])),n=new Nh(e,t),r=new Nh(e,t+1),i=Ki();return this.qh.vt([n,r],function(t){i=i.add(t.key)}),i},_h.prototype.pi=function(t){var e=new Nh(t,0),n=this.Oh.Dt(e);return null!==n&&t.isEqual(n.key)},_h),Nh=(Ah.Lh=function(t,e){return ei.P(t.key,e.key)||Rr(t.zh,e.zh)},Ah.Bh=function(t,e){return Rr(t.zh,e.zh)||ei.P(t.key,e.key)},Ah);function Ah(t,e){this.key=t,this.zh=e}function _h(){this.Oh=new Ri(Nh.Lh),this.qh=new Ri(Nh.Bh)}function Sh(t,e){if(0!==e.length)throw new Xr(Hr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Kh(e.length,"argument")+".")}function Dh(t,e,n){if(e.length!==n)throw new Xr(Hr.INVALID_ARGUMENT,"Function "+t+"() requires "+Kh(n,"argument")+", but was called with "+Kh(e.length,"argument")+".")}function xh(t,e,n){if(e.length<n)throw new Xr(Hr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Kh(n,"argument")+", but was called with "+Kh(e.length,"argument")+".")}function Oh(t,e,n,r){if(e.length<n||e.length>r)throw new Xr(Hr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Kh(e.length,"argument")+".")}function kh(t,e,n,r){Fh(t,e,zh(n)+" argument",r)}function Ph(t,e,n,r){void 0!==r&&kh(t,e,n,r)}function Lh(t,e,n,r){Fh(t,e,n+" option",r)}function Rh(t,e,n,r){void 0!==r&&Lh(t,e,n,r)}function Ch(t,e,n,r,a){void 0!==r&&function(t,e,n){for(var r=[],i=0,o=a;i<o.length;i++){var s=o[i];if(s===n)return;r.push(Mh(s))}var u=Mh(n);throw new Xr(Hr.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+e+'". Acceptable values: '+r.join(", "))}(t,n,r)}function Vh(t,e,n,r){if(!e.some(function(t){return t===r}))throw new Xr(Hr.INVALID_ARGUMENT,"Invalid value "+Mh(r)+" provided to function "+t+"() for its "+zh(n)+" argument. Acceptable values: "+e.join(", "));return r}function Fh(t,e,n,r){if(!("object"===e?Uh(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Mh(r);throw new Xr(Hr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Uh(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Mh(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Dr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function jh(t,e,n){if(void 0===n)throw new Xr(Hr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+zh(e)+" argument, but it was undefined.")}function qh(n,t,r){qr(t,function(t,e){if(r.indexOf(t)<0)throw new Xr(Hr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function Gh(t,e,n,r){var i=Mh(r);return new Xr(Hr.INVALID_ARGUMENT,"Function "+t+"() requires its "+zh(n)+" argument to be a "+e+", but it was: "+i)}function Bh(t,e,n){if(n<=0)throw new Xr(Hr.INVALID_ARGUMENT,"Function "+t+"() requires its "+zh(e)+" argument to be a positive number, but it was: "+n+".")}function zh(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Kh(t,e){return t+" "+e+(1===t?"":"s")}function Wh(){if("undefined"==typeof Uint8Array)throw new Xr(Hr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Hh(){if("undefined"==typeof atob)throw new Xr(Hr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Xh,Qh,Yh=(of.fromBase64String=function(t){Dh("Blob.fromBase64String",arguments,1),kh("Blob.fromBase64String","string",1,t),Hh();try{return new of(mi.fromBase64String(t))}catch(t){throw new Xr(Hr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},of.fromUint8Array=function(t){if(Dh("Blob.fromUint8Array",arguments,1),Wh(),!(t instanceof Uint8Array))throw Gh("Blob.fromUint8Array","Uint8Array",1,t);return new of(mi.fromUint8Array(t))},of.prototype.toBase64=function(){return Dh("Blob.toBase64",arguments,0),Hh(),this.Hh.toBase64()},of.prototype.toUint8Array=function(){return Dh("Blob.toUint8Array",arguments,0),Wh(),this.Hh.toUint8Array()},of.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},of.prototype.isEqual=function(t){return this.Hh.isEqual(t.Hh)},of),Jh=function(t){!function(){if(!(t instanceof Array)||t.length<1)throw new Xr(Hr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least 1 element.")}();for(var e=0;e<t.length;++e)if(kh("FieldPath","string",e,t[e]),0===t[e].length)throw new Xr(Hr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.Yh=new ti(t)},Zh=(n(rf,Qh=Jh),rf.documentId=function(){return new rf(ti.L().F())},rf.prototype.isEqual=function(t){if(!(t instanceof rf))throw Gh("isEqual","FieldPath",1,t);return this.Yh.isEqual(t.Yh)},rf),$h=new RegExp("[~\\*/\\[\\]]"),tf=function(){this.Jh=this},ef=(n(nf,Xh=tf),nf.prototype.Zh=function(t){if(2!==t.ta)throw 1===t.ta?t.ea(this.Xh+"() can only appear at the top level of your update data"):t.ea(this.Xh+"() cannot be used with set() unless you pass {merge:true}");return t.Le.push(t.path),null},nf.prototype.isEqual=function(t){return t instanceof nf},nf);function nf(t){var e=this;return(e=Xh.call(this)||this).Xh=t,e}function rf(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Qh.call(this,t)||this}function of(t){Hh(),this.Hh=t}function sf(t,e,n){return new Cf({ta:3,na:e.settings.na,methodName:t.Xh,sa:n},e.s,e.serializer,e.ignoreUndefinedProperties)}var uf,af,cf,hf,ff,lf,pf=(n(_f,lf=tf),_f.prototype.Zh=function(t){return new Ns(t.path,new cs)},_f.prototype.isEqual=function(t){return t instanceof _f},_f),df=(n(Af,ff=tf),Af.prototype.Zh=function(t){var e=sf(this,t,!0),n=this.ia.map(function(t){return Bf(t,e)}),r=new hs(n);return new Ns(t.path,r)},Af.prototype.isEqual=function(t){return this===t},Af),vf=(n(Nf,hf=tf),Nf.prototype.Zh=function(t){var e=sf(this,t,!0),n=this.ia.map(function(t){return Bf(t,e)}),r=new vs(n);return new Ns(t.path,r)},Nf.prototype.isEqual=function(t){return this===t},Nf),yf=(n(Tf,cf=tf),Tf.prototype.Zh=function(t){var e=new ws(t.serializer,Fo(t.serializer,this.ra));return new Ns(t.path,e)},Tf.prototype.isEqual=function(t){return this===t},Tf),gf=(n(Ef,af=tf),Ef.delete=function(){return Sh("FieldValue.delete",arguments),new mf(new ef("FieldValue.delete"))},Ef.serverTimestamp=function(){return Sh("FieldValue.serverTimestamp",arguments),new mf(new pf("FieldValue.serverTimestamp"))},Ef.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return xh("FieldValue.arrayUnion",arguments,1),new mf(new df("FieldValue.arrayUnion",t))},Ef.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return xh("FieldValue.arrayRemove",arguments,1),new mf(new vf("FieldValue.arrayRemove",t))},Ef.increment=function(t){return kh("FieldValue.increment","number",1,t),Dh("FieldValue.increment",arguments,1),new mf(new yf("FieldValue.increment",t))},Ef),mf=(n(If,uf=gf),If.prototype.Zh=function(t){return this.Jh.Zh(t)},If.prototype.isEqual=function(t){return t instanceof If&&this.Jh.isEqual(t.Jh)},If),wf=(Object.defineProperty(bf.prototype,"latitude",{get:function(){return this.oa},enumerable:!1,configurable:!0}),Object.defineProperty(bf.prototype,"longitude",{get:function(){return this.ha},enumerable:!1,configurable:!0}),bf.prototype.isEqual=function(t){return this.oa===t.oa&&this.ha===t.ha},bf.prototype.T=function(t){return Rr(this.oa,t.oa)||Rr(this.ha,t.ha)},bf);function bf(t,e){if(Dh("GeoPoint",arguments,2),kh("GeoPoint","number",1,t),kh("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Xr(Hr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Xr(Hr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.oa=t,this.ha=e}function If(t){var e=this;return(e=uf.call(this)||this).Jh=t,e.Xh=t.Xh,e}function Ef(){return af.call(this)||this}function Tf(t,e){var n=this;return(n=cf.call(this)||this).Xh=t,n.ra=e,n}function Nf(t,e){var n=this;return(n=hf.call(this)||this).Xh=t,n.ia=e,n}function Af(t,e){var n=this;return(n=ff.call(this)||this).Xh=t,n.ia=e,n}function _f(t){var e=this;return(e=lf.call(this)||this).Xh=t,e}function Sf(t){return new Ro(t,!0)}var Df=/^__.*__$/,xf=function(t,e,n){this.aa=t,this.ua=e,this.ca=n},Of=(Lf.prototype.la=function(t,e){var n=[];return null!==this.Le?n.push(new Us(t,this.data,this.Le,e)):n.push(new Fs(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Bs(t,this.fieldTransforms)),n},Lf),kf=(Pf.prototype.la=function(t,e){var n=[new Us(t,this.data,this.Le,e)];return 0<this.fieldTransforms.length&&n.push(new Bs(t,this.fieldTransforms)),n},Pf);function Pf(t,e,n){this.data=t,this.Le=e,this.fieldTransforms=n}function Lf(t,e,n){this.data=t,this.Le=e,this.fieldTransforms=n}function Rf(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Dr()}}var Cf=(Object.defineProperty(Uf.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(Uf.prototype,"ta",{get:function(){return this.settings.ta},enumerable:!1,configurable:!0}),Uf.prototype.fa=function(t){return new Uf(Object.assign(Object.assign({},this.settings),t),this.s,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Le)},Uf.prototype.da=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.fa({path:n,sa:!1});return r.wa(t),r},Uf.prototype.Ta=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.fa({path:n,sa:!1});return r._a(),r},Uf.prototype.Ea=function(t){return this.fa({path:void 0,sa:!0})},Uf.prototype.ea=function(t){return Qf(t,this.settings.methodName,this.settings.Ia||!1,this.path,this.settings.na)},Uf.prototype.contains=function(e){return void 0!==this.Le.find(function(t){return e.D(t)})||void 0!==this.fieldTransforms.find(function(t){return e.D(t.field)})},Uf.prototype._a=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.wa(this.path.get(t))},Uf.prototype.wa=function(t){if(0===t.length)throw this.ea("Document fields must not be empty");if(Rf(this.ta)&&Df.test(t))throw this.ea('Document fields cannot begin and end with "__"')},Uf),Vf=(Ff.prototype.ma=function(t,e,n,r){return void 0===r&&(r=!1),new Cf({ta:t,methodName:e,na:n,path:ti.k(),sa:!1,Ia:r},this.s,this.serializer,this.ignoreUndefinedProperties)},Ff);function Ff(t,e,n){this.s=t,this.ignoreUndefinedProperties=e,this.serializer=n||Sf(t)}function Uf(t,e,n,r,i,o){this.settings=t,this.s=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this._a(),this.fieldTransforms=i||[],this.Le=o||[]}function Mf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.ma(o.merge||o.mergeFields?2:0,e,n,i);Wf("Data must be an object, but it was:",s,r);var u,a,c=zf(r,s);if(o.merge)u=new Ts(s.Le),a=s.fieldTransforms;else if(o.mergeFields){for(var h=[],f=0,l=o.mergeFields;f<l.length;f++){var p=l[f],d=void 0;if(p instanceof Jh)d=p.Yh;else{if("string"!=typeof p)throw Dr();d=Xf(e,p,n)}if(!s.contains(d))throw new Xr(Hr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Yf(h,d)||h.push(d)}u=new Ts(h),a=s.fieldTransforms.filter(function(t){return u.je(t.field)})}else u=null,a=s.fieldTransforms;return new Of(new Js(c),u,a)}function jf(t,o,s,e){var u=t.ma(1,o,s);Wf("Data must be an object, but it was:",u,e);var a=[],c=new Zs;qr(e,function(t,e){var n=Xf(o,t,s),r=u.Ta(n);if(e instanceof tf&&e.Jh instanceof ef)a.push(n);else{var i=Bf(e,r);null!=i&&(a.push(n),c.set(n,i))}});var n=new Ts(a);return new kf(c.Ge(),n,u.fieldTransforms)}function qf(t,e,n,r,i,o){var s=t.ma(1,e,n),u=[Hf(e,r,n)],a=[i];if(o.length%2!=0)throw new Xr(Hr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(Hf(e,o[c])),a.push(o[c+1]);for(var h=[],f=new Zs,l=u.length-1;0<=l;--l)if(!Yf(h,u[l])){var p=u[l],d=a[l],v=s.Ta(p);if(d instanceof tf&&d.Jh instanceof ef)h.push(p);else{var y=Bf(d,v);null!=y&&(h.push(p),f.set(p,y))}}var g=new Ts(h);return new kf(f.Ge(),g,s.fieldTransforms)}function Gf(t,e,n,r){return void 0===r&&(r=!1),Bf(n,t.ma(r?4:3,e))}function Bf(s,t){if(Kf(s))return Wf("Unsupported field value:",t,s),zf(s,t);if(s instanceof tf)return function(t,e){if(!Rf(e.ta))throw e.ea(t.Xh+"() can only be used with update() and set()");if(!e.path)throw e.ea(t.Xh+"() is not currently supported inside arrays");var n=t.Zh(e);n&&e.fieldTransforms.push(n)}(s,t),null;if(t.path&&t.Le.push(t.path),s instanceof Array){if(t.settings.sa&&4!==t.ta)throw t.ea("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=Bf(i[r],t.Ea(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Fo(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Qr.fromDate(t);return{timestampValue:Uo(e.serializer,n)}}if(t instanceof Qr){var r=new Qr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Uo(e.serializer,r)}}if(t instanceof wf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Yh)return{bytesValue:Mo(e.serializer,t)};if(t instanceof xf){var i=e.s,o=t.aa;if(!o.isEqual(i))throw e.ea("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:qo(t.aa||e.s,t.ua.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.ea("Unsupported field value: "+Mh(t))}(s,t)}function zf(t,r){var i={};return Gr(t)?r.path&&0<r.path.length&&r.Le.push(r.path):qr(t,function(t,e){var n=Bf(e,r.da(t));null!=n&&(i[t]=n)}),{mapValue:{fields:i}}}function Kf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Qr||t instanceof wf||t instanceof Yh||t instanceof xf||t instanceof tf)}function Wf(t,e,n){if(!Kf(n)||!Uh(n)){var r=Mh(n);throw"an object"===r?e.ea(t+" a custom object"):e.ea(t+" "+r)}}function Hf(t,e,n){if(e instanceof Jh)return e.Yh;if("string"==typeof e)return Xf(t,e);throw Qf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function Xf(t,e,n){try{return function(e){if(0<=e.search($h))throw new Xr(Hr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Zh.bind.apply(Zh,d([void 0],e.split("."))))}catch(t){throw new Xr(Hr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).Yh}catch(e){throw Qf(e instanceof Error?e.message:e.toString(),t,!1,void 0,n)}}function Qf(t,e,n,r,i){var o=r&&!r._(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new Xr(Hr.INVALID_ARGUMENT,(u+=". ")+t+a)}function Yf(t,e){return t.some(function(t){return t.isEqual(e)})}var Jf=(Zf.prototype.Mr=function(){return null!=this.uid},Zf.prototype.Aa=function(){return this.Mr()?"uid:"+this.uid:"anonymous-user"},Zf.prototype.isEqual=function(t){return t.uid===this.uid},Zf);function Zf(t){this.uid=t}Jf.UNAUTHENTICATED=new Jf(null),Jf.Ra=new Jf("google-credentials-uid"),Jf.Pa=new Jf("first-party-uid");function $f(t,e){this.user=e,this.type="OAuth",this.ga={},this.ga.Authorization="Bearer "+t}var tl,el,nl,rl=(Nl.prototype.getToken=function(){return Promise.resolve(null)},Nl.prototype.ya=function(){},Nl.prototype.pa=function(t){(this.Va=t)(Jf.UNAUTHENTICATED)},Nl.prototype.ba=function(){this.Va=null},Nl),il=(Tl.prototype.getToken=function(){var e=this,n=this.Da,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.Da!==n?(Ar("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(xr("string"==typeof t.accessToken),new $f(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},Tl.prototype.ya=function(){this.forceRefresh=!0},Tl.prototype.pa=function(t){this.Va=t,this.Sa&&t(this.currentUser)},Tl.prototype.ba=function(){this.auth&&this.auth.removeAuthTokenListener(this.va),this.va=null,this.Va=null},Tl.prototype.Ca=function(){var t=this.auth&&this.auth.getUid();return xr(null===t||"string"==typeof t),new Jf(t)},Tl),ol=(Object.defineProperty(El.prototype,"ga",{get:function(){var t={"X-Goog-AuthUser":this.Fa},e=this.$a.auth.Na([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),El),sl=(Il.prototype.getToken=function(){return Promise.resolve(new ol(this.$a,this.Fa))},Il.prototype.pa=function(t){t(Jf.Pa)},Il.prototype.ba=function(){},Il.prototype.ya=function(){},Il),ul=(bl.prototype.qa=function(){return 1===this.state||2===this.state||4===this.state},bl.prototype.Ba=function(){return 2===this.state},bl.prototype.start=function(){3!==this.state?this.auth():this.Ua()},bl.prototype.stop=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.qa()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},bl.prototype.Wa=function(){this.state=0,this.Po.reset()},bl.prototype.Qa=function(){var t=this;this.Ba()&&null===this.La&&(this.La=this.Ts.bs(this.ka,6e4,function(){return t.ja()}))},bl.prototype.Ka=function(t){this.Ga(),this.stream.send(t)},bl.prototype.ja=function(){return g(this,void 0,void 0,function(){return w(this,function(t){return this.Ba()?[2,this.close(0)]:[2]})})},bl.prototype.Ga=function(){this.La&&(this.La.cancel(),this.La=null)},bl.prototype.close=function(e,n){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Ga(),this.Po.cancel(),this.Oa++,3!==e?this.Po.reset():n&&n.code===Hr.RESOURCE_EXHAUSTED?(_r(n.toString()),_r("Using maximum backoff delay to prevent overloading the backend."),this.Po.Vs()):n&&n.code===Hr.UNAUTHENTICATED&&this.Ma.ya(),null!==this.stream&&(this.za(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Ha(n)];case 1:return t.sent(),[2]}})})},bl.prototype.za=function(){},bl.prototype.auth=function(){var n=this;this.state=1;var t=this.Ya(this.Oa),e=this.Oa;this.Ma.getToken().then(function(t){n.Oa===e&&n.Ja(t)},function(e){t(function(){var t=new Xr(Hr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.Xa(t)})})},bl.prototype.Ja=function(t){var e=this,n=this.Ya(this.Oa);this.stream=this.Za(t),this.stream.tu(function(){n(function(){return e.state=2,e.listener.tu()})}),this.stream.Ha(function(t){n(function(){return e.Xa(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},bl.prototype.Ua=function(){var t=this;this.state=4,this.Po.ys(function(){return g(t,void 0,void 0,function(){return w(this,function(t){return this.state=0,this.start(),[2]})})})},bl.prototype.Xa=function(t){return Ar("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},bl.prototype.Ya=function(e){var n=this;return function(t){n.Ts.Zi(function(){return n.Oa===e?t():(Ar("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},bl),al=(n(wl,nl=ul),wl.prototype.Za=function(t){return this.xa.eu("Listen",t)},wl.prototype.onMessage=function(t){this.Po.reset();var e=function(t,e){var n,r,i,o,s,u;if("targetChange"in e){e.targetChange;var a="NO_CHANGE"===(u=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===u?1:"REMOVE"===u?2:"CURRENT"===u?3:"RESET"===u?4:Dr(),c=e.targetChange.targetIds||[],h=(o=t,s=e.targetChange.resumeToken,o.Oe?(xr(void 0===s||"string"==typeof s),mi.fromBase64String(s||"")):(xr(void 0===s||s instanceof Uint8Array),mi.fromUint8Array(s||new Uint8Array))),f=e.targetChange.cause,l=f&&(i=void 0===(r=f).code?Hr.UNKNOWN:_i(r.code),new Xr(i,r.message||""));n=new Yi(a,c,h,l||null)}else if("documentChange"in e){e.documentChange;var p=e.documentChange;p.document,p.document.name,p.document.updateTime;var d=zo(t,p.document.name),v=jo(p.document.updateTime),y=new Js({mapValue:{fields:p.document.fields}}),g=new au(d,v,y,{}),m=p.targetIds||[],w=p.removedTargetIds||[];n=new Xi(m,w,g.key,g)}else if("documentDelete"in e){e.documentDelete;var b=e.documentDelete;b.document;var I=zo(t,b.document),E=b.readTime?jo(b.readTime):Yr.min(),T=new cu(I,E),N=b.removedTargetIds||[];n=new Xi([],N,T.key,T)}else if("documentRemove"in e){e.documentRemove;var A=e.documentRemove;A.document;var _=zo(t,A.document),S=A.removedTargetIds||[];n=new Xi([],S,_,null)}else{if(!("filter"in e))return Dr();e.filter;var D=e.filter;D.targetId;var x=D.count||0,O=new bi(x),k=D.targetId;n=new Qi(k,O)}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Yr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Yr.min():jo(e.readTime)}(t);return this.listener.nu(e,n)},wl.prototype.su=function(t){var e,n,r,i,o={};o.database=Ho(this.serializer),o.addTarget=(e=this.serializer,i=(n=t).target,(r=gi(i)?{documents:Zo(e,i)}:{query:$o(e,i)}).targetId=n.targetId,0<n.resumeToken.H()&&(r.resumeToken=Mo(e,n.resumeToken)),r);var s,u,a=(this.serializer,s=t,null==(u=function(){switch(s.J){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Dr()}}())?null:{"goog-listen-tags":u});a&&(o.labels=a),this.Ka(o)},wl.prototype.iu=function(t){var e={};e.database=Ho(this.serializer),e.removeTarget=t,this.Ka(e)},wl),cl=(n(ml,el=ul),Object.defineProperty(ml.prototype,"ou",{get:function(){return this.ru},enumerable:!1,configurable:!0}),ml.prototype.start=function(){this.ru=!1,this.lastStreamToken=void 0,el.prototype.start.call(this)},ml.prototype.za=function(){this.ru&&this.hu([])},ml.prototype.Za=function(t){return this.xa.eu("Write",t)},ml.prototype.onMessage=function(t){if(xr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.ru){this.Po.reset();var e=(r=t.writeResults,i=t.commitTime,r&&0<r.length?(xr(void 0!==i),r.map(function(t){return function(t,e){var n=t.updateTime?jo(t.updateTime):jo(e);n.isEqual(Yr.min())&&(n=jo(e));var r=null;return t.transformResults&&0<t.transformResults.length&&(r=t.transformResults),new _s(n,r)}(t,i)})):[]),n=jo(t.commitTime);return this.listener.au(n,e)}var r,i;return xr(!t.writeResults||0===t.writeResults.length),this.ru=!0,this.listener.uu()},ml.prototype.cu=function(){var t={};t.database=Ho(this.serializer),this.Ka(t)},ml.prototype.hu=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return Yo(e.serializer,t)})};this.Ka(n)},ml),hl=(n(gl,tl=function(){}),gl.prototype._u=function(){if(this.lu)throw new Xr(Hr.FAILED_PRECONDITION,"The client has already been terminated.")},gl.prototype.start=function(t){this.xa=t},gl.prototype.fu=function(e,n){var r=this;return this._u(),this.credentials.getToken().then(function(t){return r.xa.fu(e,n,t)}).catch(function(t){throw t.code===Hr.UNAUTHENTICATED&&r.credentials.ya(),t})},gl.prototype.du=function(e,n){var r=this;return this._u(),this.credentials.getToken().then(function(t){return r.xa.du(e,n,t)}).catch(function(t){throw t.code===Hr.UNAUTHENTICATED&&r.credentials.ya(),t})},gl),fl=(yl.prototype.Au=function(r){return g(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:if(this.Ru(),0<this.mutations.length)throw new Xr(Hr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,u){return g(this,void 0,void 0,function(){var i,e,n,o,r;return w(this,function(t){switch(t.label){case 0:return i=Or(s),e={database:Ho(i.serializer),documents:u.map(function(t){return Bo(i.serializer,t)})},[4,i.du("BatchGetDocuments",e)];case 1:return n=t.sent(),o=new Map,n.forEach(function(t){var e,n,r=(e=i.serializer,"found"in(n=t)?function(t,e){xr(!!e.found),e.found.name,e.found.updateTime;var n=zo(t,e.found.name),r=jo(e.found.updateTime),i=new Js({mapValue:{fields:e.found.fields}});return new au(n,r,i,{})}(e,n):"missing"in n?function(t,e){xr(!!e.missing),xr(!!e.readTime);var n=zo(t,e.missing),r=jo(e.readTime);return new cu(n,r)}(e,n):Dr());o.set(r.key.toString(),r)}),r=[],[2,(u.forEach(function(t){var e=o.get(t.toString());xr(!!e),r.push(e)}),r)]}})})}(this.wu,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof cu||t instanceof au?n.Pu(t):Dr()}),e)]}})})},yl.prototype.set=function(t,e){this.write(e.la(t,this.Ue(t))),this.mu.add(t)},yl.prototype.update=function(t,e){try{this.write(e.la(t,this.gu(t)))}catch(t){this.Iu=t}this.mu.add(t)},yl.prototype.delete=function(t){this.write([new Qs(t,this.Ue(t))]),this.mu.add(t)},yl.prototype.commit=function(){return g(this,void 0,void 0,function(){var e,r=this;return w(this,function(t){switch(t.label){case 0:if(this.Ru(),this.Iu)throw this.Iu;return e=this.Tu,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){var n=new ei(Zr.N(e));r.mutations.push(new Ys(n,r.Ue(n)))}),[4,function(r,i){return g(this,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:return e=Or(r),n={database:Ho(e.serializer),writes:i.map(function(t){return Yo(e.serializer,t)})},[4,e.fu("Commit",n)];case 1:return t.sent(),[2]}})})}(this.wu,this.mutations)];case 1:return t.sent(),this.Eu=!0,[2]}})})},yl.prototype.Pu=function(t){var e;if(t instanceof au)e=t.version;else{if(!(t instanceof cu))throw Dr();e=Yr.min()}var n=this.Tu.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Xr(Hr.ABORTED,"Document version changed between two reads.")}else this.Tu.set(t.key.toString(),e)},yl.prototype.Ue=function(t){var e=this.Tu.get(t.toString());return!this.mu.has(t)&&e?Ss.updateTime(e):Ss.We()},yl.prototype.gu=function(t){var e=this.Tu.get(t.toString());if(this.mu.has(t)||!e)return Ss.exists(!0);if(e.isEqual(Yr.min()))throw new Xr(Hr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ss.updateTime(e)},yl.prototype.write=function(t){this.Ru(),this.mutations=this.mutations.concat(t)},yl.prototype.Ru=function(){},yl),ll=(vl.prototype.vu=function(){var t=this;0===this.yu&&(this.Su("Unknown"),this.pu=this.ao.bs("online_state_timeout",1e4,function(){return t.pu=null,t.Du("Backend didn't respond within 10 seconds."),t.Su("Offline"),Promise.resolve()}))},vl.prototype.Cu=function(t){"Online"===this.state?this.Su("Unknown"):(this.yu++,1<=this.yu&&(this.$u(),this.Du("Connection failed 1 times. Most recent error: "+t.toString()),this.Su("Offline")))},vl.prototype.set=function(t){this.$u(),this.yu=0,"Online"===t&&(this.bu=!1),this.Su(t)},vl.prototype.Su=function(t){t!==this.state&&(this.state=t,this.Vu(t))},vl.prototype.Du=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.bu?(_r(e),this.bu=!1):Ar("OnlineStateTracker",e)},vl.prototype.$u=function(){null!==this.pu&&(this.pu.cancel(),this.pu=null)},vl),pl=(dl.prototype.start=function(){return this.enableNetwork()},dl.prototype.enableNetwork=function(){return this.Mu.delete(0),this.Ju()},dl.prototype.Ju=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.qu()?(this.Xu()?this.Zu():this.Uu.set("Unknown"),[4,this.tc()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},dl.prototype.disableNetwork=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Mu.add(0),[4,this.ec()];case 1:return t.sent(),this.Uu.set("Offline"),[2]}})})},dl.prototype.ec=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,this.Gu.stop()];case 1:return t.sent(),[4,this.Wu.stop()];case 2:return t.sent(),0<this.Nu.length&&(Ar("RemoteStore","Stopping write stream with "+this.Nu.length+" pending writes"),this.Nu=[]),this.nc(),[2]}})})},dl.prototype._r=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return Ar("RemoteStore","RemoteStore shutting down."),this.Mu.add(5),[4,this.ec()];case 1:return t.sent(),this.Ou._r(),this.Uu.set("Unknown"),[2]}})})},dl.prototype.listen=function(t){this.ku.has(t.targetId)||(this.ku.set(t.targetId,t),this.Xu()?this.Zu():this.Wu.Ba()&&this.sc(t))},dl.prototype.ic=function(t){this.ku.delete(t),this.Wu.Ba()&&this.rc(t),0===this.ku.size&&(this.Wu.Ba()?this.Wu.Qa():this.qu()&&this.Uu.set("Unknown"))},dl.prototype.Me=function(t){return this.ku.get(t)||null},dl.prototype.xe=function(t){return this.oc.xe(t)},dl.prototype.sc=function(t){this.xu.de(t.targetId),this.Wu.su(t)},dl.prototype.rc=function(t){this.xu.de(t),this.Wu.iu(t)},dl.prototype.Zu=function(){this.xu=new ro(this),this.Wu.start(),this.Uu.vu()},dl.prototype.Xu=function(){return this.qu()&&!this.Wu.qa()&&0<this.ku.size},dl.prototype.qu=function(){return 0===this.Mu.size},dl.prototype.nc=function(){this.xu=null},dl.prototype.Qu=function(){return g(this,void 0,void 0,function(){var n=this;return w(this,function(t){return this.ku.forEach(function(t,e){n.sc(t)}),[2]})})},dl.prototype.ju=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){return this.nc(),this.Xu()?(this.Uu.Cu(e),this.Zu()):this.Uu.set("Unknown"),[2]})})},dl.prototype.Ku=function(i,o){return g(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:if(this.Uu.set("Online"),!(i instanceof Yi&&2===i.state&&i.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,this.hc(i)];case 2:return t.sent(),[3,5];case 3:return e=t.sent(),Ar("RemoteStore","Failed to remove targets %s: %s ",i.targetIds.join(","),e),[4,this.ac(e)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(i instanceof Xi?this.xu.Pe(i):i instanceof Qi?this.xu.De(i):this.xu.ye(i),o.isEqual(Yr.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,this.Fu.ai()];case 8:return n=t.sent(),0<=o.o(n)?[4,this.uc(o)]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Ar("RemoteStore","Failed to raise snapshot:",r=t.sent()),[4,this.ac(r)];case 12:return t.sent(),[3,13];case 13:return[2]}})})},dl.prototype.ac=function(n,r){return g(this,void 0,void 0,function(){var e=this;return w(this,function(t){switch(t.label){case 0:if(!Xc(n))throw n;return this.Mu.add(1),[4,this.ec()];case 1:return t.sent(),this.Uu.set("Offline"),r=r||function(){return e.Fu.ai()},this.ao.er(function(){return g(e,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return Ar("RemoteStore","Retrying IndexedDB access"),[4,r()];case 1:return t.sent(),this.Mu.delete(1),[4,this.Ju()];case 2:return t.sent(),[2]}})})}),[2]}})})},dl.prototype.cc=function(e){var n=this;return e().catch(function(t){return n.ac(t,e)})},dl.prototype.uc=function(r){var i=this,t=this.xu.Fe(r);return t.Wt.forEach(function(t,e){if(0<t.resumeToken.H()){var n=i.ku.get(e);n&&i.ku.set(e,n.tt(t.resumeToken,r))}}),t.Qt.forEach(function(t){var e=i.ku.get(t);if(e){i.ku.set(t,e.tt(mi.Y,e.X)),i.rc(t);var n=new Ti(e.target,t,1,e.sequenceNumber);i.sc(n)}}),this.oc.vh(t)},dl.prototype.hc=function(o){return g(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){switch(t.label){case 0:e=o.cause,n=0,r=o.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],this.ku.has(i)?[4,this.oc.lc(i,e)]:[3,3]):[3,5];case 2:t.sent(),this.ku.delete(i),this.xu.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})},dl.prototype.tc=function(){return g(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:e=0<this.Nu.length?this.Nu[this.Nu.length-1].batchId:-1,t.label=1;case 1:if(!this._c())return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,this.Fu.$h(e)];case 3:return null===(n=t.sent())?(0===this.Nu.length&&this.Gu.Qa(),[3,7]):(e=n.batchId,this.fc(n),[3,6]);case 4:return r=t.sent(),[4,this.ac(r)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return this.dc()&&this.wc(),[2]}})})},dl.prototype._c=function(){return this.qu()&&this.Nu.length<10},dl.prototype.Tc=function(){return this.Nu.length},dl.prototype.fc=function(t){this.Nu.push(t),this.Gu.Ba()&&this.Gu.ou&&this.Gu.hu(t.mutations)},dl.prototype.dc=function(){return this.qu()&&!this.Gu.qa()&&0<this.Nu.length},dl.prototype.wc=function(){this.Gu.start()},dl.prototype.zu=function(){return g(this,void 0,void 0,function(){return w(this,function(t){return this.Gu.cu(),[2]})})},dl.prototype.Yu=function(){return g(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){for(e=0,n=this.Nu;e<n.length;e++)r=n[e],this.Gu.hu(r.mutations);return[2]})})},dl.prototype.au=function(i,o){return g(this,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){switch(t.label){case 0:return e=this.Nu.shift(),n=ea.from(e,i,o),[4,this.cc(function(){return r.oc.Ec(n)})];case 1:return t.sent(),[4,this.tc()];case 2:return t.sent(),[2]}})})},dl.prototype.Hu=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return e&&this.Gu.ou?[4,this.Ic(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.dc()&&this.wc(),[2]}})})},dl.prototype.Ic=function(i){return g(this,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){switch(t.label){case 0:return Ai(n=i.code)&&n!==Hr.ABORTED?(e=this.Nu.shift(),this.Gu.Wa(),[4,this.cc(function(){return r.oc.mc(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,this.tc()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},dl.prototype.Ac=function(){return new fl(this.wu)},dl.prototype.Bu=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Mu.add(4),[4,this.ec()];case 1:return t.sent(),this.Uu.set("Unknown"),this.Gu.Wa(),this.Wu.Wa(),this.Mu.delete(4),[4,this.Ju()];case 2:return t.sent(),[2]}})})},dl.prototype.Rc=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.ao.Fo(),Ar("RemoteStore","RemoteStore received new credentials"),this.Mu.add(3),[4,this.ec()];case 1:return t.sent(),this.Uu.set("Unknown"),[4,this.oc.Rc(e)];case 2:return t.sent(),this.Mu.delete(3),[4,this.Ju()];case 3:return t.sent(),[2]}})})},dl.prototype.Pc=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return e?(this.Mu.delete(2),[4,this.Ju()]):[3,2];case 1:return t.sent(),[3,5];case 2:return e?[3,4]:(this.Mu.add(2),[4,this.ec()]);case 3:t.sent(),this.Uu.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})},dl);function dl(t,e,n,r,i){var o,s,u,a,c,h,f,l,p=this;this.Fu=t,this.wu=e,this.ao=n,this.Nu=[],this.ku=new Map,this.xu=null,this.Mu=new Set,this.Ou=i,this.Ou.Lu(function(t){n.Zi(function(){return g(p,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.qu()?(Ar("RemoteStore","Restarting streams for network reachability change."),[4,this.Bu()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Uu=new ll(n,r),this.Wu=(c=this.wu,h=n,f={tu:this.Qu.bind(this),Ha:this.ju.bind(this),nu:this.Ku.bind(this)},(l=Or(c))._u(),new al(h,l.xa,l.credentials,l.serializer,f)),this.Gu=(o=this.wu,s=n,u={tu:this.zu.bind(this),Ha:this.Hu.bind(this),uu:this.Yu.bind(this),au:this.au.bind(this)},(a=Or(o))._u(),new cl(s,a.xa,a.credentials,a.serializer,u))}function vl(t,e){this.ao=t,this.Vu=e,this.state="Unknown",this.yu=0,this.pu=null,this.bu=!0}function yl(t){this.wu=t,this.Tu=new Map,this.mutations=[],this.Eu=!1,this.Iu=null,this.mu=new Set}function gl(t,e){var n=this;return(n=tl.call(this)||this).credentials=t,n.serializer=e,n.lu=!1,n}function ml(t,e,n,r,i){var o=this;return(o=el.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.ru=!1,o}function wl(t,e,n,r,i){var o=this;return(o=nl.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function bl(t,e,n,r,i,o){this.Ts=t,this.ka=n,this.xa=r,this.Ma=i,this.listener=o,this.state=0,this.Oa=0,this.La=null,this.stream=null,this.Po=new ma(t,e)}function Il(t,e){this.$a=t,this.Fa=e}function El(t,e){this.$a=t,this.Fa=e,this.type="FirstParty",this.user=Jf.Pa}function Tl(t){var e=this;this.va=null,this.currentUser=Jf.UNAUTHENTICATED,this.Sa=!1,this.Da=0,this.Va=null,this.forceRefresh=!1,this.va=function(){e.Da++,e.currentUser=e.Ca(),e.Sa=!0,e.Va&&e.Va(e.currentUser)},this.Da=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.va):(this.va(null),t.get().then(function(t){e.auth=t,e.va&&e.auth.addAuthTokenListener(e.va)},function(){}))}function Nl(){this.Va=null}function Al(t,e){return"firestore_clients_"+t+"_"+e}function _l(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.Mr()&&(r+="_"+e.uid),r}function Sl(t,e){return"firestore_targets_"+t+"_"+e}function Dl(t){this.key=t}function xl(t){this.key=t}function Ol(t,e,n){this.query=t,this.targetId=e,this.view=n}function kl(t){this.key=t,this.Ml=!1}var Pl=(Jl.gc=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Xr(r.error.code,r.error.message)),i?new Jl(t,e,r.state,o):(_r("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Jl.prototype.Vc=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Jl),Ll=(Yl.gc=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Xr(n.error.code,n.error.message)),r?new Yl(t,n.state,i):(_r("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},Yl.prototype.Vc=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Yl),Rl=(Ql.gc=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Hi(),o=0;r&&o<n.activeTargetIds.length;++o)r=li(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Ql(t,i):(_r("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},Ql),Cl=(Xl.gc=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Xl(e.clientId,e.onlineState):(_r("SharedClientState","Failed to parse online state: "+t),null)},Xl),Vl=(Hl.prototype.yc=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Hl.prototype.pc=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Hl.prototype.Vc=function(){var t={activeTargetIds:this.activeTargetIds.$(),updateTimeMs:Date.now()};return JSON.stringify(t)},Hl),Fl=(Wl.Oi=function(t){return!(!t||!t.localStorage)},Wl.prototype.start=function(){return g(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f,l=this;return w(this,function(t){switch(t.label){case 0:return[4,this.oc.Ir()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.bc&&(o=this.getItem(Al(this.persistenceKey,i)))&&(s=Rl.gc(i,o))&&(this.Dc=this.Dc.nt(s.clientId,s));for(this.Oc(),(u=this.storage.getItem(this.Mc))&&(a=this.Lc(u))&&this.qc(a),c=0,h=this.Cc;c<h.length;c++)f=h[c],this.Sc(f);return this.Cc=[],this.window.addEventListener("unload",function(){return l._r()}),this.Hi=!0,[2]}})})},Wl.prototype.ds=function(t){this.setItem(this.Fc,JSON.stringify(t))},Wl.prototype.Bc=function(){return this.Uc(this.Dc)},Wl.prototype.Wc=function(n){var r=!1;return this.Dc.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},Wl.prototype.Qc=function(t){this.jc(t,"pending")},Wl.prototype.Kc=function(t,e,n){this.jc(t,e,n),this.Gc(t)},Wl.prototype.zc=function(t){var e="not-current";if(this.Wc(t)){var n=this.storage.getItem(Sl(this.persistenceKey,t));if(n){var r=Ll.gc(t,n);r&&(e=r.state)}}return this.Hc.yc(t),this.Oc(),e},Wl.prototype.Yc=function(t){this.Hc.pc(t),this.Oc()},Wl.prototype.Jc=function(t){return this.Hc.activeTargetIds.has(t)},Wl.prototype.Xc=function(t){this.removeItem(Sl(this.persistenceKey,t))},Wl.prototype.Zc=function(t,e,n){this.tl(t,e,n)},Wl.prototype.Ah=function(t,e,n){var r=this;e.forEach(function(t){r.Gc(t)}),this.currentUser=t,n.forEach(function(t){r.Qc(t)})},Wl.prototype.el=function(t){this.nl(t)},Wl.prototype._r=function(){this.Hi&&(this.window.removeEventListener("storage",this.vc),this.removeItem(this.$c),this.Hi=!1)},Wl.prototype.getItem=function(t){var e=this.storage.getItem(t);return Ar("SharedClientState","READ",t,e),e},Wl.prototype.setItem=function(t,e){Ar("SharedClientState","SET",t,e),this.storage.setItem(t,e)},Wl.prototype.removeItem=function(t){Ar("SharedClientState","REMOVE",t),this.storage.removeItem(t)},Wl.prototype.Sc=function(t){var e=this,u=t;if(u.storageArea===this.storage){if(Ar("SharedClientState","EVENT",u.key,u.newValue),u.key===this.$c)return void _r("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Ts.er(function(){return g(e,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){if(this.Hi){if(null!==u.key)if(this.Nc.test(u.key)){if(null==u.newValue)return e=this.sl(u.key),[2,this.il(e,null)];if(n=this.rl(u.key,u.newValue))return[2,this.il(n.clientId,n)]}else if(this.kc.test(u.key)){if(null!==u.newValue&&(r=this.ol(u.key,u.newValue)))return[2,this.hl(r)]}else if(this.xc.test(u.key)){if(null!==u.newValue&&(i=this.al(u.key,u.newValue)))return[2,this.ul(i)]}else if(u.key===this.Mc){if(null!==u.newValue&&(o=this.Lc(u.newValue)))return[2,this.qc(o)]}else u.key===this.Fc&&(s=function(t){var e=aa.ws;if(null!=t)try{var n=JSON.parse(t);xr("number"==typeof n),e=n}catch(t){_r("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(u.newValue))!==aa.ws&&this.ls(s)}else this.Cc.push(u);return[2]})})})}},Object.defineProperty(Wl.prototype,"Hc",{get:function(){return this.Dc.get(this.bc)},enumerable:!1,configurable:!0}),Wl.prototype.Oc=function(){this.setItem(this.$c,this.Hc.Vc())},Wl.prototype.jc=function(t,e,n){var r=new Pl(this.currentUser,t,e,n),i=_l(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Vc())},Wl.prototype.Gc=function(t){var e=_l(this.persistenceKey,this.currentUser,t);this.removeItem(e)},Wl.prototype.nl=function(t){var e={clientId:this.bc,onlineState:t};this.storage.setItem(this.Mc,JSON.stringify(e))},Wl.prototype.tl=function(t,e,n){var r=Sl(this.persistenceKey,t),i=new Ll(t,e,n);this.setItem(r,i.Vc())},Wl.prototype.sl=function(t){var e=this.Nc.exec(t);return e?e[1]:null},Wl.prototype.rl=function(t,e){var n=this.sl(t);return Rl.gc(n,e)},Wl.prototype.ol=function(t,e){var n=this.kc.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Pl.gc(new Jf(i),r,e)},Wl.prototype.al=function(t,e){var n=this.xc.exec(t),r=Number(n[1]);return Ll.gc(r,e)},Wl.prototype.Lc=function(t){return Cl.gc(t)},Wl.prototype.hl=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.oc.cl(e.batchId,e.state,e.error)]:(Ar("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},Wl.prototype.ul=function(t){return this.oc.ll(t.targetId,t.state,t.error)},Wl.prototype.il=function(t,e){var n=this,r=e?this.Dc.nt(t,e):this.Dc.remove(t),i=this.Uc(this.Dc),o=this.Uc(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.oc._l(s,u).then(function(){n.Dc=r})},Wl.prototype.qc=function(t){this.Dc.get(t.clientId)&&this.Vu(t.onlineState)},Wl.prototype.Uc=function(t){var n=Hi();return t.forEach(function(t,e){n=n.Ct(e.activeTargetIds)}),n},Wl),Ul=(Kl.prototype.Qc=function(t){},Kl.prototype.Kc=function(t,e,n){},Kl.prototype.zc=function(t){return this.fl.yc(t),this.dl[t]||"not-current"},Kl.prototype.Zc=function(t,e,n){this.dl[t]=e},Kl.prototype.Yc=function(t){this.fl.pc(t)},Kl.prototype.Jc=function(t){return this.fl.activeTargetIds.has(t)},Kl.prototype.Xc=function(t){delete this.dl[t]},Kl.prototype.Bc=function(){return this.fl.activeTargetIds},Kl.prototype.Wc=function(t){return this.fl.activeTargetIds.has(t)},Kl.prototype.start=function(){return this.fl=new Vl,Promise.resolve()},Kl.prototype.Ah=function(t,e,n){},Kl.prototype.el=function(t){},Kl.prototype._r=function(){},Kl.prototype.ds=function(t){},Kl),Ml=(Object.defineProperty(zl.prototype,"Al",{get:function(){return this.wl},enumerable:!1,configurable:!0}),zl.prototype.Rl=function(t,e){var u=this,a=e?e.Pl:new Zi,c=e?e.ml:this.ml,h=e?e.Lt:this.Lt,f=c,l=!1,p=this.query.hn()&&c.size===this.query.limit?c.last():null,d=this.query.an()&&c.size===this.query.limit?c.first():null;if(t.ot(function(t,e){var n=c.get(t),r=e instanceof au?e:null;r=r&&(Du(u.query,r)?r:null);var i=!!n&&u.Lt.has(n.key),o=!!r&&(r.Ke||u.Lt.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),s=!0):u.gl(n,r)||(a.track({type:2,doc:r}),s=!0,(p&&0<u.Il(r,p)||d&&u.Il(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),s=!0):n&&!r&&(a.track({type:1,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(h=r?(f=f.add(r),o?h.add(t):h.delete(t)):(f=f.delete(t),h.delete(t)))}),this.query.hn()||this.query.an())for(;f.size>this.query.limit;){var n=this.query.hn()?f.last():f.first();f=f.delete(n.key),h=h.delete(n.key),a.track({type:1,doc:n})}return{ml:f,Pl:a,Vl:l,Lt:h}},zl.prototype.gl=function(t,e){return t.Ke&&e.hasCommittedMutations&&!e.Ke},zl.prototype.qn=function(t,e,n){var o=this,r=this.ml;this.ml=t.ml,this.Lt=t.Lt;var i=t.Pl.Mt();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.Il(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Dr()}}var r,i}),this.yl(n);var s=e?this.pl():[],u=0===this.El.size&&this.Ht?1:0,a=u!==this.Tl;return this.Tl=u,0!==i.length||a?{snapshot:new $i(this.query,t.ml,r,i,t.Lt,0==u,a,!1),bl:s}:{bl:s}},zl.prototype.vl=function(t){return this.Ht&&"Offline"===t?(this.Ht=!1,this.qn({ml:this.ml,Pl:new Zi,Lt:this.Lt,Vl:!1},!1)):{bl:[]}},zl.prototype.Sl=function(t){return!this.wl.has(t)&&!!this.ml.has(t)&&!this.ml.get(t).Ke},zl.prototype.yl=function(t){var e=this;t&&(t.Yt.forEach(function(t){return e.wl=e.wl.add(t)}),t.Jt.forEach(function(t){}),t.Xt.forEach(function(t){return e.wl=e.wl.delete(t)}),this.Ht=t.Ht)},zl.prototype.pl=function(){var e=this;if(!this.Ht)return[];var n=this.El;this.El=Ki(),this.ml.forEach(function(t){e.Sl(t.key)&&(e.El=e.El.add(t.key))});var r=[];return n.forEach(function(t){e.El.has(t)||r.push(new xl(t))}),this.El.forEach(function(t){n.has(t)||r.push(new Dl(t))}),r},zl.prototype.Dl=function(t){this.wl=t.Mh,this.El=Ki();var e=this.Rl(t.documents);return this.qn(e,!0)},zl.prototype.Cl=function(){return $i.Ut(this.query,this.ml,this.Lt,0===this.Tl)},zl),jl=(Bl.prototype.run=function(){this.Fl()},Bl.prototype.Fl=function(){var t=this;this.Po.ys(function(){return g(t,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){return e=new fl(this.wu),(n=this.Nl(e))&&n.then(function(t){r.ao.Zi(function(){return e.commit().then(function(){r.lo.resolve(t)}).catch(function(t){r.kl(t)})})}).catch(function(t){r.kl(t)}),[2]})})})},Bl.prototype.Nl=function(t){try{var e=this.updateFunction(t);return!hi(e)&&e.catch&&e.then?e:(this.lo.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.lo.reject(t),null}},Bl.prototype.kl=function(t){var e=this;0<this.$l&&this.xl(t)?(--this.$l,this.ao.Zi(function(){return e.Fl(),Promise.resolve()})):this.lo.reject(t)},Bl.prototype.xl=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Ai(e)},Bl),ql=(Object.defineProperty(Gl.prototype,"Xl",{get:function(){return!0===this.Jl},enumerable:!1,configurable:!0}),Gl.prototype.subscribe=function(t){this.Bl=t},Gl.prototype.listen=function(s){return g(this,void 0,void 0,function(){var e,n,r,i,o;return w(this,function(t){switch(t.label){case 0:return this.Zl("listen()"),(r=this.Ul.get(s))?(e=r.targetId,this.Ll.zc(e),n=r.view.Cl(),[3,4]):[3,1];case 1:return[4,this.Fu.Nh(Iu(s))];case 2:return i=t.sent(),o=this.Ll.zc(i.targetId),e=i.targetId,[4,this.t_(s,e,"current"===o)];case 3:n=t.sent(),this.Xl&&this.Ol.listen(i),t.label=4;case 4:return[2,n]}})})},Gl.prototype.t_=function(u,a,c){return g(this,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:return[4,this.Fu.xh(u,!0)];case 1:return e=t.sent(),n=new Ml(u,e.Mh),r=n.Rl(e.documents),i=eo.zt(a,c&&"Offline"!==this.onlineState),o=n.qn(r,this.Xl,i),this.e_(a,o.bl),s=new Ol(u,a,n),[2,(this.Ul.set(u,s),this.Wl.has(a)?this.Wl.get(a).push(u):this.Wl.set(a,[u]),o.snapshot)]}})})},Gl.prototype.ic=function(i){return g(this,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){switch(t.label){case 0:return this.Zl("unlisten()"),e=this.Ul.get(i),1<(n=this.Wl.get(e.targetId)).length?[2,(this.Wl.set(e.targetId,n.filter(function(t){return!Au(t,i)})),void this.Ul.delete(i))]:this.Xl?(this.Ll.Yc(e.targetId),this.Ll.Wc(e.targetId)?[3,2]:[4,this.Fu.kh(e.targetId,!1).then(function(){r.Ll.Xc(e.targetId),r.Ol.ic(e.targetId),r.n_(e.targetId)}).catch(Eh)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.n_(e.targetId),[4,this.Fu.kh(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},Gl.prototype.write=function(i,o){return g(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:this.Zl("write()"),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,this.Fu.Vh(i)];case 2:return e=t.sent(),this.Ll.Qc(e.batchId),this.s_(e.batchId,o),[4,this.i_(e.Cn)];case 3:return t.sent(),[4,this.Ol.tc()];case 4:return t.sent(),[3,6];case 5:return n=t.sent(),r=uh(n,"Failed to persist write"),o.reject(r),[3,6];case 6:return[2]}})})},Gl.prototype.runTransaction=function(t,e,n){new jl(t,this.wu,e,n).run()},Gl.prototype.vh=function(n){return g(this,void 0,void 0,function(){var e,r=this;return w(this,function(t){switch(t.label){case 0:this.Zl("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Fu.vh(n)];case 2:return e=t.sent(),n.Wt.forEach(function(t,e){var n=r.Kl.get(e);n&&(xr(t.Yt.size+t.Jt.size+t.Xt.size<=1),0<t.Yt.size?n.Ml=!0:0<t.Jt.size?xr(n.Ml):0<t.Xt.size&&(xr(n.Ml),n.Ml=!1))}),[4,this.i_(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,Eh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Gl.prototype.vl=function(r,t){if(this.Xl&&0===t||!this.Xl&&1===t){this.Zl("applyOnlineStateChange()");var i=[];this.Ul.forEach(function(t,e){var n=e.view.vl(r);n.snapshot&&i.push(n.snapshot)}),this.Bl.r_(r),this.Bl.nu(i),this.onlineState=r,this.Xl&&this.Ll.el(r)}},Gl.prototype.lc=function(u,a){return g(this,void 0,void 0,function(){var e,n,r,i,o,s=this;return w(this,function(t){switch(t.label){case 0:return this.Zl("rejectListens()"),this.Ll.Zc(u,"rejected",a),e=this.Kl.get(u),(n=e&&e.key)?(r=(r=new Si(ei.P)).nt(n,new cu(n,Yr.min())),i=Ki().add(n),o=new to(Yr.min(),new Map,new Ri(Rr),r,i),[4,this.vh(o)]):[3,2];case 1:return t.sent(),this.jl=this.jl.remove(n),this.Kl.delete(u),this.o_(),[3,4];case 2:return[4,this.Fu.kh(u,!1).then(function(){return s.n_(u,a)}).catch(Eh)];case 3:t.sent(),t.label=4;case 4:return[2]}})})},Gl.prototype.Ec=function(r){return g(this,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:this.Zl("applySuccessfulWrite()"),e=r.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Fu.yh(r)];case 2:return n=t.sent(),this.h_(e,null),this.a_(e),this.Ll.Kc(e,"acknowledged"),[4,this.i_(n)];case 3:return t.sent(),[3,6];case 4:return[4,Eh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Gl.prototype.mc=function(n,r){return g(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:this.Zl("rejectFailedWrite()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Fu.bh(n)];case 2:return e=t.sent(),this.h_(n,r),this.a_(n),this.Ll.Kc(n,"rejected",r),[4,this.i_(e)];case 3:return t.sent(),[3,6];case 4:return[4,Eh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Gl.prototype.u_=function(o){return g(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){switch(t.label){case 0:this.Ol.qu()||Ar("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.Fu.Wr()];case 2:return-1===(e=t.sent())?[2,void o.resolve()]:((n=this.Hl.get(e)||[]).push(o),this.Hl.set(e,n),[3,4]);case 3:return r=t.sent(),i=uh(r,"Initialization of waitForPendingWrites() operation failed"),o.reject(i),[3,4];case 4:return[2]}})})},Gl.prototype.a_=function(t){(this.Hl.get(t)||[]).forEach(function(t){t.resolve()}),this.Hl.delete(t)},Gl.prototype.c_=function(e){this.Hl.forEach(function(t){t.forEach(function(t){t.reject(new Xr(Hr.CANCELLED,e))})}),this.Hl.clear()},Gl.prototype.s_=function(t,e){var n=this.zl[this.currentUser.Aa()];n=(n=n||new Si(Rr)).nt(t,e),this.zl[this.currentUser.Aa()]=n},Gl.prototype.h_=function(t,e){var n=this.zl[this.currentUser.Aa()];if(n){var r=n.get(t);r&&(e?r.reject(e):r.resolve(),n=n.remove(t)),this.zl[this.currentUser.Aa()]=n}},Gl.prototype.n_=function(t,e){var n=this;void 0===e&&(e=null),this.Ll.Yc(t);for(var r=0,i=this.Wl.get(t);r<i.length;r++){var o=i[r];this.Ul.delete(o),e&&this.Bl.l_(o,e)}this.Wl.delete(t),this.Xl&&this.Gl.jh(t).forEach(function(t){n.Gl.pi(t)||n.__(t)})},Gl.prototype.__=function(t){var e=this.jl.get(t);null!==e&&(this.Ol.ic(e),this.jl=this.jl.remove(t),this.Kl.delete(e),this.o_())},Gl.prototype.e_=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof Dl?(this.Gl.Ri(i.key,t),this.f_(i)):i instanceof xl?(Ar("SyncEngine","Document no longer in limbo: "+i.key),this.Gl.gi(i.key,t),this.Gl.pi(i.key)||this.__(i.key)):Dr()}},Gl.prototype.f_=function(t){var e=t.key;this.jl.get(e)||(Ar("SyncEngine","New document in limbo: "+e),this.Ql.push(e),this.o_())},Gl.prototype.o_=function(){for(;0<this.Ql.length&&this.jl.size<this.ql;){var t=this.Ql.shift(),e=this.Yl.next();this.Kl.set(e,new kl(t)),this.jl=this.jl.nt(t,e),this.Ol.listen(new Ti(Iu(mu(t.path)),e,2,aa.ws))}},Gl.prototype.d_=function(){return this.jl},Gl.prototype.w_=function(){return this.Ql},Gl.prototype.i_=function(r,a){return g(this,void 0,void 0,function(){var o,s,e,u=this;return w(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.Ul.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.Rl(r);return n.Vl?u.Fu.xh(i.query,!1).then(function(t){var e=t.documents;return i.view.Rl(e,n)}):n}).then(function(t){var e=a&&a.Wt.get(i.targetId),n=i.view.qn(t,u.Xl,e);if(u.e_(i.targetId,n.bl),n.snapshot){u.Xl&&u.Ll.Zc(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=ua.cs(i.targetId,n.snapshot);s.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.Bl.nu(o),[4,this.Fu.Ch(s)];case 2:return t.sent(),[2]}})})},Gl.prototype.Zl=function(t){},Gl.prototype.Rc=function(n){return g(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return this.currentUser.isEqual(n)?[3,3]:(Ar("SyncEngine","User change. New user:",n.Aa()),[4,this.Fu.Ah(n)]);case 1:return e=t.sent(),this.currentUser=n,this.c_("'waitForPendingWrites' promise is rejected due to a user change."),this.Ll.Ah(n,e.Ph,e.gh),[4,this.i_(e.Rh)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Gl.prototype.xe=function(t){var e=this.Kl.get(t);if(e&&e.Ml)return Ki().add(e.key);var n=Ki(),r=this.Wl.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++){var s=o[i],u=this.Ul.get(s);n=n.Ct(u.view.Al)}return n},Gl);function Gl(t,e,n,r,i,o){this.Fu=t,this.Ol=e,this.wu=n,this.Ll=r,this.currentUser=i,this.ql=o,this.Bl=null,this.Ul=new Wr(function(t){return _u(t)},Au),this.Wl=new Map,this.Ql=[],this.jl=new Si(ei.P),this.Kl=new Map,this.Gl=new Th,this.zl={},this.Hl=new Map,this.Yl=Qa.si(),this.onlineState="Unknown",this.Jl=void 0}function Bl(t,e,n,r){this.ao=t,this.wu=e,this.updateFunction=n,this.lo=r,this.$l=5,this.Po=new ma(this.ao,"transaction_retry")}function zl(t,e){this.query=t,this.wl=e,this.Tl=null,this.Ht=!1,this.El=Ki(),this.Lt=Ki(),this.Il=xu(t),this.ml=new Ji(this.Il)}function Kl(){this.fl=new Vl,this.dl={},this.Vu=null,this.ls=null}function Wl(t,e,n,r,i){this.window=t,this.Ts=e,this.persistenceKey=n,this.bc=r,this.oc=null,this.Vu=null,this.ls=null,this.vc=this.Sc.bind(this),this.Dc=new Si(Rr),this.Hi=!1,this.Cc=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.$c=Al(this.persistenceKey,this.bc),this.Fc="firestore_sequence_number_"+this.persistenceKey,this.Dc=this.Dc.nt(this.bc,new Vl),this.Nc=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.kc=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.xc=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Mc="firestore_online_state_"+this.persistenceKey,this.window.addEventListener("storage",this.vc)}function Hl(){this.activeTargetIds=Hi()}function Xl(t,e){this.clientId=t,this.onlineState=e}function Ql(t,e){this.clientId=t,this.activeTargetIds=e}function Yl(t,e,n){this.targetId=t,this.state=e,this.error=n}function Jl(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function Zl(t,e,n,r,i,o,s){var u=new ql(t,e,n,r,i,o);return s&&(u.Jl=!0),u}function $l(c,h,f,l){return g(this,void 0,void 0,function(){var u,a;return w(this,function(t){switch(t.label){case 0:return(u=Or(c)).Zl("applyBatchState()"),[4,(r=u.Fu,i=h,o=Or(r),s=Or(o.jn),o.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return s.Br(e,i).next(function(t){return t?o.Ih.Jn(e,t):na.resolve(null)})}))];case 1:return null===(a=t.sent())?[3,6]:"pending"!==f?[3,3]:[4,u.Ol.tc()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===f||"rejected"===f?(u.h_(h,l||null),e=u.Fu,n=h,Or(Or(e).jn).Gr(n)):Dr(),t.label=4;case 4:return[4,u.i_(a)];case 5:return t.sent(),[3,7];case 6:Ar("SyncEngine","Cannot apply mutation batch with id: "+h),t.label=7;case 7:return[2]}var e,n,r,i,o,s})})}function tp(h,f){return g(this,void 0,void 0,function(){var r,e,i,o,s,u,a,c;return w(this,function(t){switch(t.label){case 0:return r=Or(h),!0!==f||!0===r.Jl?[3,3]:(e=r.Ll.Bc(),[4,ep(r,e.$())]);case 1:return i=t.sent(),r.Jl=!0,[4,r.Ol.Pc(!0)];case 2:for(t.sent(),o=0,s=i;o<s.length;o++)u=s[o],r.Ol.listen(u);return[3,7];case 3:return!1!==f||!1===r.Jl?[3,7]:(a=[],c=Promise.resolve(),r.Wl.forEach(function(t,e){r.Ll.Jc(e)?a.push(e):c=c.then(function(){return r.n_(e),r.Fu.kh(e,!0)}),r.Ol.ic(e)}),[4,c]);case 4:return t.sent(),[4,ep(r,a)];case 5:return t.sent(),(n=Or(r)).Kl.forEach(function(t,e){n.Ol.ic(e)}),n.Gl.Kh(),n.Kl=new Map,n.jl=new Si(ei.P),r.Jl=!1,[4,r.Ol.Pc(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}var n})})}function ep(v,y){return g(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f,l,p,d;return w(this,function(t){switch(t.label){case 0:e=Or(v),n=[],r=[],i=0,o=y,t.label=1;case 1:return i<o.length?(s=o[i],u=void 0,(a=e.Wl.get(s))&&0!==a.length?[4,e.Fu.Nh(Iu(a[0]))]:[3,7]):[3,13];case 2:u=t.sent(),c=0,h=a,t.label=3;case 3:return c<h.length?(f=h[c],l=e.Ul.get(f),[4,function(i,o){return g(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:return[4,(e=Or(i)).Fu.xh(o.query,!0)];case 1:return n=t.sent(),r=o.view.Dl(n),[2,(e.Xl&&e.e_(o.targetId,r.bl),r)]}})})}(e,l)]):[3,6];case 4:(p=t.sent()).snapshot&&r.push(p.snapshot),t.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,Ih(e.Fu,s)];case 8:return d=t.sent(),[4,e.Fu.Nh(d)];case 9:return u=t.sent(),[4,e.t_(np(d),s,!1)];case 10:t.sent(),t.label=11;case 11:n.push(u),t.label=12;case 12:return i++,[3,1];case 13:return[2,(e.Bl.nu(r),n)]}})})}function np(t){return gu(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function rp(s,u,a,c){return g(this,void 0,void 0,function(){var n,i,o;return w(this,function(t){switch(t.label){case 0:return(n=Or(s)).Jl?(Ar("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!n.Wl.has(u))return[3,8];switch(a){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,(r=Or(n.Fu),e=Or(r.Eh),r.persistence.runTransaction("Get new document changes","readonly",function(t){return e.Ks(t,r.Th)}).then(function(t){var e=t.Gs,n=t.readTime;return r.Th=n,e}))];case 3:return i=t.sent(),o=to.Gt(u,"current"===a),[4,n.i_(i,o)];case 4:return t.sent(),[3,8];case 5:return[4,n.Fu.kh(u,!0)];case 6:return t.sent(),n.n_(u,c),[3,8];case 7:Dr(),t.label=8;case 8:return[2]}var r,e})})}function ip(){this.T_=void 0,this.listeners=[]}var op,sp=(vp.prototype.listen=function(u){return g(this,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:if(e=u.query,n=!1,(r=this.E_.get(e))||(n=!0,r=new ip),!n)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),i=r,[4,this.oc.listen(e)];case 2:return i.T_=t.sent(),[3,4];case 3:return o=t.sent(),s=uh(o,"Initialization of query '"+Su(u.query)+"' failed"),[2,void u.onError(s)];case 4:return this.E_.set(e,r),r.listeners.push(u),u.vl(this.onlineState),r.T_&&u.m_(r.T_)&&this.A_(),[2]}})})},vp.prototype.ic=function(o){return g(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){return e=o.query,n=!1,(r=this.E_.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?[2,(this.E_.delete(e),this.oc.ic(e))]:[2]})})},vp.prototype.nu=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.E_.get(o);if(s){for(var u=0,a=s.listeners;u<a.length;u++)a[u].m_(i)&&(e=!0);s.T_=i}}e&&this.A_()},vp.prototype.l_=function(t,e){var n=this.E_.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.E_.delete(t)},vp.prototype.r_=function(i){this.onlineState=i;var o=!1;this.E_.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].vl(i)&&(o=!0)}),o&&this.A_()},vp.prototype.R_=function(t){this.I_.add(t),t.next()},vp.prototype.P_=function(t){this.I_.delete(t)},vp.prototype.A_=function(){this.I_.forEach(function(t){t.next()})},vp),up=(dp.prototype.m_=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new $i(t.query,t.docs,t.Ot,e,t.Lt,t.fromCache,t.qt,!0)}var o=!1;return this.V_?this.p_(t)&&(this.g_.next(t),o=!0):this.b_(t,this.onlineState)&&(this.v_(t),o=!0),this.y_=t,o},dp.prototype.onError=function(t){this.g_.error(t)},dp.prototype.vl=function(t){this.onlineState=t;var e=!1;return this.y_&&!this.V_&&this.b_(this.y_,t)&&(this.v_(this.y_),e=!0),e},dp.prototype.b_=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.S_&&n||t.docs._()&&"Offline"!==e)},dp.prototype.p_=function(t){if(0<t.docChanges.length)return!0;var e=this.y_&&this.y_.hasPendingWrites!==t.hasPendingWrites;return!(!t.qt&&!e)&&!0===this.options.includeMetadataChanges},dp.prototype.v_=function(t){t=$i.Ut(t.query,t.docs,t.Lt,t.fromCache),this.V_=!0,this.g_.next(t)},dp),ap=(pp.prototype.mh=function(t){this.D_=t},pp.prototype.ts=function(e,r,i,o){var s=this;return r.on()||i.isEqual(Yr.min())?this.C_(e,r):this.D_.Jn(e,o).next(function(t){var n=s.F_(r,t);return(r.hn()||r.an())&&s.Vl(r.en,n,o,i)?s.C_(e,r):(Nr()<=p.DEBUG&&Ar("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Su(r)),s.D_.ts(e,r,i).next(function(e){return n.forEach(function(t){e=e.nt(t.key,t)}),e}))})},pp.prototype.F_=function(n,t){var r=new Ri(xu(n));return t.forEach(function(t,e){e instanceof au&&Du(n,e)&&(r=r.add(e))}),r},pp.prototype.Vl=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.o(r))},pp.prototype.C_=function(t,e){return Nr()<=p.DEBUG&&Ar("IndexFreeQueryEngine","Using full collection scan to execute query:",Su(e)),this.D_.ts(t,e,Yr.min())},pp),cp=(lp.prototype.Or=function(t){return na.resolve(0===this.jn.length)},lp.prototype.Lr=function(t,e,n,r){var i=this.N_;this.N_++,0<this.jn.length&&this.jn[this.jn.length-1];var o=new ta(i,e,n,r);this.jn.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.k_=this.k_.add(new Nh(a.key,i)),this.Kn.Cs(t,a.key.path.p())}return na.resolve(o)},lp.prototype.qr=function(t,e){return na.resolve(this.x_(e))},lp.prototype.Ur=function(t,e){var n=e+1,r=this.M_(n),i=r<0?0:r;return na.resolve(this.jn.length>i?this.jn[i]:null)},lp.prototype.Wr=function(){return na.resolve(0===this.jn.length?-1:this.N_-1)},lp.prototype.Qr=function(t){return na.resolve(this.jn.slice())},lp.prototype.zn=function(t,e){var n=this,r=new Nh(e,0),i=new Nh(e,Number.POSITIVE_INFINITY),o=[];return this.k_.vt([r,i],function(t){var e=n.x_(t.zh);o.push(e)}),na.resolve(o)},lp.prototype.Zn=function(t,e){var r=this,i=new Ri(Rr);return e.forEach(function(t){var e=new Nh(t,0),n=new Nh(t,Number.POSITIVE_INFINITY);r.k_.vt([e,n],function(t){i=i.add(t.zh)})}),na.resolve(this.O_(i))},lp.prototype.os=function(t,e){var n=e.path,r=n.length+1,i=n;ei.W(i)||(i=i.child(""));var o=new Nh(new ei(i),0),s=new Ri(Rr);return this.k_.St(function(t){var e=t.key.path;return!!n.D(e)&&(e.length===r&&(s=s.add(t.zh)),!0)},o),na.resolve(this.O_(s))},lp.prototype.O_=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.x_(t);null!==e&&r.push(e)}),r},lp.prototype.Kr=function(n,r){var i=this;xr(0===this.L_(r.batchId,"removed")),this.jn.shift();var o=this.k_;return na.forEach(r.mutations,function(t){var e=new Nh(t.key,r.batchId);return o=o.delete(e),i.ii.Dr(n,t.key)}).next(function(){i.k_=o})},lp.prototype.Gr=function(t){},lp.prototype.pi=function(t,e){var n=new Nh(e,0),r=this.k_.Dt(n);return na.resolve(e.isEqual(r&&r.key))},lp.prototype.zr=function(t){return this.jn.length,na.resolve()},lp.prototype.L_=function(t,e){return this.M_(t)},lp.prototype.M_=function(t){return 0===this.jn.length?0:t-this.jn[0].batchId},lp.prototype.x_=function(t){var e=this.M_(t);return e<0||e>=this.jn.length?null:this.jn[e]},lp),hp=(fp.prototype.Nn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.q_(e);return this.docs=this.docs.nt(r,{Ls:e,size:s,readTime:n}),this.size+=s-o,this.Kn.Cs(t,r.path.p())},fp.prototype.xn=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},fp.prototype.Mn=function(t,e){var n=this.docs.get(e);return na.resolve(n?n.Ls:null)},fp.prototype.getEntries=function(t,e){var n=this,r=ji();return e.forEach(function(t){var e=n.docs.get(t);r=r.nt(t,e?e.Ls:null)}),na.resolve(r)},fp.prototype.ts=function(t,e,n){for(var r=Gi(),i=new ei(e.path.child("")),o=this.docs.ut(i);o.wt();){var s=o.dt(),u=s.key,a=s.value,c=a.Ls,h=a.readTime;if(!e.path.D(u.path))break;h.o(n)<=0||c instanceof au&&Du(e,c)&&(r=r.nt(c.key,c))}return na.resolve(r)},fp.prototype.B_=function(t,e){return na.forEach(this.docs,function(t){return e(t)})},fp.prototype.Hs=function(t){return new fp.Ys(this)},fp.prototype.Xs=function(t){return na.resolve(this.size)},fp);function fp(t,e){this.Kn=t,this.q_=e,this.docs=new Si(ei.P),this.size=0}function lp(t,e){this.Kn=t,this.ii=e,this.jn=[],this.N_=1,this.k_=new Ri(Nh.Lh)}function pp(){}function dp(t,e,n){this.query=t,this.g_=e,this.V_=!1,this.y_=null,this.onlineState="Unknown",this.options=n||{}}function vp(t){this.oc=t,this.E_=new Wr(function(t){return _u(t)},Au),this.onlineState="Unknown",this.I_=new Set,this.oc.subscribe(this)}function yp(t){var e=this;return(e=op.call(this)||this).Zs=t,e}hp.Ys=(n(yp,op=ra),yp.prototype.qn=function(n){var r=this,i=[];return this.Cn.forEach(function(t,e){e?i.push(r.Zs.Nn(n,e,r.readTime)):r.Zs.xn(t)}),na.Sn(i)},yp.prototype.On=function(t,e){return this.Zs.Mn(t,e)},yp.prototype.Ln=function(t,e){return this.Zs.getEntries(t,e)},yp);var gp,mp,wp,bp=(Hp.prototype.pe=function(t,n){return this.U_.forEach(function(t,e){return n(e)}),na.resolve()},Hp.prototype.ai=function(t){return na.resolve(this.lastRemoteSnapshotVersion)},Hp.prototype.ui=function(t){return na.resolve(this.W_)},Hp.prototype.ri=function(t){return this.highestTargetId=this.j_.next(),na.resolve(this.highestTargetId)},Hp.prototype.ci=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.W_&&(this.W_=e),na.resolve()},Hp.prototype._i=function(t){this.U_.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.j_=new Qa(e),this.highestTargetId=e),t.sequenceNumber>this.W_&&(this.W_=t.sequenceNumber)},Hp.prototype.li=function(t,e){return this._i(e),this.targetCount+=1,na.resolve()},Hp.prototype.di=function(t,e){return this._i(e),na.resolve()},Hp.prototype.wi=function(t,e){return this.U_.delete(e.target),this.Q_.jh(e.targetId),--this.targetCount,na.resolve()},Hp.prototype.Ei=function(n,r,i){var o=this,s=0,u=[];return this.U_.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.U_.delete(t),u.push(o.Ti(n,e.targetId)),s++)}),na.Sn(u).next(function(){return s})},Hp.prototype.Ii=function(t){return na.resolve(this.targetCount)},Hp.prototype.mi=function(t,e){var n=this.U_.get(e)||null;return na.resolve(n)},Hp.prototype.Ai=function(t,e,n){return this.Q_.Uh(e,n),na.resolve()},Hp.prototype.Pi=function(e,t,n){this.Q_.Qh(t,n);var r=this.persistence.ii,i=[];return r&&t.forEach(function(t){i.push(r.Dr(e,t))}),na.Sn(i)},Hp.prototype.Ti=function(t,e){return this.Q_.jh(e),na.resolve()},Hp.prototype.Vi=function(t,e){var n=this.Q_.Gh(e);return na.resolve(n)},Hp.prototype.pi=function(t,e){return na.resolve(this.Q_.pi(e))},Hp),Ip=(Wp.prototype.start=function(){return Promise.resolve()},Wp.prototype._r=function(){return this.$i=!1,Promise.resolve()},Object.defineProperty(Wp.prototype,"Hi",{get:function(){return this.$i},enumerable:!1,configurable:!0}),Wp.prototype.Yi=function(){},Wp.prototype.Xi=function(){},Wp.prototype.gr=function(){return this.Kn},Wp.prototype.mr=function(t){var e=this.K_[t.Aa()];return e||(e=new cp(this.Kn,this.ii),this.K_[t.Aa()]=e),e},Wp.prototype.Rr=function(){return this.qi},Wp.prototype.Pr=function(){return this.Qn},Wp.prototype.runTransaction=function(t,e,n){var r=this;Ar("MemoryPersistence","Starting transaction:",t);var i=new Ep(this.Ci.next());return this.ii.z_(),n(i).next(function(t){return r.ii.H_(i).next(function(){return t})}).bn().then(function(t){return i.Wn(),t})},Wp.prototype.Y_=function(e,n){return na.Dn(Object.values(this.K_).map(function(t){return function(){return t.pi(e,n)}}))},Wp),Ep=(n(Kp,wp=oa),Kp),Tp=(zp.Z_=function(t){return new zp(t)},Object.defineProperty(zp.prototype,"tf",{get:function(){if(this.X_)return this.X_;throw Dr()},enumerable:!1,configurable:!0}),zp.prototype.Ri=function(t,e,n){return this.J_.Ri(n,e),this.tf.delete(n),na.resolve()},zp.prototype.gi=function(t,e,n){return this.J_.gi(n,e),this.tf.add(n),na.resolve()},zp.prototype.Dr=function(t,e){return this.tf.add(e),na.resolve()},zp.prototype.removeTarget=function(t,e){var n=this;this.J_.jh(e.targetId).forEach(function(t){return n.tf.add(t)});var r=this.persistence.Rr();return r.Vi(t,e.targetId).next(function(t){t.forEach(function(t){return n.tf.add(t)})}).next(function(){return r.wi(t,e)})},zp.prototype.z_=function(){this.X_=new Set},zp.prototype.H_=function(t){var n=this,r=this.persistence.Pr().Hs();return na.forEach(this.tf,function(e){return n.ef(t,e).next(function(t){t||r.xn(e)})}).next(function(){return n.X_=null,r.apply(t)})},zp.prototype.Nr=function(t,e){var n=this;return this.ef(t,e).next(function(t){t?n.tf.delete(e):n.tf.add(e)})},zp.prototype.G_=function(t){return 0},zp.prototype.ef=function(t,e){var n=this;return na.Dn([function(){return na.resolve(n.J_.pi(e))},function(){return n.persistence.Rr().pi(t,e)},function(){return n.persistence.Y_(t,e)}])},zp),Np=(Bp.prototype.tu=function(t){this.if=t},Bp.prototype.Ha=function(t){this.rf=t},Bp.prototype.onMessage=function(t){this.hf=t},Bp.prototype.close=function(){this.sf()},Bp.prototype.send=function(t){this.nf(t)},Bp.prototype.af=function(){this.if()},Bp.prototype.uf=function(t){this.rf(t)},Bp.prototype.cf=function(t){this.hf(t)},Bp),Ap={BatchGetDocuments:"batchGet",Commit:"commit"},_p="gl-js/ fire/"+Er,Sp=(Gp.prototype._f=function(t,e){if(e)for(var n in e.ga)e.ga.hasOwnProperty(n)&&(t[n]=e.ga[n]);t["X-Goog-Api-Client"]=_p},Gp.prototype.fu=function(a,r,i){var c=this,h=this.ff(a);return new Promise(function(o,s){var u=new wr;u.listenOnce(gr.COMPLETE,function(){try{switch(u.getLastErrorCode()){case yr.NO_ERROR:var t=u.getResponseJson();Ar("Connection","XHR received:",JSON.stringify(t)),o(t);break;case yr.TIMEOUT:Ar("Connection",'RPC "'+a+'" timed out'),s(new Xr(Hr.DEADLINE_EXCEEDED,"Request time out"));break;case yr.HTTP_ERROR:var e=u.getStatus();if(Ar("Connection",'RPC "'+a+'" failed with status:',e,"response text:",u.getResponseText()),0<e){var n=u.getResponseJson().error;if(n&&n.status&&n.message){var r=(i=n.status.toLowerCase().replace("_","-"),0<=Object.values(Hr).indexOf(i)?i:Hr.UNKNOWN);s(new Xr(r,n.message))}else s(new Xr(Hr.UNKNOWN,"Server responded with status "+u.getStatus()))}else Ar("Connection",'RPC "'+a+'" failed'),s(new Xr(Hr.UNAVAILABLE,"Connection failed."));break;default:Dr()}}finally{Ar("Connection",'RPC "'+a+'" completed.')}var i});var t=Object.assign({},r);delete t.database;var e=JSON.stringify(t);Ar("Connection","XHR sending: ",h+" "+e);var n={"Content-Type":"text/plain"};c._f(n,i),u.send(h,"POST",e,n,15)})},Gp.prototype.du=function(t,e,n){return this.fu(t,e,n)},Gp.prototype.eu=function(t,e){var n,r,i=[this.lf,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=vr(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.s.projectId+"/databases/"+this.s.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this._f(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(v())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=v().indexOf("Electron/")||0<=(r=v()).indexOf("MSIE ")||0<=r.indexOf("Trident/")||0<=v().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");function a(t,e){c.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Ar("Connection","Creating WebChannel: "+u+" "+s);var c=o.createWebChannel(u,s),h=!1,f=!1,l=new Np({nf:function(t){f?Ar("Connection","Not sending because WebChannel is closed:",t):(h||(Ar("Connection","Opening WebChannel transport."),c.open(),h=!0),Ar("Connection","WebChannel sending:",t),c.send(t))},sf:function(){return c.close()}});return a(mr.EventType.OPEN,function(){f||Ar("Connection","WebChannel transport opened.")}),a(mr.EventType.CLOSE,function(){f||(f=!0,Ar("Connection","WebChannel transport closed"),l.uf())}),a(mr.EventType.ERROR,function(t){f||(f=!0,function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Tr.logLevel<=p.WARN){var r=e.map(Sr);Tr.warn.apply(Tr,d(["Firestore ("+Er+"): Connection"],r))}}("Connection","WebChannel transport errored:",t),l.uf(new Xr(Hr.UNAVAILABLE,"The operation could not be completed")))}),a(mr.EventType.MESSAGE,function(t){var e;if(!f){var n=t.data[0];xr(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Ar("Connection","WebChannel received error:",r);var i=r.status,o=function(){var t=Ii[i];if(void 0!==t)return _i(t)}(),s=r.message;void 0===o&&(o=Hr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),f=!0,l.uf(new Xr(o,s)),c.close()}else Ar("Connection","WebChannel received:",n),l.cf(n)}}),setTimeout(function(){l.af()},0),l},Gp.prototype.ff=function(t){var e=Ap[t];return this.lf+"/v1/projects/"+this.s.projectId+"/databases/"+this.s.database+"/documents:"+e},Gp),Dp=(qp.prototype.Lu=function(t){this.If.push(t)},qp.prototype._r=function(){window.removeEventListener("online",this.df),window.removeEventListener("offline",this.Tf)},qp.prototype.mf=function(){window.addEventListener("online",this.df),window.addEventListener("offline",this.Tf)},qp.prototype.wf=function(){Ar("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.If;t<e.length;t++)(0,e[t])(0)},qp.prototype.Ef=function(){Ar("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.If;t<e.length;t++)(0,e[t])(1)},qp.Oi=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},qp),xp=(jp.prototype.Lu=function(t){},jp.prototype._r=function(){},jp),Op="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",kp=(Mp.prototype.initialize=function(r){return g(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:return this.Ll=this.Af(r),this.persistence=this.Rf(r),[4,this.persistence.start()];case 1:return t.sent(),this.Pf=this.gf(r),this.Fu=this.Vf(r),this.wu=this.yf(r),[4,this.pf(r)];case 2:return e=t.sent(),this.wu.start(e),this.Ol=this.bf(r),this.oc=this.vf(r),this.Sf=this.Df(r),this.Ll.Vu=function(t){return n.oc.vl(t,1)},this.Ol.oc=this.oc,[4,this.Ll.start()];case 3:return t.sent(),[4,this.Ol.start()];case 4:return t.sent(),[4,this.Ol.Pc(this.oc.Xl)];case 5:return t.sent(),[2]}})})},Mp.prototype.pf=function(t){return e=t.Cf,Promise.resolve(new Sp(e));var e},Mp.prototype.Df=function(t){return new sp(this.oc)},Mp.prototype.gf=function(t){return null},Mp.prototype.Vf=function(t){return bh(this.persistence,new ap,t.$f)},Mp.prototype.Rf=function(t){if(t.Nf.Ff)throw new Xr(Hr.FAILED_PRECONDITION,Op);return new Ip(Tp.Z_)},Mp.prototype.yf=function(t){var e,n=Sf(t.Cf.s);return e=t.credentials,new hl(e,n)},Mp.prototype.bf=function(t){var e=this;return new pl(this.Fu,this.wu,t.ao,function(t){return e.oc.vl(t,0)},new(Dp.Oi()?Dp:xp))},Mp.prototype.Af=function(t){return new Ul},Mp.prototype.vf=function(t){return Zl(this.Fu,this.Ol,this.wu,this.Ll,t.$f,t.ql,!0)},Mp.prototype.clearPersistence=function(t,e){throw new Xr(Hr.FAILED_PRECONDITION,Op)},Mp),Pp=(n(Up,mp=kp),Up.prototype.Vf=function(t){return bh(this.persistence,new ap,t.$f)},Up.prototype.gf=function(t){var e=this.persistence.ii.yr;return new dh(e,t.ao)},Up.prototype.Rf=function(t){var e=pc(t.Cf.s,t.Cf.persistenceKey),n=Sf(t.Cf.s);return new oc(t.Nf.synchronizeTabs,e,t.clientId,fh.Ho(t.Nf.cacheSizeBytes),t.ao,nh(),"undefined"!=typeof document?document:null,n,this.Ll,t.Nf.Di)},Up.prototype.Af=function(t){return new Ul},Up.prototype.clearPersistence=function(t,e){return function(n){return g(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return Gc.Oi()?(e=n+"main",[4,Gc.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}(pc(t,e))},n(Fp,gp=Up),Fp.prototype.initialize=function(e){return g(this,void 0,void 0,function(){var n=this;return w(this,function(t){switch(t.label){case 0:return[4,gp.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,this.persistence.zi(function(e){return g(n,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,tp(this.oc,e)];case 1:return t.sent(),this.Pf&&(e&&!this.Pf.Hi?this.Pf.start(this.Fu):e||this.Pf.stop()),[2]}})})})];case 2:return t.sent(),[4,function(r){return g(this,void 0,void 0,function(){var e,n;return w(this,function(t){return e=Or(r),n=Or(e.Eh),[2,e.persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return n.zs(t)}).then(function(t){e.Th=t})]})})}(this.Fu)];case 3:return t.sent(),[2]}})})},Fp.prototype.vf=function(t){var e=!t.Nf.Ff||!t.Nf.synchronizeTabs,n=Zl(this.Fu,this.Ol,this.wu,this.Ll,t.$f,t.ql,e);return this.Ll instanceof Fl&&(this.Ll.oc={cl:$l.bind(null,n),ll:rp.bind(null,n),_l:function(f,l,p){return g(this,void 0,void 0,function(){var n,e,r,i,o,s,u,a,c,h;return w(this,function(t){switch(t.label){case 0:if(!(n=Or(f)).Jl)return[3,10];e=0,r=l,t.label=1;case 1:return e<r.length?(i=r[e],n.Wl.has(i)?(Ar("SyncEngine","Adding an already active target "+i),[3,5]):[4,Ih(n.Fu,i)]):[3,6];case 2:return o=t.sent(),[4,n.Fu.Nh(o)];case 3:return s=t.sent(),[4,n.t_(np(o),s.targetId,!1)];case 4:t.sent(),n.Ol.listen(s),t.label=5;case 5:return e++,[3,1];case 6:u=function(e){return w(this,function(t){switch(t.label){case 0:return n.Wl.has(e)?[4,n.Fu.kh(e,!1).then(function(){n.Ol.ic(e),n.n_(e)}).catch(Eh)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},a=0,c=p,t.label=7;case 7:return a<c.length?(h=c[a],[5,u(h)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})}.bind(null,n),Ir:function(t){var e=Or(t);return Or(Or(e.Fu).persistence).Ir()}.bind(null,n)}),n},Fp.prototype.Af=function(t){if(t.Nf.Ff&&t.Nf.synchronizeTabs){var e=nh();if(!Fl.Oi(e))throw new Xr(Hr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=pc(t.Cf.s,t.Cf.persistenceKey);return new Fl(e,t.ao,n,t.clientId,t.$f)}return new Ul},Fp),Lp=(Vp.prototype.start=function(t,e,n){var r=this;this.kf(),this.Cf=t;var i=new ga,o=new ga,s=!1;return this.credentials.pa(function(t){if(!s)return s=!0,Ar("FirestoreClient","Initializing. user=",t.uid),r.xf(e,n,t,o).then(i.resolve,i.reject);r.ao.er(function(){return r.Ol.Rc(t)})}),this.ao.Zi(function(){return i.promise}),o.promise},Vp.prototype.enableNetwork=function(){var t=this;return this.kf(),this.ao.enqueue(function(){return t.persistence.Xi(!0),t.Ol.enableNetwork()})},Vp.prototype.xf=function(r,i,o,s){return g(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,r.initialize({ao:this.ao,Cf:this.Cf,clientId:this.clientId,credentials:this.credentials,$f:o,ql:100,Nf:i})];case 1:return t.sent(),this.persistence=r.persistence,this.Ll=r.Ll,this.Fu=r.Fu,this.Ol=r.Ol,this.oc=r.oc,this.Pf=r.Pf,this.Mf=r.Sf,this.persistence.Yi(function(){return g(n,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})}),s.resolve(),[3,3];case 2:if(e=t.sent(),s.reject(e),!this.Of(e))throw e;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),this.xf(new kp,{Ff:!1},o,s))];case 3:return[2]}})})},Vp.prototype.Of=function(t){return"FirebaseError"===t.name?t.code===Hr.FAILED_PRECONDITION||t.code===Hr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},Vp.prototype.kf=function(){if(this.ao.yo)throw new Xr(Hr.FAILED_PRECONDITION,"The client has already been terminated.")},Vp.prototype.disableNetwork=function(){var t=this;return this.kf(),this.ao.enqueue(function(){return t.persistence.Xi(!1),t.Ol.disableNetwork()})},Vp.prototype.terminate=function(){var t=this;return this.ao.Do(function(){return g(t,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Pf&&this.Pf.stop(),[4,this.Ol._r()];case 1:return t.sent(),[4,this.Ll._r()];case 2:return t.sent(),[4,this.persistence._r()];case 3:return t.sent(),this.credentials.ba(),[2]}})})})},Vp.prototype.waitForPendingWrites=function(){var t=this;this.kf();var e=new ga;return this.ao.Zi(function(){return t.oc.u_(e)}),e.promise},Vp.prototype.listen=function(t,e,n){var r=this;this.kf();var i=new up(t,e,n);return this.ao.Zi(function(){return r.Mf.listen(i)}),i},Vp.prototype.ic=function(t){var e=this;this.Lf||this.ao.Zi(function(){return e.Mf.ic(t)})},Vp.prototype.qf=function(o){return g(this,void 0,void 0,function(){var i,e=this;return w(this,function(t){switch(t.label){case 0:return this.kf(),i=new ga,[4,this.ao.enqueue(function(){return g(e,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.Fu.Fh(o)];case 1:return(e=t.sent())instanceof au?i.resolve(e):e instanceof cu?i.resolve(null):i.reject(new Xr(Hr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return n=t.sent(),r=uh(n,"Failed to get document '"+o+" from cache"),i.reject(r),[3,3];case 3:return[2]}})})})];case 1:return[2,(t.sent(),i.promise)]}})})},Vp.prototype.Bf=function(a){return g(this,void 0,void 0,function(){var u,e=this;return w(this,function(t){switch(t.label){case 0:return this.kf(),u=new ga,[4,this.ao.enqueue(function(){return g(e,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.Fu.xh(a,!0)];case 1:return e=t.sent(),n=new Ml(a,e.Mh),r=n.Rl(e.documents),i=n.qn(r,!1),u.resolve(i.snapshot),[3,3];case 2:return o=t.sent(),s=uh(o,"Failed to execute query '"+a+" against cache"),u.reject(s),[3,3];case 3:return[2]}})})})];case 1:return[2,(t.sent(),u.promise)]}})})},Vp.prototype.write=function(t){var e=this;this.kf();var n=new ga;return this.ao.Zi(function(){return e.oc.write(t,n)}),n.promise},Vp.prototype.s=function(){return this.Cf.s},Vp.prototype.R_=function(t){var e=this;this.kf(),this.ao.Zi(function(){return e.Mf.R_(t),Promise.resolve()})},Vp.prototype.P_=function(t){var e=this;this.Lf||this.ao.Zi(function(){return e.Mf.P_(t),Promise.resolve()})},Object.defineProperty(Vp.prototype,"Lf",{get:function(){return this.ao.yo},enumerable:!1,configurable:!0}),Vp.prototype.transaction=function(t){var e=this;this.kf();var n=new ga;return this.ao.Zi(function(){return e.oc.runTransaction(e.ao,t,n),Promise.resolve()}),n.promise},Vp),Rp=(Cp.prototype.next=function(t){this.Uf(this.observer.next,t)},Cp.prototype.error=function(t){this.Uf(this.observer.error,t)},Cp.prototype.Wf=function(){this.muted=!0},Cp.prototype.Uf=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Cp);function Cp(t){this.observer=t,this.muted=!1}function Vp(t,e){this.credentials=t,this.ao=e,this.clientId=Pr.t()}function Fp(){return null!==gp&&gp.apply(this,arguments)||this}function Up(){return null!==mp&&mp.apply(this,arguments)||this}function Mp(){}function jp(){}function qp(){var t=this;this.df=function(){return t.wf()},this.Tf=function(){return t.Ef()},this.If=[],this.mf()}function Gp(t){this.s=t.s;var e=t.ssl?"https":"http";this.lf=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}function Bp(t){this.nf=t.nf,this.sf=t.sf}function zp(t){this.persistence=t,this.J_=new Th,this.X_=null}function Kp(t){var e=this;return(e=wp.call(this)||this).vi=t,e}function Wp(t){var e=this;this.K_={},this.Ci=new aa(0),this.$i=!1,this.$i=!0,this.ii=t(this),this.qi=new bp(this),this.Kn=new Na,this.Qn=new hp(this.Kn,function(t){return e.ii.G_(t)})}function Hp(t){this.persistence=t,this.U_=new Wr(function(t){return vi(t)},yi),this.lastRemoteSnapshotVersion=Yr.min(),this.highestTargetId=0,this.W_=0,this.Q_=new Th,this.targetCount=0,this.j_=Qa.ni()}function Xp(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var Qp=(ed.prototype.Kf=function(t){switch(go(t)){case 0:return null;case 1:return t.booleanValue;case 2:return No(t.integerValue||t.doubleValue);case 3:return this.Gf(t.timestampValue);case 4:return this.zf(t);case 5:return t.stringValue;case 6:return new Yh(Ao(t.bytesValue));case 7:return this.Hf(t.referenceValue);case 8:return this.Yf(t.geoPointValue);case 9:return this.Jf(t.arrayValue);case 10:return this.Xf(t.mapValue);default:throw Dr()}},ed.prototype.Xf=function(t){var n=this,r={};return qr(t.fields||{},function(t,e){r[t]=n.Kf(e)}),r},ed.prototype.Yf=function(t){return new wf(No(t.latitude),No(t.longitude))},ed.prototype.Jf=function(t){var e=this;return(t.values||[]).map(function(t){return e.Kf(t)})},ed.prototype.zf=function(t){switch(this.Qf){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return po(n)?t(n):n}(t);return null==e?null:this.Kf(e);case"estimate":return this.Gf(vo(t));default:return null}},ed.prototype.Gf=function(t){var e=To(t),n=new Qr(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},ed.prototype.Hf=function(t){var e=Zr.N(t);xr(is(e));var n=new Ur(e.get(1),e.get(3)),r=new ei(e.V(5));return n.isEqual(this.s)||_r("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.s.projectId+"/"+this.s.database+") instead."),this.jf(r)},ed),Yp=fh.Xo,Jp=(td.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},td),Zp=(Object.defineProperty($p.prototype,"ud",{get:function(){return this.ld||(this.ld=new Vf(this.aa,this.ad.ignoreUndefinedProperties)),this.ld},enumerable:!1,configurable:!0}),$p.prototype.settings=function(t){Dh("Firestore.settings",arguments,1),kh("Firestore.settings","object",1,t);var e=new Jp(t);if(this.nd&&!this.ad.isEqual(e))throw new Xr(Hr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.ad=e).credentials&&(this.od=function(t){if(!t)return new rl;switch(t.type){case"gapi":var e=t._d;return xr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new sl(e,t.Fa||"0");case"provider":return t._d;default:throw new Xr(Hr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},$p.prototype.enableNetwork=function(){return this.ed(),this.nd.enableNetwork()},$p.prototype.disableNetwork=function(){return this.ed(),this.nd.disableNetwork()},$p.prototype.enablePersistence=function(t){var e,n;if(this.nd)throw new Xr(Hr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1,i=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&_r("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,r&&i))throw new Xr(Hr.INVALID_ARGUMENT,"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.");return this.fd(this.hd,{Ff:!0,cacheSizeBytes:this.ad.cacheSizeBytes,synchronizeTabs:r,Di:i})},$p.prototype.clearPersistence=function(){return g(this,void 0,void 0,function(){var n,e=this;return w(this,function(t){if(void 0!==this.nd&&!this.nd.Lf)throw new Xr(Hr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");return n=new ga,[2,(this.td.po(function(){return g(e,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.hd.clearPersistence(this.aa,this.rd)];case 1:return t.sent(),n.resolve(),[3,3];case 2:return e=t.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise)]})})},$p.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty($p.prototype,"dd",{get:function(){return this.ed(),this.nd.Lf},enumerable:!1,configurable:!0}),$p.prototype.waitForPendingWrites=function(){return this.ed(),this.nd.waitForPendingWrites()},$p.prototype.onSnapshotsInSync=function(t){if(this.ed(),Xp(t))return nd(this.nd,t);kh("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return nd(this.nd,e)},$p.prototype.ed=function(){return this.nd||this.fd(new kp,{Ff:!1}),this.nd},$p.prototype.wd=function(){return new Fr(this.aa,this.rd,this.ad.host,this.ad.ssl,this.ad.forceLongPolling)},$p.prototype.fd=function(t,e){var n=this.wd();return this.nd=new Lp(this.od,this.td),this.nd.start(n,t,e)},$p.sd=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new Xr(Hr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new Xr(Hr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Ur(n)},Object.defineProperty($p.prototype,"app",{get:function(){if(!this.Zf)throw new Xr(Hr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Zf},enumerable:!1,configurable:!0}),$p.prototype.collection=function(t){return Dh("Firestore.collection",arguments,1),kh("Firestore.collection","non-empty string",1,t),this.ed(),new Sd(Zr.N(t),this,null)},$p.prototype.doc=function(t){return Dh("Firestore.doc",arguments,1),kh("Firestore.doc","non-empty string",1,t),this.ed(),sd.Td(Zr.N(t),this,null)},$p.prototype.collectionGroup=function(t){if(Dh("Firestore.collectionGroup",arguments,1),kh("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Xr(Hr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ed(),new Ed((e=t,new vu(Zr.k(),e)),this,null);var e},$p.prototype.runTransaction=function(e){var n=this;return Dh("Firestore.runTransaction",arguments,1),kh("Firestore.runTransaction","function",1,e),this.ed().transaction(function(t){return e(new id(n,t))})},$p.prototype.batch=function(){return this.ed(),new od(this)},Object.defineProperty($p,"logLevel",{get:function(){switch(Nr()){case p.DEBUG:return"debug";case p.ERROR:return"error";case p.SILENT:return"silent";case p.WARN:return"warn";case p.INFO:return"info";case p.VERBOSE:return"verbose";default:return"error"}},enumerable:!1,configurable:!0}),$p.setLogLevel=function(t){Dh("Firestore.setLogLevel",arguments,1),Vh("setLogLevel",["debug","error","silent","warn","info","verbose"],1,t),Tr.setLogLevel(t)},$p.prototype.Ed=function(){return this.ad.timestampsInSnapshots},$p);function $p(t,e,n){var r=this;if(void 0===n&&(n=new kp),this.Zf=null,this.td=new ih,this.INTERNAL={delete:function(){return g(r,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.ed(),[4,this.nd.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var i=t;this.Zf=i,this.aa=$p.sd(i),this.rd=i.name,this.od=new il(e)}else{var o=t;if(!o.projectId)throw new Xr(Hr.INVALID_ARGUMENT,"Must provide projectId");this.aa=new Ur(o.projectId,o.database),this.rd="[DEFAULT]",this.od=new rl}this.hd=n,this.ad=new Jp({})}function td(t){var e,n,r,i;if(void 0===t.host){if(void 0!==t.ssl)throw new Xr(Hr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Lh("settings","non-empty string","host",t.host),this.host=t.host,Rh("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(qh("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","ignoreUndefinedProperties"]),Rh("settings","object","credentials",t.credentials),this.credentials=t.credentials,Rh("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),Rh("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?_r("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&_r("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,Rh("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=fh.th;else{if(t.cacheSizeBytes!==Yp&&t.cacheSizeBytes<fh.Zo)throw new Xr(Hr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+fh.Zo);this.cacheSizeBytes=t.cacheSizeBytes}Rh("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i}function ed(t,e,n,r){this.s=t,this.timestampsInSnapshots=e,this.Qf=n,this.jf=r}function nd(t,e){var n=new Rp({next:function(){e.next&&e.next()},error:function(t){throw Dr()}});return t.R_(n),function(){n.Wf(),t.P_(n)}}var rd,id=(cd.prototype.get=function(t){var n=this;Dh("Transaction.get",arguments,1);var r=Ld("Transaction.get",t,this.Id);return this.md.Au([r.ua]).then(function(t){if(!t||1!==t.length)return Dr();var e=t[0];if(e instanceof cu)return new pd(n.Id,r.ua,null,!1,!1,r.ca);if(e instanceof au)return new pd(n.Id,r.ua,e,!1,!1,r.ca);throw Dr()})},cd.prototype.set=function(t,e,n){Oh("Transaction.set",arguments,2,3);var r=Ld("Transaction.set",t,this.Id);n=Od("Transaction.set",n);var i=Rd(r.ca,e,n),o=Mf(this.Id.ud,"Transaction.set",r.ua,i,null!==r.ca,n);return this.md.set(r.ua,o),this},cd.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof Zh?(xh("Transaction.update",arguments,3),r=Ld("Transaction.update",t,this.Id),qf(this.Id.ud,"Transaction.update",r.ua,e,n,o)):(Dh("Transaction.update",arguments,2),r=Ld("Transaction.update",t,this.Id),jf(this.Id.ud,"Transaction.update",r.ua,e)),this.md.update(r.ua,i),this},cd.prototype.delete=function(t){Dh("Transaction.delete",arguments,1);var e=Ld("Transaction.delete",t,this.Id);return this.md.delete(e.ua),this},cd),od=(ad.prototype.set=function(t,e,n){Oh("WriteBatch.set",arguments,2,3),this.Pd();var r=Ld("WriteBatch.set",t,this.Id);n=Od("WriteBatch.set",n);var i=Rd(r.ca,e,n),o=Mf(this.Id.ud,"WriteBatch.set",r.ua,i,null!==r.ca,n);return this.Ad=this.Ad.concat(o.la(r.ua,Ss.We())),this},ad.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.Pd(),i="string"==typeof e||e instanceof Zh?(xh("WriteBatch.update",arguments,3),r=Ld("WriteBatch.update",t,this.Id),qf(this.Id.ud,"WriteBatch.update",r.ua,e,n,o)):(Dh("WriteBatch.update",arguments,2),r=Ld("WriteBatch.update",t,this.Id),jf(this.Id.ud,"WriteBatch.update",r.ua,e)),this.Ad=this.Ad.concat(i.la(r.ua,Ss.exists(!0))),this},ad.prototype.delete=function(t){Dh("WriteBatch.delete",arguments,1),this.Pd();var e=Ld("WriteBatch.delete",t,this.Id);return this.Ad=this.Ad.concat(new Qs(e.ua,Ss.We())),this},ad.prototype.commit=function(){return this.Pd(),this.Rd=!0,0<this.Ad.length?this.Id.ed().write(this.Ad):Promise.resolve()},ad.prototype.Pd=function(){if(this.Rd)throw new Xr(Hr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},ad),sd=(n(ud,rd=xf),ud.Td=function(t,e,n){if(t.length%2!=0)throw new Xr(Hr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.F()+" has "+t.length);return new ud(new ei(t),e,n)},Object.defineProperty(ud.prototype,"id",{get:function(){return this.ua.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(ud.prototype,"parent",{get:function(){return new Sd(this.ua.path.p(),this.firestore,this.ca)},enumerable:!1,configurable:!0}),Object.defineProperty(ud.prototype,"path",{get:function(){return this.ua.path.F()},enumerable:!1,configurable:!0}),ud.prototype.collection=function(t){if(Dh("DocumentReference.collection",arguments,1),kh("DocumentReference.collection","non-empty string",1,t),!t)throw new Xr(Hr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Zr.N(t);return new Sd(this.ua.path.child(e),this.firestore,null)},ud.prototype.isEqual=function(t){if(!(t instanceof ud))throw Gh("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.ua.isEqual(t.ua)&&this.ca===t.ca},ud.prototype.set=function(t,e){Oh("DocumentReference.set",arguments,1,2),e=Od("DocumentReference.set",e);var n=Rd(this.ca,t,e),r=Mf(this.firestore.ud,"DocumentReference.set",this.ua,n,null!==this.ca,e);return this.nd.write(r.la(this.ua,Ss.We()))},ud.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof Zh?(xh("DocumentReference.update",arguments,2),qf(this.firestore.ud,"DocumentReference.update",this.ua,t,e,r)):(Dh("DocumentReference.update",arguments,1),jf(this.firestore.ud,"DocumentReference.update",this.ua,t)),this.nd.write(n.la(this.ua,Ss.exists(!0)))},ud.prototype.delete=function(){return Dh("DocumentReference.delete",arguments,0),this.nd.write([new Qs(this.ua,Ss.We())])},ud.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];Oh("DocumentReference.onSnapshot",arguments,1,4);var s={includeMetadataChanges:!1},u=0;"object"!=typeof i[u]||Xp(i[u])||(qh("DocumentReference.onSnapshot",s=i[u],["includeMetadataChanges"]),Rh("DocumentReference.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++);var a={includeMetadataChanges:s.includeMetadataChanges};if(Xp(i[u])){var c=i[u];i[u]=null===(t=c.next)||void 0===t?void 0:t.bind(c),i[u+1]=null===(e=c.error)||void 0===e?void 0:e.bind(c),i[u+2]=null===(n=c.complete)||void 0===n?void 0:n.bind(c)}else kh("DocumentReference.onSnapshot","function",u,i[u]),Ph("DocumentReference.onSnapshot","function",u+1,i[u+1]),Ph("DocumentReference.onSnapshot","function",u+2,i[u+2]);var h={next:function(t){i[u]&&i[u](r.gd(t))},error:i[u+1],complete:i[u+2]};return hd(this.nd,this.ua,a,h)},ud.prototype.get=function(t){var e,n,r,i,o,s=this;return Oh("DocumentReference.get",arguments,0,1),Pd("DocumentReference.get",t),t&&"cache"===t.source?this.firestore.ed().qf(this.ua).then(function(t){return new pd(s.firestore,s.ua,t,!0,t instanceof au&&t.Ke,s.ca)}):(e=this.nd,n=this.ua,r=t,i=new ga,o=hd(e,n,{includeMetadataChanges:!0,S_:!0},{next:function(t){o();var e=t.docs.has(n);!e&&t.fromCache?i.reject(new Xr(Hr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&r&&"server"===r.source?i.reject(new Xr(Hr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),i.promise.then(function(t){return s.gd(t)}))},ud.prototype.withConverter=function(t){return new ud(this.ua,this.firestore,t)},ud.prototype.gd=function(t){var e=t.docs.get(this.ua);return new pd(this.firestore,this.ua,e,t.fromCache,t.hasPendingWrites,this.ca)},ud);function ud(t,e,n){var r=this;return(r=rd.call(this,e.aa,t,n)||this).ua=t,r.firestore=e,r.ca=n,r.nd=r.firestore.ed(),r}function ad(t){this.Id=t,this.Ad=[],this.Rd=!1}function cd(t,e){this.Id=t,this.md=e}function hd(t,e,n,r){var i=function(t){console.error("Uncaught Error in onSnapshot:",t)};r.error&&(i=r.error.bind(r));var o=new Rp({next:function(t){r.next&&r.next(t)},error:i}),s=t.listen(mu(e.path),o,n);return function(){o.Wf(),t.ic(s)}}var fd,ld=(gd.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},gd),pd=(yd.prototype.data=function(t){var e=this;if(Oh("DocumentSnapshot.data",arguments,0,1),t=kd("DocumentSnapshot.data",t),this.Vd){if(this.ca){var n=new dd(this.Id,this.ua,this.Vd,this.yd,this.pd,null);return this.ca.fromFirestore(n,t)}return new Qp(this.Id.aa,this.Id.Ed(),t.serverTimestamps||"none",function(t){return new sd(t,e.Id,null)}).Kf(this.Vd.Ze())}},yd.prototype.get=function(t,e){var n=this;if(Oh("DocumentSnapshot.get",arguments,1,2),e=kd("DocumentSnapshot.get",e),this.Vd){var r=this.Vd.data().field(Hf("DocumentSnapshot.get",t,this.ua));if(null!==r)return new Qp(this.Id.aa,this.Id.Ed(),e.serverTimestamps||"none",function(t){return new sd(t,n.Id,n.ca)}).Kf(r)}},Object.defineProperty(yd.prototype,"id",{get:function(){return this.ua.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(yd.prototype,"ref",{get:function(){return new sd(this.ua,this.Id,this.ca)},enumerable:!1,configurable:!0}),Object.defineProperty(yd.prototype,"exists",{get:function(){return null!==this.Vd},enumerable:!1,configurable:!0}),Object.defineProperty(yd.prototype,"metadata",{get:function(){return new ld(this.pd,this.yd)},enumerable:!1,configurable:!0}),yd.prototype.isEqual=function(t){if(!(t instanceof yd))throw Gh("isEqual","DocumentSnapshot",1,t);return this.Id===t.Id&&this.yd===t.yd&&this.ua.isEqual(t.ua)&&(null===this.Vd?null===t.Vd:this.Vd.isEqual(t.Vd))&&this.ca===t.ca},yd),dd=(n(vd,fd=pd),vd.prototype.data=function(t){return fd.prototype.data.call(this,t)},vd);function vd(){return null!==fd&&fd.apply(this,arguments)||this}function yd(t,e,n,r,i,o){this.Id=t,this.ua=e,this.Vd=n,this.yd=r,this.pd=i,this.ca=o}function gd(t,e){this.hasPendingWrites=t,this.fromCache=e}function md(t,e,n){if("string"==typeof n){if(""===n)throw new Xr(Hr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!wu(e)&&-1!==n.indexOf("/"))throw new Xr(Hr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Zr.N(n));if(!ei.W(r))throw new Xr(Hr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return _o(t,new ei(r))}if(n instanceof xf)return _o(t,n.ua);throw new Xr(Hr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Mh(n)+".")}function wd(t,e){if(!Array.isArray(t)||0===t.length)throw new Xr(Hr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Xr(Hr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new Xr(Hr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Xr(Hr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")}function bd(t,e,n){if(!n.isEqual(e))throw new Xr(Hr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function Id(t){if(t.an()&&0===t.tn.length)throw new Xr(Hr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ed=(Td.prototype.where=function(t,e,n){Dh("Query.where",arguments,3),jh("Query.where",3,n);var r,i,o,s=Vh("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,e),u=Hf("Query.where",t),a=function(t,e,n,r,i,o,s){var u;if(i.O()){if("array-contains"===o||"array-contains-any"===o)throw new Xr(Hr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o){wd(s,o);for(var a=[],c=0,h=s;c<h.length;c++){var f=h[c];a.push(md(r,t,f))}u={arrayValue:{values:a}}}else u=md(r,t,s)}else"in"!==o&&"array-contains-any"!==o||wd(s,o),u=Gf(n,e,s,"in"===o);var l=ku.create(i,o,u);return function(t,e){if(e instanceof ku){var n=["array-contains","array-contains-any"],r=["in","array-contains-any"],i=0<=n.indexOf(e.op),o=0<=r.indexOf(e.op);if(e.ln()){var s=t.cn();if(null!==s&&!s.isEqual(e.field))throw new Xr(Hr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+s.toString()+"' and '"+e.field.toString()+"'");var u=t.un();null!==u&&bd(0,e.field,u)}else if(o||i){var a=null;if(o&&(a=t._n(r)),null===a&&i&&(a=t._n(n)),null!==a)throw a===e.op?new Xr(Hr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Xr(Hr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+a.toString()+"' filters.")}}}(t,l),l}(this.bd,"Query.where",this.firestore.ud,this.firestore.aa,u,s,n);return new Td((r=this.bd,i=a,o=r.filters.concat([i]),new vu(r.path,r.collectionGroup,r.tn.slice(),o,r.limit,r.en,r.startAt,r.endAt)),this.firestore,this.ca)},Td.prototype.orderBy=function(t,e){var n;if(Oh("Query.orderBy",arguments,1,2),Ph("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new Xr(Hr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}var r,i,o,s=Hf("Query.orderBy",t),u=function(t,e,n){if(null!==t.startAt)throw new Xr(Hr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Xr(Hr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Zu(e,n);return function(t,e){if(null===t.un()){var n=t.cn();null!==n&&bd(0,n,e.field)}}(t,r),r}(this.bd,s,n);return new Td((r=this.bd,i=u,o=r.tn.concat([i]),new vu(r.path,r.collectionGroup,o,r.filters.slice(),r.limit,r.en,r.startAt,r.endAt)),this.firestore,this.ca)},Td.prototype.limit=function(t){return Dh("Query.limit",arguments,1),kh("Query.limit","number",1,t),Bh("Query.limit",1,t),new Td(Eu(this.bd,t,"F"),this.firestore,this.ca)},Td.prototype.limitToLast=function(t){return Dh("Query.limitToLast",arguments,1),kh("Query.limitToLast","number",1,t),Bh("Query.limitToLast",1,t),new Td(Eu(this.bd,t,"L"),this.firestore,this.ca)},Td.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];xh("Query.startAt",arguments,1);var r=this.vd("Query.startAt",t,e,!0);return new Td(Tu(this.bd,r),this.firestore,this.ca)},Td.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];xh("Query.startAfter",arguments,1);var r=this.vd("Query.startAfter",t,e,!1);return new Td(Tu(this.bd,r),this.firestore,this.ca)},Td.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];xh("Query.endBefore",arguments,1);var r=this.vd("Query.endBefore",t,e,!0);return new Td(Nu(this.bd,r),this.firestore,this.ca)},Td.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];xh("Query.endAt",arguments,1);var r=this.vd("Query.endAt",t,e,!1);return new Td(Nu(this.bd,r),this.firestore,this.ca)},Td.prototype.isEqual=function(t){if(!(t instanceof Td))throw Gh("isEqual","Query",1,t);return this.firestore===t.firestore&&Au(this.bd,t.bd)&&this.ca===t.ca},Td.prototype.withConverter=function(t){return new Td(this.bd,this.firestore,t)},Td.prototype.vd=function(t,e,n,r){if(jh(t,1,e),e instanceof pd)return Dh(t,d([e],n),1),function(t,e,n,r,i){if(!r)throw new Xr(Hr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,u=bu(t);s<u.length;s++){var a=u[s];if(a.field.O())o.push(_o(e,r.key));else{var c=r.field(a.field);if(po(c))throw new Xr(Hr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=a.field.F();throw new Xr(Hr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Bu(o,i)}(this.bd,this.firestore.aa,t,e.Vd,r);var i=[e].concat(n);return function(t,e,n,r,i,o){var s=t.tn;if(i.length>s.length)throw new Xr(Hr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.O()){if("string"!=typeof c)throw new Xr(Hr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!wu(t)&&-1!==c.indexOf("/"))throw new Xr(Hr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Zr.N(c));if(!ei.W(h))throw new Xr(Hr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var f=new ei(h);u.push(_o(e,f))}else{var l=Gf(n,r,c);u.push(l)}}return new Bu(u,o)}(this.bd,this.firestore.aa,this.firestore.ud,t,i,r)},Td.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];Oh("Query.onSnapshot",arguments,1,4);var s={},u=0;if("object"!=typeof i[u]||Xp(i[u])||(qh("Query.onSnapshot",s=i[u],["includeMetadataChanges"]),Rh("Query.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++),Xp(i[u])){var a=i[u];i[u]=null===(t=a.next)||void 0===t?void 0:t.bind(a),i[u+1]=null===(e=a.error)||void 0===e?void 0:e.bind(a),i[u+2]=null===(n=a.complete)||void 0===n?void 0:n.bind(a)}else kh("Query.onSnapshot","function",u,i[u]),Ph("Query.onSnapshot","function",u+1,i[u+1]),Ph("Query.onSnapshot","function",u+2,i[u+2]);var c={next:function(t){i[u]&&i[u](new _d(r.firestore,r.bd,t,r.ca))},error:i[u+1],complete:i[u+2]};return Id(this.bd),Nd(this.firestore.ed(),this.bd,s,c)},Td.prototype.get=function(t){var e=this;Oh("Query.get",arguments,0,1),Pd("Query.get",t),Id(this.bd);var n,r,i,o,s,u=this.firestore.ed();return(t&&"cache"===t.source?u.Bf(this.bd):(n=u,r=this.bd,i=t,o=new ga,s=Nd(n,r,{includeMetadataChanges:!0,S_:!0},{next:function(t){s(),t.fromCache&&i&&"server"===i.source?o.reject(new Xr(Hr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):o.resolve(t)},error:function(t){return o.reject(t)}}),o.promise)).then(function(t){return new _d(e.firestore,e.bd,t,e.ca)})},Td);function Td(t,e,n){this.bd=t,this.firestore=e,this.ca=n}function Nd(t,e,n,r){var i=function(t){console.error("Uncaught Error in onSnapshot:",t)};r.error&&(i=r.error.bind(r));var o=new Rp({next:function(t){r.next&&r.next(t)},error:i}),s=t.listen(e,o,n);return function(){o.Wf(),t.ic(s)}}var Ad,_d=(Object.defineProperty(xd.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(xd.prototype,"empty",{get:function(){return this.Dd.docs._()},enumerable:!1,configurable:!0}),Object.defineProperty(xd.prototype,"size",{get:function(){return this.Dd.docs.size},enumerable:!1,configurable:!0}),xd.prototype.forEach=function(e,n){var r=this;Oh("QuerySnapshot.forEach",arguments,1,2),kh("QuerySnapshot.forEach","function",1,e),this.Dd.docs.forEach(function(t){e.call(n,r.Fd(t,r.metadata.fromCache,r.Dd.Lt.has(t.key)))})},Object.defineProperty(xd.prototype,"query",{get:function(){return new Ed(this.Sd,this.Id,this.ca)},enumerable:!1,configurable:!0}),xd.prototype.docChanges=function(t){t&&(qh("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Rh("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.Dd.Bt)throw new Xr(Hr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Cd&&this.$d===e||(this.Cd=function(i,e,o){if(i.Ot._()){var n=0;return i.docChanges.map(function(t){var e=o(t.doc,i.fromCache,i.Lt.has(t.doc.key));return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var s=i.Ot;return i.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=o(t.doc,i.fromCache,i.Lt.has(t.doc.key)),n=-1,r=-1;return 0!==t.type&&(n=s.indexOf(t.doc.key),s=s.delete(t.doc.key)),1!==t.type&&(r=(s=s.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Dr()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this.Dd,e,this.Fd.bind(this)),this.$d=e),this.Cd},xd.prototype.isEqual=function(t){if(!(t instanceof xd))throw Gh("isEqual","QuerySnapshot",1,t);return this.Id===t.Id&&Au(this.Sd,t.Sd)&&this.Dd.isEqual(t.Dd)&&this.ca===t.ca},xd.prototype.Fd=function(t,e,n){return new dd(this.Id,t.key,t,e,n,this.ca)},xd),Sd=(n(Dd,Ad=Ed),Object.defineProperty(Dd.prototype,"id",{get:function(){return this.bd.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(Dd.prototype,"parent",{get:function(){var t=this.bd.path.p();return t._()?null:new sd(new ei(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(Dd.prototype,"path",{get:function(){return this.bd.path.F()},enumerable:!1,configurable:!0}),Dd.prototype.doc=function(t){Oh("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Pr.t()),kh("CollectionReference.doc","non-empty string",1,t);var e=Zr.N(t);return sd.Td(this.bd.path.child(e),this.firestore,this.ca)},Dd.prototype.add=function(t){Dh("CollectionReference.add",arguments,1),kh("CollectionReference.add","object",1,this.ca?this.ca.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},Dd.prototype.withConverter=function(t){return new Dd(this.Nd,this.firestore,t)},Dd);function Dd(t,e,n){var r=this;if(((r=Ad.call(this,mu(t),e,n)||this).Nd=t).length%2!=1)throw new Xr(Hr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.F()+" has "+t.length);return r}function xd(t,e,n,r){this.Id=t,this.Sd=e,this.Dd=n,this.ca=r,this.Cd=null,this.$d=null,this.metadata=new ld(n.hasPendingWrites,n.fromCache)}function Od(t,e){if(void 0===e)return{merge:!1};if(qh(t,e,["merge","mergeFields"]),Rh(t,"boolean","merge",e.merge),n=t,void 0!==(r=e.mergeFields)&&function(t,e,n,r){if(!(n instanceof Array))throw new Xr(Hr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Mh(n));for(var i=0;i<n.length;++i)if(!r(n[i]))throw new Xr(Hr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+i+" was: "+Mh(n[i]))}(n,"mergeFields",r,function(t){return"string"==typeof t||t instanceof Zh}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Xr(Hr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n,r;return e}function kd(t,e){return void 0===e?{}:(qh(t,e,["serverTimestamps"]),Ch(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Pd(t,e){Ph(t,"object",1,e),e&&(qh(t,e,["source"]),Ch(t,0,"source",e.source,["default","server","cache"]))}function Ld(t,e,n){if(e instanceof xf){if(e.firestore!==n)throw new Xr(Hr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Gh(t,"DocumentReference",1,e)}function Rd(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Cd,Vd={Firestore:Zp,GeoPoint:wf,Timestamp:Qr,Blob:Yh,Transaction:id,WriteBatch:od,DocumentReference:sd,DocumentSnapshot:pd,Query:Ed,QueryDocumentSnapshot:dd,QuerySnapshot:_d,CollectionReference:Sd,FieldPath:Zh,FieldValue:gf,setLogLevel:Zp.setLogLevel,CACHE_SIZE_UNLIMITED:Yp};(Cd=Fd).INTERNAL.registerComponent(new br("firestore",function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),new Zp(e,n,new Pp);var e,n},"PUBLIC").setServiceProps(Object.assign({},Vd))),Cd.registerVersion("@firebase/firestore","1.16.1")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.js.map
